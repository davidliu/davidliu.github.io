var Te=Object.defineProperty;var Ce=(e,i,t)=>i in e?Te(e,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[i]=t;var h=(e,i,t)=>(Ce(e,typeof i!="symbol"?i+"":i,t),t);function _mergeNamespaces(e,i){for(var t=0;t<i.length;t++){const n=i[t];if(typeof n!="string"&&!Array.isArray(n)){for(const a in n)if(a!=="default"&&!(a in e)){const s=Object.getOwnPropertyDescriptor(n,a);s&&Object.defineProperty(e,a,s.get?s:{enumerable:!0,get:()=>n[a]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerpolicy&&(s.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?s.credentials="include":a.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(a){if(a.ep)return;a.ep=!0;const s=t(a);fetch(a.href,s)}})();const styles="";var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var loglevel={exports:{}};(function(e){(function(i,t){e.exports?e.exports=t():i.log=t()})(commonjsGlobal,function(){var i=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),a=["trace","debug","info","warn","error"];function s(S,v){var T=S[v];if(typeof T.bind=="function")return T.bind(S);try{return Function.prototype.bind.call(T,S)}catch{return function(){return Function.prototype.apply.apply(T,[S,arguments])}}}function o(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function c(S){return S==="debug"&&(S="log"),typeof console===t?!1:S==="trace"&&n?o:console[S]!==void 0?s(console,S):console.log!==void 0?s(console,"log"):i}function d(S,v){for(var T=0;T<a.length;T++){var k=a[T];this[k]=T<S?i:this.methodFactory(k,S,v)}this.log=this.debug}function u(S,v,T){return function(){typeof console!==t&&(d.call(this,v,T),this[S].apply(this,arguments))}}function l(S,v,T){return c(S)||u.apply(this,arguments)}function f(S,v,T){var k=this,b;v=v==null?"WARN":v;var y="loglevel";typeof S=="string"?y+=":"+S:typeof S=="symbol"&&(y=void 0);function N(C){var I=(a[C]||"silent").toUpperCase();if(!(typeof window===t||!y)){try{window.localStorage[y]=I;return}catch{}try{window.document.cookie=encodeURIComponent(y)+"="+I+";"}catch{}}}function D(){var C;if(!(typeof window===t||!y)){try{C=window.localStorage[y]}catch{}if(typeof C===t)try{var I=window.document.cookie,U=I.indexOf(encodeURIComponent(y)+"=");U!==-1&&(C=/^([^;]+)/.exec(I.slice(U))[1])}catch{}return k.levels[C]===void 0&&(C=void 0),C}}function B(){if(!(typeof window===t||!y)){try{window.localStorage.removeItem(y);return}catch{}try{window.document.cookie=encodeURIComponent(y)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}k.name=S,k.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},k.methodFactory=T||l,k.getLevel=function(){return b},k.setLevel=function(C,I){if(typeof C=="string"&&k.levels[C.toUpperCase()]!==void 0&&(C=k.levels[C.toUpperCase()]),typeof C=="number"&&C>=0&&C<=k.levels.SILENT){if(b=C,I!==!1&&N(C),d.call(k,C,S),typeof console===t&&C<k.levels.SILENT)return"No console available for logging"}else throw"log.setLevel() called with invalid level: "+C},k.setDefaultLevel=function(C){v=C,D()||k.setLevel(C,!1)},k.resetLevel=function(){k.setLevel(v,!1),B()},k.enableAll=function(C){k.setLevel(k.levels.TRACE,C)},k.disableAll=function(C){k.setLevel(k.levels.SILENT,C)};var A=D();A==null&&(A=v),k.setLevel(A,!1)}var p=new f,m={};p.getLogger=function(v){if(typeof v!="symbol"&&typeof v!="string"||v==="")throw new TypeError("You must supply a name when creating a logger.");var T=m[v];return T||(T=m[v]=new f(v,p.getLevel(),p.methodFactory)),T};var g=typeof window!==t?window.log:void 0;return p.noConflict=function(){return typeof window!==t&&window.log===p&&(window.log=g),p},p.getLoggers=function(){return m},p.default=p,p})})(loglevel);var LogLevel=(e=>(e[e.trace=0]="trace",e[e.debug=1]="debug",e[e.info=2]="info",e[e.warn=3]="warn",e[e.error=4]="error",e[e.silent=5]="silent",e))(LogLevel||{});const livekitLogger=loglevel.exports.getLogger("livekit");livekitLogger.setLevel(2);function setLogLevel(e){livekitLogger.setLevel(e)}var long=Long,wasm=null;try{wasm=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Long(e,i,t){this.low=e|0,this.high=i|0,this.unsigned=!!t}Long.prototype.__isLong__;Object.defineProperty(Long.prototype,"__isLong__",{value:!0});function isLong(e){return(e&&e.__isLong__)===!0}Long.isLong=isLong;var INT_CACHE={},UINT_CACHE={};function fromInt(e,i){var t,n,a;return i?(e>>>=0,(a=0<=e&&e<256)&&(n=UINT_CACHE[e],n)?n:(t=fromBits(e,(e|0)<0?-1:0,!0),a&&(UINT_CACHE[e]=t),t)):(e|=0,(a=-128<=e&&e<128)&&(n=INT_CACHE[e],n)?n:(t=fromBits(e,e<0?-1:0,!1),a&&(INT_CACHE[e]=t),t))}Long.fromInt=fromInt;function fromNumber(e,i){if(isNaN(e))return i?UZERO:ZERO;if(i){if(e<0)return UZERO;if(e>=TWO_PWR_64_DBL)return MAX_UNSIGNED_VALUE}else{if(e<=-TWO_PWR_63_DBL)return MIN_VALUE;if(e+1>=TWO_PWR_63_DBL)return MAX_VALUE}return e<0?fromNumber(-e,i).neg():fromBits(e%TWO_PWR_32_DBL|0,e/TWO_PWR_32_DBL|0,i)}Long.fromNumber=fromNumber;function fromBits(e,i,t){return new Long(e,i,t)}Long.fromBits=fromBits;var pow_dbl=Math.pow;function fromString(e,i,t){if(e.length===0)throw Error("empty string");if(e==="NaN"||e==="Infinity"||e==="+Infinity"||e==="-Infinity")return ZERO;if(typeof i=="number"?(t=i,i=!1):i=!!i,t=t||10,t<2||36<t)throw RangeError("radix");var n;if((n=e.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return fromString(e.substring(1),i,t).neg();for(var a=fromNumber(pow_dbl(t,8)),s=ZERO,o=0;o<e.length;o+=8){var c=Math.min(8,e.length-o),d=parseInt(e.substring(o,o+c),t);if(c<8){var u=fromNumber(pow_dbl(t,c));s=s.mul(u).add(fromNumber(d))}else s=s.mul(a),s=s.add(fromNumber(d))}return s.unsigned=i,s}Long.fromString=fromString;function fromValue(e,i){return typeof e=="number"?fromNumber(e,i):typeof e=="string"?fromString(e,i):fromBits(e.low,e.high,typeof i=="boolean"?i:e.unsigned)}Long.fromValue=fromValue;var TWO_PWR_16_DBL=1<<16,TWO_PWR_24_DBL=1<<24,TWO_PWR_32_DBL=TWO_PWR_16_DBL*TWO_PWR_16_DBL,TWO_PWR_64_DBL=TWO_PWR_32_DBL*TWO_PWR_32_DBL,TWO_PWR_63_DBL=TWO_PWR_64_DBL/2,TWO_PWR_24=fromInt(TWO_PWR_24_DBL),ZERO=fromInt(0);Long.ZERO=ZERO;var UZERO=fromInt(0,!0);Long.UZERO=UZERO;var ONE=fromInt(1);Long.ONE=ONE;var UONE=fromInt(1,!0);Long.UONE=UONE;var NEG_ONE=fromInt(-1);Long.NEG_ONE=NEG_ONE;var MAX_VALUE=fromBits(-1,2147483647,!1);Long.MAX_VALUE=MAX_VALUE;var MAX_UNSIGNED_VALUE=fromBits(-1,-1,!0);Long.MAX_UNSIGNED_VALUE=MAX_UNSIGNED_VALUE;var MIN_VALUE=fromBits(0,-2147483648,!1);Long.MIN_VALUE=MIN_VALUE;var LongPrototype=Long.prototype;LongPrototype.toInt=function(){return this.unsigned?this.low>>>0:this.low};LongPrototype.toNumber=function(){return this.unsigned?(this.high>>>0)*TWO_PWR_32_DBL+(this.low>>>0):this.high*TWO_PWR_32_DBL+(this.low>>>0)};LongPrototype.toString=function(i){if(i=i||10,i<2||36<i)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(MIN_VALUE)){var t=fromNumber(i),n=this.div(t),a=n.mul(t).sub(this);return n.toString(i)+a.toInt().toString(i)}else return"-"+this.neg().toString(i);for(var s=fromNumber(pow_dbl(i,6),this.unsigned),o=this,c="";;){var d=o.div(s),u=o.sub(d.mul(s)).toInt()>>>0,l=u.toString(i);if(o=d,o.isZero())return l+c;for(;l.length<6;)l="0"+l;c=""+l+c}};LongPrototype.getHighBits=function(){return this.high};LongPrototype.getHighBitsUnsigned=function(){return this.high>>>0};LongPrototype.getLowBits=function(){return this.low};LongPrototype.getLowBitsUnsigned=function(){return this.low>>>0};LongPrototype.getNumBitsAbs=function(){if(this.isNegative())return this.eq(MIN_VALUE)?64:this.neg().getNumBitsAbs();for(var i=this.high!=0?this.high:this.low,t=31;t>0&&(i&1<<t)==0;t--);return this.high!=0?t+33:t+1};LongPrototype.isZero=function(){return this.high===0&&this.low===0};LongPrototype.eqz=LongPrototype.isZero;LongPrototype.isNegative=function(){return!this.unsigned&&this.high<0};LongPrototype.isPositive=function(){return this.unsigned||this.high>=0};LongPrototype.isOdd=function(){return(this.low&1)===1};LongPrototype.isEven=function(){return(this.low&1)===0};LongPrototype.equals=function(i){return isLong(i)||(i=fromValue(i)),this.unsigned!==i.unsigned&&this.high>>>31===1&&i.high>>>31===1?!1:this.high===i.high&&this.low===i.low};LongPrototype.eq=LongPrototype.equals;LongPrototype.notEquals=function(i){return!this.eq(i)};LongPrototype.neq=LongPrototype.notEquals;LongPrototype.ne=LongPrototype.notEquals;LongPrototype.lessThan=function(i){return this.comp(i)<0};LongPrototype.lt=LongPrototype.lessThan;LongPrototype.lessThanOrEqual=function(i){return this.comp(i)<=0};LongPrototype.lte=LongPrototype.lessThanOrEqual;LongPrototype.le=LongPrototype.lessThanOrEqual;LongPrototype.greaterThan=function(i){return this.comp(i)>0};LongPrototype.gt=LongPrototype.greaterThan;LongPrototype.greaterThanOrEqual=function(i){return this.comp(i)>=0};LongPrototype.gte=LongPrototype.greaterThanOrEqual;LongPrototype.ge=LongPrototype.greaterThanOrEqual;LongPrototype.compare=function(i){if(isLong(i)||(i=fromValue(i)),this.eq(i))return 0;var t=this.isNegative(),n=i.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?i.high>>>0>this.high>>>0||i.high===this.high&&i.low>>>0>this.low>>>0?-1:1:this.sub(i).isNegative()?-1:1};LongPrototype.comp=LongPrototype.compare;LongPrototype.negate=function(){return!this.unsigned&&this.eq(MIN_VALUE)?MIN_VALUE:this.not().add(ONE)};LongPrototype.neg=LongPrototype.negate;LongPrototype.add=function(i){isLong(i)||(i=fromValue(i));var t=this.high>>>16,n=this.high&65535,a=this.low>>>16,s=this.low&65535,o=i.high>>>16,c=i.high&65535,d=i.low>>>16,u=i.low&65535,l=0,f=0,p=0,m=0;return m+=s+u,p+=m>>>16,m&=65535,p+=a+d,f+=p>>>16,p&=65535,f+=n+c,l+=f>>>16,f&=65535,l+=t+o,l&=65535,fromBits(p<<16|m,l<<16|f,this.unsigned)};LongPrototype.subtract=function(i){return isLong(i)||(i=fromValue(i)),this.add(i.neg())};LongPrototype.sub=LongPrototype.subtract;LongPrototype.multiply=function(i){if(this.isZero())return ZERO;if(isLong(i)||(i=fromValue(i)),wasm){var t=wasm.mul(this.low,this.high,i.low,i.high);return fromBits(t,wasm.get_high(),this.unsigned)}if(i.isZero())return ZERO;if(this.eq(MIN_VALUE))return i.isOdd()?MIN_VALUE:ZERO;if(i.eq(MIN_VALUE))return this.isOdd()?MIN_VALUE:ZERO;if(this.isNegative())return i.isNegative()?this.neg().mul(i.neg()):this.neg().mul(i).neg();if(i.isNegative())return this.mul(i.neg()).neg();if(this.lt(TWO_PWR_24)&&i.lt(TWO_PWR_24))return fromNumber(this.toNumber()*i.toNumber(),this.unsigned);var n=this.high>>>16,a=this.high&65535,s=this.low>>>16,o=this.low&65535,c=i.high>>>16,d=i.high&65535,u=i.low>>>16,l=i.low&65535,f=0,p=0,m=0,g=0;return g+=o*l,m+=g>>>16,g&=65535,m+=s*l,p+=m>>>16,m&=65535,m+=o*u,p+=m>>>16,m&=65535,p+=a*l,f+=p>>>16,p&=65535,p+=s*u,f+=p>>>16,p&=65535,p+=o*d,f+=p>>>16,p&=65535,f+=n*l+a*u+s*d+o*c,f&=65535,fromBits(m<<16|g,f<<16|p,this.unsigned)};LongPrototype.mul=LongPrototype.multiply;LongPrototype.divide=function(i){if(isLong(i)||(i=fromValue(i)),i.isZero())throw Error("division by zero");if(wasm){if(!this.unsigned&&this.high===-2147483648&&i.low===-1&&i.high===-1)return this;var t=(this.unsigned?wasm.div_u:wasm.div_s)(this.low,this.high,i.low,i.high);return fromBits(t,wasm.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?UZERO:ZERO;var n,a,s;if(this.unsigned){if(i.unsigned||(i=i.toUnsigned()),i.gt(this))return UZERO;if(i.gt(this.shru(1)))return UONE;s=UZERO}else{if(this.eq(MIN_VALUE)){if(i.eq(ONE)||i.eq(NEG_ONE))return MIN_VALUE;if(i.eq(MIN_VALUE))return ONE;var o=this.shr(1);return n=o.div(i).shl(1),n.eq(ZERO)?i.isNegative()?ONE:NEG_ONE:(a=this.sub(i.mul(n)),s=n.add(a.div(i)),s)}else if(i.eq(MIN_VALUE))return this.unsigned?UZERO:ZERO;if(this.isNegative())return i.isNegative()?this.neg().div(i.neg()):this.neg().div(i).neg();if(i.isNegative())return this.div(i.neg()).neg();s=ZERO}for(a=this;a.gte(i);){n=Math.max(1,Math.floor(a.toNumber()/i.toNumber()));for(var c=Math.ceil(Math.log(n)/Math.LN2),d=c<=48?1:pow_dbl(2,c-48),u=fromNumber(n),l=u.mul(i);l.isNegative()||l.gt(a);)n-=d,u=fromNumber(n,this.unsigned),l=u.mul(i);u.isZero()&&(u=ONE),s=s.add(u),a=a.sub(l)}return s};LongPrototype.div=LongPrototype.divide;LongPrototype.modulo=function(i){if(isLong(i)||(i=fromValue(i)),wasm){var t=(this.unsigned?wasm.rem_u:wasm.rem_s)(this.low,this.high,i.low,i.high);return fromBits(t,wasm.get_high(),this.unsigned)}return this.sub(this.div(i).mul(i))};LongPrototype.mod=LongPrototype.modulo;LongPrototype.rem=LongPrototype.modulo;LongPrototype.not=function(){return fromBits(~this.low,~this.high,this.unsigned)};LongPrototype.and=function(i){return isLong(i)||(i=fromValue(i)),fromBits(this.low&i.low,this.high&i.high,this.unsigned)};LongPrototype.or=function(i){return isLong(i)||(i=fromValue(i)),fromBits(this.low|i.low,this.high|i.high,this.unsigned)};LongPrototype.xor=function(i){return isLong(i)||(i=fromValue(i)),fromBits(this.low^i.low,this.high^i.high,this.unsigned)};LongPrototype.shiftLeft=function(i){return isLong(i)&&(i=i.toInt()),(i&=63)===0?this:i<32?fromBits(this.low<<i,this.high<<i|this.low>>>32-i,this.unsigned):fromBits(0,this.low<<i-32,this.unsigned)};LongPrototype.shl=LongPrototype.shiftLeft;LongPrototype.shiftRight=function(i){return isLong(i)&&(i=i.toInt()),(i&=63)===0?this:i<32?fromBits(this.low>>>i|this.high<<32-i,this.high>>i,this.unsigned):fromBits(this.high>>i-32,this.high>=0?0:-1,this.unsigned)};LongPrototype.shr=LongPrototype.shiftRight;LongPrototype.shiftRightUnsigned=function(i){if(isLong(i)&&(i=i.toInt()),i&=63,i===0)return this;var t=this.high;if(i<32){var n=this.low;return fromBits(n>>>i|t<<32-i,t>>>i,this.unsigned)}else return i===32?fromBits(t,0,this.unsigned):fromBits(t>>>i-32,0,this.unsigned)};LongPrototype.shru=LongPrototype.shiftRightUnsigned;LongPrototype.shr_u=LongPrototype.shiftRightUnsigned;LongPrototype.toSigned=function(){return this.unsigned?fromBits(this.low,this.high,!1):this};LongPrototype.toUnsigned=function(){return this.unsigned?this:fromBits(this.low,this.high,!0)};LongPrototype.toBytes=function(i){return i?this.toBytesLE():this.toBytesBE()};LongPrototype.toBytesLE=function(){var i=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,i&255,i>>>8&255,i>>>16&255,i>>>24]};LongPrototype.toBytesBE=function(){var i=this.high,t=this.low;return[i>>>24,i>>>16&255,i>>>8&255,i&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};Long.fromBytes=function(i,t,n){return n?Long.fromBytesLE(i,t):Long.fromBytesBE(i,t)};Long.fromBytesLE=function(i,t){return new Long(i[0]|i[1]<<8|i[2]<<16|i[3]<<24,i[4]|i[5]<<8|i[6]<<16|i[7]<<24,t)};Long.fromBytesBE=function(i,t){return new Long(i[4]<<24|i[5]<<16|i[6]<<8|i[7],i[0]<<24|i[1]<<16|i[2]<<8|i[3],t)};var minimal$1={exports:{}},indexMinimal={},minimal={},aspromise=asPromise;function asPromise(e,i){for(var t=new Array(arguments.length-1),n=0,a=2,s=!0;a<arguments.length;)t[n++]=arguments[a++];return new Promise(function(c,d){t[n]=function(l){if(s)if(s=!1,l)d(l);else{for(var f=new Array(arguments.length-1),p=0;p<f.length;)f[p++]=arguments[p];c.apply(null,f)}};try{e.apply(i||null,t)}catch(u){s&&(s=!1,d(u))}})}var base64$1={};(function(e){var i=e;i.length=function(c){var d=c.length;if(!d)return 0;for(var u=0;--d%4>1&&c.charAt(d)==="=";)++u;return Math.ceil(c.length*3)/4-u};for(var t=new Array(64),n=new Array(123),a=0;a<64;)n[t[a]=a<26?a+65:a<52?a+71:a<62?a-4:a-59|43]=a++;i.encode=function(c,d,u){for(var l=null,f=[],p=0,m=0,g;d<u;){var S=c[d++];switch(m){case 0:f[p++]=t[S>>2],g=(S&3)<<4,m=1;break;case 1:f[p++]=t[g|S>>4],g=(S&15)<<2,m=2;break;case 2:f[p++]=t[g|S>>6],f[p++]=t[S&63],m=0;break}p>8191&&((l||(l=[])).push(String.fromCharCode.apply(String,f)),p=0)}return m&&(f[p++]=t[g],f[p++]=61,m===1&&(f[p++]=61)),l?(p&&l.push(String.fromCharCode.apply(String,f.slice(0,p))),l.join("")):String.fromCharCode.apply(String,f.slice(0,p))};var s="invalid encoding";i.decode=function(c,d,u){for(var l=u,f=0,p,m=0;m<c.length;){var g=c.charCodeAt(m++);if(g===61&&f>1)break;if((g=n[g])===void 0)throw Error(s);switch(f){case 0:p=g,f=1;break;case 1:d[u++]=p<<2|(g&48)>>4,p=g,f=2;break;case 2:d[u++]=(p&15)<<4|(g&60)>>2,p=g,f=3;break;case 3:d[u++]=(p&3)<<6|g,f=0;break}}if(f===1)throw Error(s);return u-l},i.test=function(c){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(c)}})(base64$1);var eventemitter=EventEmitter$1;function EventEmitter$1(){this._listeners={}}EventEmitter$1.prototype.on=function(i,t,n){return(this._listeners[i]||(this._listeners[i]=[])).push({fn:t,ctx:n||this}),this};EventEmitter$1.prototype.off=function(i,t){if(i===void 0)this._listeners={};else if(t===void 0)this._listeners[i]=[];else for(var n=this._listeners[i],a=0;a<n.length;)n[a].fn===t?n.splice(a,1):++a;return this};EventEmitter$1.prototype.emit=function(i){var t=this._listeners[i];if(t){for(var n=[],a=1;a<arguments.length;)n.push(arguments[a++]);for(a=0;a<t.length;)t[a].fn.apply(t[a++].ctx,n)}return this};var float=factory(factory);function factory(e){return typeof Float32Array<"u"?function(){var i=new Float32Array([-0]),t=new Uint8Array(i.buffer),n=t[3]===128;function a(d,u,l){i[0]=d,u[l]=t[0],u[l+1]=t[1],u[l+2]=t[2],u[l+3]=t[3]}function s(d,u,l){i[0]=d,u[l]=t[3],u[l+1]=t[2],u[l+2]=t[1],u[l+3]=t[0]}e.writeFloatLE=n?a:s,e.writeFloatBE=n?s:a;function o(d,u){return t[0]=d[u],t[1]=d[u+1],t[2]=d[u+2],t[3]=d[u+3],i[0]}function c(d,u){return t[3]=d[u],t[2]=d[u+1],t[1]=d[u+2],t[0]=d[u+3],i[0]}e.readFloatLE=n?o:c,e.readFloatBE=n?c:o}():function(){function i(n,a,s,o){var c=a<0?1:0;if(c&&(a=-a),a===0)n(1/a>0?0:2147483648,s,o);else if(isNaN(a))n(2143289344,s,o);else if(a>34028234663852886e22)n((c<<31|2139095040)>>>0,s,o);else if(a<11754943508222875e-54)n((c<<31|Math.round(a/1401298464324817e-60))>>>0,s,o);else{var d=Math.floor(Math.log(a)/Math.LN2),u=Math.round(a*Math.pow(2,-d)*8388608)&8388607;n((c<<31|d+127<<23|u)>>>0,s,o)}}e.writeFloatLE=i.bind(null,writeUintLE),e.writeFloatBE=i.bind(null,writeUintBE);function t(n,a,s){var o=n(a,s),c=(o>>31)*2+1,d=o>>>23&255,u=o&8388607;return d===255?u?NaN:c*(1/0):d===0?c*1401298464324817e-60*u:c*Math.pow(2,d-150)*(u+8388608)}e.readFloatLE=t.bind(null,readUintLE),e.readFloatBE=t.bind(null,readUintBE)}(),typeof Float64Array<"u"?function(){var i=new Float64Array([-0]),t=new Uint8Array(i.buffer),n=t[7]===128;function a(d,u,l){i[0]=d,u[l]=t[0],u[l+1]=t[1],u[l+2]=t[2],u[l+3]=t[3],u[l+4]=t[4],u[l+5]=t[5],u[l+6]=t[6],u[l+7]=t[7]}function s(d,u,l){i[0]=d,u[l]=t[7],u[l+1]=t[6],u[l+2]=t[5],u[l+3]=t[4],u[l+4]=t[3],u[l+5]=t[2],u[l+6]=t[1],u[l+7]=t[0]}e.writeDoubleLE=n?a:s,e.writeDoubleBE=n?s:a;function o(d,u){return t[0]=d[u],t[1]=d[u+1],t[2]=d[u+2],t[3]=d[u+3],t[4]=d[u+4],t[5]=d[u+5],t[6]=d[u+6],t[7]=d[u+7],i[0]}function c(d,u){return t[7]=d[u],t[6]=d[u+1],t[5]=d[u+2],t[4]=d[u+3],t[3]=d[u+4],t[2]=d[u+5],t[1]=d[u+6],t[0]=d[u+7],i[0]}e.readDoubleLE=n?o:c,e.readDoubleBE=n?c:o}():function(){function i(n,a,s,o,c,d){var u=o<0?1:0;if(u&&(o=-o),o===0)n(0,c,d+a),n(1/o>0?0:2147483648,c,d+s);else if(isNaN(o))n(0,c,d+a),n(2146959360,c,d+s);else if(o>17976931348623157e292)n(0,c,d+a),n((u<<31|2146435072)>>>0,c,d+s);else{var l;if(o<22250738585072014e-324)l=o/5e-324,n(l>>>0,c,d+a),n((u<<31|l/4294967296)>>>0,c,d+s);else{var f=Math.floor(Math.log(o)/Math.LN2);f===1024&&(f=1023),l=o*Math.pow(2,-f),n(l*4503599627370496>>>0,c,d+a),n((u<<31|f+1023<<20|l*1048576&1048575)>>>0,c,d+s)}}}e.writeDoubleLE=i.bind(null,writeUintLE,0,4),e.writeDoubleBE=i.bind(null,writeUintBE,4,0);function t(n,a,s,o,c){var d=n(o,c+a),u=n(o,c+s),l=(u>>31)*2+1,f=u>>>20&2047,p=4294967296*(u&1048575)+d;return f===2047?p?NaN:l*(1/0):f===0?l*5e-324*p:l*Math.pow(2,f-1075)*(p+4503599627370496)}e.readDoubleLE=t.bind(null,readUintLE,0,4),e.readDoubleBE=t.bind(null,readUintBE,4,0)}(),e}function writeUintLE(e,i,t){i[t]=e&255,i[t+1]=e>>>8&255,i[t+2]=e>>>16&255,i[t+3]=e>>>24}function writeUintBE(e,i,t){i[t]=e>>>24,i[t+1]=e>>>16&255,i[t+2]=e>>>8&255,i[t+3]=e&255}function readUintLE(e,i){return(e[i]|e[i+1]<<8|e[i+2]<<16|e[i+3]<<24)>>>0}function readUintBE(e,i){return(e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3])>>>0}var inquire_1=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}var utf8$2={};(function(e){var i=e;i.length=function(n){for(var a=0,s=0,o=0;o<n.length;++o)s=n.charCodeAt(o),s<128?a+=1:s<2048?a+=2:(s&64512)===55296&&(n.charCodeAt(o+1)&64512)===56320?(++o,a+=4):a+=3;return a},i.read=function(n,a,s){var o=s-a;if(o<1)return"";for(var c=null,d=[],u=0,l;a<s;)l=n[a++],l<128?d[u++]=l:l>191&&l<224?d[u++]=(l&31)<<6|n[a++]&63:l>239&&l<365?(l=((l&7)<<18|(n[a++]&63)<<12|(n[a++]&63)<<6|n[a++]&63)-65536,d[u++]=55296+(l>>10),d[u++]=56320+(l&1023)):d[u++]=(l&15)<<12|(n[a++]&63)<<6|n[a++]&63,u>8191&&((c||(c=[])).push(String.fromCharCode.apply(String,d)),u=0);return c?(u&&c.push(String.fromCharCode.apply(String,d.slice(0,u))),c.join("")):String.fromCharCode.apply(String,d.slice(0,u))},i.write=function(n,a,s){for(var o=s,c,d,u=0;u<n.length;++u)c=n.charCodeAt(u),c<128?a[s++]=c:c<2048?(a[s++]=c>>6|192,a[s++]=c&63|128):(c&64512)===55296&&((d=n.charCodeAt(u+1))&64512)===56320?(c=65536+((c&1023)<<10)+(d&1023),++u,a[s++]=c>>18|240,a[s++]=c>>12&63|128,a[s++]=c>>6&63|128,a[s++]=c&63|128):(a[s++]=c>>12|224,a[s++]=c>>6&63|128,a[s++]=c&63|128);return s-o}})(utf8$2);var pool_1=pool;function pool(e,i,t){var n=t||8192,a=n>>>1,s=null,o=n;return function(d){if(d<1||d>a)return e(d);o+d>n&&(s=e(n),o=0);var u=i.call(s,o,o+=d);return o&7&&(o=(o|7)+1),u}}var longbits,hasRequiredLongbits;function requireLongbits(){if(hasRequiredLongbits)return longbits;hasRequiredLongbits=1,longbits=i;var e=requireMinimal();function i(s,o){this.lo=s>>>0,this.hi=o>>>0}var t=i.zero=new i(0,0);t.toNumber=function(){return 0},t.zzEncode=t.zzDecode=function(){return this},t.length=function(){return 1};var n=i.zeroHash="\0\0\0\0\0\0\0\0";i.fromNumber=function(o){if(o===0)return t;var c=o<0;c&&(o=-o);var d=o>>>0,u=(o-d)/4294967296>>>0;return c&&(u=~u>>>0,d=~d>>>0,++d>4294967295&&(d=0,++u>4294967295&&(u=0))),new i(d,u)},i.from=function(o){if(typeof o=="number")return i.fromNumber(o);if(e.isString(o))if(e.Long)o=e.Long.fromString(o);else return i.fromNumber(parseInt(o,10));return o.low||o.high?new i(o.low>>>0,o.high>>>0):t},i.prototype.toNumber=function(o){if(!o&&this.hi>>>31){var c=~this.lo+1>>>0,d=~this.hi>>>0;return c||(d=d+1>>>0),-(c+d*4294967296)}return this.lo+this.hi*4294967296},i.prototype.toLong=function(o){return e.Long?new e.Long(this.lo|0,this.hi|0,Boolean(o)):{low:this.lo|0,high:this.hi|0,unsigned:Boolean(o)}};var a=String.prototype.charCodeAt;return i.fromHash=function(o){return o===n?t:new i((a.call(o,0)|a.call(o,1)<<8|a.call(o,2)<<16|a.call(o,3)<<24)>>>0,(a.call(o,4)|a.call(o,5)<<8|a.call(o,6)<<16|a.call(o,7)<<24)>>>0)},i.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},i.prototype.zzEncode=function(){var o=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^o)>>>0,this.lo=(this.lo<<1^o)>>>0,this},i.prototype.zzDecode=function(){var o=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^o)>>>0,this.hi=(this.hi>>>1^o)>>>0,this},i.prototype.length=function(){var o=this.lo,c=(this.lo>>>28|this.hi<<4)>>>0,d=this.hi>>>24;return d===0?c===0?o<16384?o<128?1:2:o<2097152?3:4:c<16384?c<128?5:6:c<2097152?7:8:d<128?9:10},longbits}var hasRequiredMinimal;function requireMinimal(){return hasRequiredMinimal||(hasRequiredMinimal=1,function(e){var i=e;i.asPromise=aspromise,i.base64=base64$1,i.EventEmitter=eventemitter,i.float=float,i.inquire=inquire_1,i.utf8=utf8$2,i.pool=pool_1,i.LongBits=requireLongbits(),i.isNode=Boolean(typeof commonjsGlobal<"u"&&commonjsGlobal&&commonjsGlobal.process&&commonjsGlobal.process.versions&&commonjsGlobal.process.versions.node),i.global=i.isNode&&commonjsGlobal||typeof window<"u"&&window||typeof self<"u"&&self||commonjsGlobal,i.emptyArray=Object.freeze?Object.freeze([]):[],i.emptyObject=Object.freeze?Object.freeze({}):{},i.isInteger=Number.isInteger||function(s){return typeof s=="number"&&isFinite(s)&&Math.floor(s)===s},i.isString=function(s){return typeof s=="string"||s instanceof String},i.isObject=function(s){return s&&typeof s=="object"},i.isset=i.isSet=function(s,o){var c=s[o];return c!=null&&s.hasOwnProperty(o)?typeof c!="object"||(Array.isArray(c)?c.length:Object.keys(c).length)>0:!1},i.Buffer=function(){try{var a=i.inquire("buffer").Buffer;return a.prototype.utf8Write?a:null}catch{return null}}(),i._Buffer_from=null,i._Buffer_allocUnsafe=null,i.newBuffer=function(s){return typeof s=="number"?i.Buffer?i._Buffer_allocUnsafe(s):new i.Array(s):i.Buffer?i._Buffer_from(s):typeof Uint8Array>"u"?s:new Uint8Array(s)},i.Array=typeof Uint8Array<"u"?Uint8Array:Array,i.Long=i.global.dcodeIO&&i.global.dcodeIO.Long||i.global.Long||i.inquire("long"),i.key2Re=/^true|false|0|1$/,i.key32Re=/^-?(?:0|[1-9][0-9]*)$/,i.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,i.longToHash=function(s){return s?i.LongBits.from(s).toHash():i.LongBits.zeroHash},i.longFromHash=function(s,o){var c=i.LongBits.fromHash(s);return i.Long?i.Long.fromBits(c.lo,c.hi,o):c.toNumber(Boolean(o))};function t(a,s,o){for(var c=Object.keys(s),d=0;d<c.length;++d)(a[c[d]]===void 0||!o)&&(a[c[d]]=s[c[d]]);return a}i.merge=t,i.lcFirst=function(s){return s.charAt(0).toLowerCase()+s.substring(1)};function n(a){function s(o,c){if(!(this instanceof s))return new s(o,c);Object.defineProperty(this,"message",{get:function(){return o}}),Error.captureStackTrace?Error.captureStackTrace(this,s):Object.defineProperty(this,"stack",{value:new Error().stack||""}),c&&t(this,c)}return s.prototype=Object.create(Error.prototype,{constructor:{value:s,writable:!0,enumerable:!1,configurable:!0},name:{get(){return a},set:void 0,enumerable:!1,configurable:!0},toString:{value(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),s}i.newError=n,i.ProtocolError=n("ProtocolError"),i.oneOfGetter=function(s){for(var o={},c=0;c<s.length;++c)o[s[c]]=1;return function(){for(var d=Object.keys(this),u=d.length-1;u>-1;--u)if(o[d[u]]===1&&this[d[u]]!==void 0&&this[d[u]]!==null)return d[u]}},i.oneOfSetter=function(s){return function(o){for(var c=0;c<s.length;++c)s[c]!==o&&delete this[s[c]]}},i.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},i._configure=function(){var a=i.Buffer;if(!a){i._Buffer_from=i._Buffer_allocUnsafe=null;return}i._Buffer_from=a.from!==Uint8Array.from&&a.from||function(o,c){return new a(o,c)},i._Buffer_allocUnsafe=a.allocUnsafe||function(o){return new a(o)}}}(minimal)),minimal}var writer$2=Writer$1,util$4=requireMinimal(),BufferWriter$1,LongBits$1=util$4.LongBits,base64=util$4.base64,utf8$1=util$4.utf8;function Op(e,i,t){this.fn=e,this.len=i,this.next=void 0,this.val=t}function noop(){}function State(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function Writer$1(){this.len=0,this.head=new Op(noop,0,0),this.tail=this.head,this.states=null}var create$1=function e(){return util$4.Buffer?function(){return(Writer$1.create=function(){return new BufferWriter$1})()}:function(){return new Writer$1}};Writer$1.create=create$1();Writer$1.alloc=function e(i){return new util$4.Array(i)};util$4.Array!==Array&&(Writer$1.alloc=util$4.pool(Writer$1.alloc,util$4.Array.prototype.subarray));Writer$1.prototype._push=function e(i,t,n){return this.tail=this.tail.next=new Op(i,t,n),this.len+=t,this};function writeByte(e,i,t){i[t]=e&255}function writeVarint32(e,i,t){for(;e>127;)i[t++]=e&127|128,e>>>=7;i[t]=e}function VarintOp(e,i){this.len=e,this.next=void 0,this.val=i}VarintOp.prototype=Object.create(Op.prototype);VarintOp.prototype.fn=writeVarint32;Writer$1.prototype.uint32=function e(i){return this.len+=(this.tail=this.tail.next=new VarintOp((i=i>>>0)<128?1:i<16384?2:i<2097152?3:i<268435456?4:5,i)).len,this};Writer$1.prototype.int32=function e(i){return i<0?this._push(writeVarint64,10,LongBits$1.fromNumber(i)):this.uint32(i)};Writer$1.prototype.sint32=function e(i){return this.uint32((i<<1^i>>31)>>>0)};function writeVarint64(e,i,t){for(;e.hi;)i[t++]=e.lo&127|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)i[t++]=e.lo&127|128,e.lo=e.lo>>>7;i[t++]=e.lo}Writer$1.prototype.uint64=function e(i){var t=LongBits$1.from(i);return this._push(writeVarint64,t.length(),t)};Writer$1.prototype.int64=Writer$1.prototype.uint64;Writer$1.prototype.sint64=function e(i){var t=LongBits$1.from(i).zzEncode();return this._push(writeVarint64,t.length(),t)};Writer$1.prototype.bool=function e(i){return this._push(writeByte,1,i?1:0)};function writeFixed32(e,i,t){i[t]=e&255,i[t+1]=e>>>8&255,i[t+2]=e>>>16&255,i[t+3]=e>>>24}Writer$1.prototype.fixed32=function e(i){return this._push(writeFixed32,4,i>>>0)};Writer$1.prototype.sfixed32=Writer$1.prototype.fixed32;Writer$1.prototype.fixed64=function e(i){var t=LongBits$1.from(i);return this._push(writeFixed32,4,t.lo)._push(writeFixed32,4,t.hi)};Writer$1.prototype.sfixed64=Writer$1.prototype.fixed64;Writer$1.prototype.float=function e(i){return this._push(util$4.float.writeFloatLE,4,i)};Writer$1.prototype.double=function e(i){return this._push(util$4.float.writeDoubleLE,8,i)};var writeBytes=util$4.Array.prototype.set?function e(i,t,n){t.set(i,n)}:function e(i,t,n){for(var a=0;a<i.length;++a)t[n+a]=i[a]};Writer$1.prototype.bytes=function e(i){var t=i.length>>>0;if(!t)return this._push(writeByte,1,0);if(util$4.isString(i)){var n=Writer$1.alloc(t=base64.length(i));base64.decode(i,n,0),i=n}return this.uint32(t)._push(writeBytes,t,i)};Writer$1.prototype.string=function e(i){var t=utf8$1.length(i);return t?this.uint32(t)._push(utf8$1.write,t,i):this._push(writeByte,1,0)};Writer$1.prototype.fork=function e(){return this.states=new State(this),this.head=this.tail=new Op(noop,0,0),this.len=0,this};Writer$1.prototype.reset=function e(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop,0,0),this.len=0),this};Writer$1.prototype.ldelim=function e(){var i=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=i.next,this.tail=t,this.len+=n),this};Writer$1.prototype.finish=function e(){for(var i=this.head.next,t=this.constructor.alloc(this.len),n=0;i;)i.fn(i.val,t,n),n+=i.len,i=i.next;return t};Writer$1._configure=function(e){BufferWriter$1=e,Writer$1.create=create$1(),BufferWriter$1._configure()};var writer_buffer=BufferWriter,Writer=writer$2;(BufferWriter.prototype=Object.create(Writer.prototype)).constructor=BufferWriter;var util$3=requireMinimal();function BufferWriter(){Writer.call(this)}BufferWriter._configure=function(){BufferWriter.alloc=util$3._Buffer_allocUnsafe,BufferWriter.writeBytesBuffer=util$3.Buffer&&util$3.Buffer.prototype instanceof Uint8Array&&util$3.Buffer.prototype.set.name==="set"?function(i,t,n){t.set(i,n)}:function(i,t,n){if(i.copy)i.copy(t,n,0,i.length);else for(var a=0;a<i.length;)t[n++]=i[a++]}};BufferWriter.prototype.bytes=function e(i){util$3.isString(i)&&(i=util$3._Buffer_from(i,"base64"));var t=i.length>>>0;return this.uint32(t),t&&this._push(BufferWriter.writeBytesBuffer,t,i),this};function writeStringBuffer(e,i,t){e.length<40?util$3.utf8.write(e,i,t):i.utf8Write?i.utf8Write(e,t):i.write(e,t)}BufferWriter.prototype.string=function e(i){var t=util$3.Buffer.byteLength(i);return this.uint32(t),t&&this._push(writeStringBuffer,t,i),this};BufferWriter._configure();var reader=Reader$1,util$2=requireMinimal(),BufferReader$1,LongBits=util$2.LongBits,utf8=util$2.utf8;function indexOutOfRange(e,i){return RangeError("index out of range: "+e.pos+" + "+(i||1)+" > "+e.len)}function Reader$1(e){this.buf=e,this.pos=0,this.len=e.length}var create_array=typeof Uint8Array<"u"?function e(i){if(i instanceof Uint8Array||Array.isArray(i))return new Reader$1(i);throw Error("illegal buffer")}:function e(i){if(Array.isArray(i))return new Reader$1(i);throw Error("illegal buffer")},create=function e(){return util$2.Buffer?function(t){return(Reader$1.create=function(a){return util$2.Buffer.isBuffer(a)?new BufferReader$1(a):create_array(a)})(t)}:create_array};Reader$1.create=create();Reader$1.prototype._slice=util$2.Array.prototype.subarray||util$2.Array.prototype.slice;Reader$1.prototype.uint32=function e(){var i=4294967295;return function(){if(i=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(i=(i|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(i=(i|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(i=(i|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(i=(i|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return i;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return i}}();Reader$1.prototype.int32=function e(){return this.uint32()|0};Reader$1.prototype.sint32=function e(){var i=this.uint32();return i>>>1^-(i&1)|0};function readLongVarint(){var e=new LongBits(0,0),i=0;if(this.len-this.pos>4){for(;i<4;++i)if(e.lo=(e.lo|(this.buf[this.pos]&127)<<i*7)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(this.buf[this.pos]&127)<<28)>>>0,e.hi=(e.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return e;i=0}else{for(;i<3;++i){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.lo=(e.lo|(this.buf[this.pos]&127)<<i*7)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(this.buf[this.pos++]&127)<<i*7)>>>0,e}if(this.len-this.pos>4){for(;i<5;++i)if(e.hi=(e.hi|(this.buf[this.pos]&127)<<i*7+3)>>>0,this.buf[this.pos++]<128)return e}else for(;i<5;++i){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.hi=(e.hi|(this.buf[this.pos]&127)<<i*7+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}Reader$1.prototype.bool=function e(){return this.uint32()!==0};function readFixed32_end(e,i){return(e[i-4]|e[i-3]<<8|e[i-2]<<16|e[i-1]<<24)>>>0}Reader$1.prototype.fixed32=function e(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)};Reader$1.prototype.sfixed32=function e(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)|0};function readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);return new LongBits(readFixed32_end(this.buf,this.pos+=4),readFixed32_end(this.buf,this.pos+=4))}Reader$1.prototype.float=function e(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);var i=util$2.float.readFloatLE(this.buf,this.pos);return this.pos+=4,i};Reader$1.prototype.double=function e(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);var i=util$2.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,i};Reader$1.prototype.bytes=function e(){var i=this.uint32(),t=this.pos,n=this.pos+i;if(n>this.len)throw indexOutOfRange(this,i);return this.pos+=i,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)};Reader$1.prototype.string=function e(){var i=this.bytes();return utf8.read(i,0,i.length)};Reader$1.prototype.skip=function e(i){if(typeof i=="number"){if(this.pos+i>this.len)throw indexOutOfRange(this,i);this.pos+=i}else do if(this.pos>=this.len)throw indexOutOfRange(this);while(this.buf[this.pos++]&128);return this};Reader$1.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=this.uint32()&7)!==4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this};Reader$1._configure=function(e){BufferReader$1=e,Reader$1.create=create(),BufferReader$1._configure();var i=util$2.Long?"toLong":"toNumber";util$2.merge(Reader$1.prototype,{int64:function(){return readLongVarint.call(this)[i](!1)},uint64:function(){return readLongVarint.call(this)[i](!0)},sint64:function(){return readLongVarint.call(this).zzDecode()[i](!1)},fixed64:function(){return readFixed64.call(this)[i](!0)},sfixed64:function(){return readFixed64.call(this)[i](!1)}})};var reader_buffer=BufferReader,Reader=reader;(BufferReader.prototype=Object.create(Reader.prototype)).constructor=BufferReader;var util$1=requireMinimal();function BufferReader(e){Reader.call(this,e)}BufferReader._configure=function(){util$1.Buffer&&(BufferReader.prototype._slice=util$1.Buffer.prototype.slice)};BufferReader.prototype.string=function e(){var i=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+i,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+i,this.len))};BufferReader._configure();var rpc={},service=Service,util=requireMinimal();(Service.prototype=Object.create(util.EventEmitter.prototype)).constructor=Service;function Service(e,i,t){if(typeof e!="function")throw TypeError("rpcImpl must be a function");util.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(i),this.responseDelimited=Boolean(t)}Service.prototype.rpcCall=function e(i,t,n,a,s){if(!a)throw TypeError("request must be specified");var o=this;if(!s)return util.asPromise(e,o,i,t,n,a);if(!o.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return o.rpcImpl(i,t[o.requestDelimited?"encodeDelimited":"encode"](a).finish(),function(d,u){if(d)return o.emit("error",d,i),s(d);if(u===null){o.end(!0);return}if(!(u instanceof n))try{u=n[o.responseDelimited?"decodeDelimited":"decode"](u)}catch(l){return o.emit("error",l,i),s(l)}return o.emit("data",u,i),s(null,u)})}catch(c){o.emit("error",c,i),setTimeout(function(){s(c)},0);return}};Service.prototype.end=function e(i){return this.rpcImpl&&(i||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};(function(e){var i=e;i.Service=service})(rpc);var roots={};(function(e){var i=e;i.build="minimal",i.Writer=writer$2,i.BufferWriter=writer_buffer,i.Reader=reader,i.BufferReader=reader_buffer,i.util=requireMinimal(),i.rpc=rpc,i.roots=roots,i.configure=t;function t(){i.util._configure(),i.Writer._configure(i.BufferWriter),i.Reader._configure(i.BufferReader)}t()})(indexMinimal);(function(e){e.exports=indexMinimal})(minimal$1);const _m0=getDefaultExportFromCjs(minimal$1.exports);(()=>{if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw"Unable to locate global object"})();_m0.util.Long!==long&&(_m0.util.Long=long,_m0.configure());var TrackType=(e=>(e[e.AUDIO=0]="AUDIO",e[e.VIDEO=1]="VIDEO",e[e.DATA=2]="DATA",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e))(TrackType||{});function trackTypeFromJSON(e){switch(e){case 0:case"AUDIO":return 0;case 1:case"VIDEO":return 1;case 2:case"DATA":return 2;case-1:case"UNRECOGNIZED":default:return-1}}function trackTypeToJSON(e){switch(e){case 0:return"AUDIO";case 1:return"VIDEO";case 2:return"DATA";case-1:default:return"UNRECOGNIZED"}}var TrackSource=(e=>(e[e.UNKNOWN=0]="UNKNOWN",e[e.CAMERA=1]="CAMERA",e[e.MICROPHONE=2]="MICROPHONE",e[e.SCREEN_SHARE=3]="SCREEN_SHARE",e[e.SCREEN_SHARE_AUDIO=4]="SCREEN_SHARE_AUDIO",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e))(TrackSource||{});function trackSourceFromJSON(e){switch(e){case 0:case"UNKNOWN":return 0;case 1:case"CAMERA":return 1;case 2:case"MICROPHONE":return 2;case 3:case"SCREEN_SHARE":return 3;case 4:case"SCREEN_SHARE_AUDIO":return 4;case-1:case"UNRECOGNIZED":default:return-1}}function trackSourceToJSON(e){switch(e){case 0:return"UNKNOWN";case 1:return"CAMERA";case 2:return"MICROPHONE";case 3:return"SCREEN_SHARE";case 4:return"SCREEN_SHARE_AUDIO";case-1:default:return"UNRECOGNIZED"}}var VideoQuality=(e=>(e[e.LOW=0]="LOW",e[e.MEDIUM=1]="MEDIUM",e[e.HIGH=2]="HIGH",e[e.OFF=3]="OFF",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e))(VideoQuality||{});function videoQualityFromJSON(e){switch(e){case 0:case"LOW":return 0;case 1:case"MEDIUM":return 1;case 2:case"HIGH":return 2;case 3:case"OFF":return 3;case-1:case"UNRECOGNIZED":default:return-1}}function videoQualityToJSON(e){switch(e){case 0:return"LOW";case 1:return"MEDIUM";case 2:return"HIGH";case 3:return"OFF";case-1:default:return"UNRECOGNIZED"}}var ConnectionQuality$1=(e=>(e[e.POOR=0]="POOR",e[e.GOOD=1]="GOOD",e[e.EXCELLENT=2]="EXCELLENT",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e))(ConnectionQuality$1||{});function connectionQualityFromJSON(e){switch(e){case 0:case"POOR":return 0;case 1:case"GOOD":return 1;case 2:case"EXCELLENT":return 2;case-1:case"UNRECOGNIZED":default:return-1}}function connectionQualityToJSON(e){switch(e){case 0:return"POOR";case 1:return"GOOD";case 2:return"EXCELLENT";case-1:default:return"UNRECOGNIZED"}}var ClientConfigSetting=(e=>(e[e.UNSET=0]="UNSET",e[e.DISABLED=1]="DISABLED",e[e.ENABLED=2]="ENABLED",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e))(ClientConfigSetting||{});function clientConfigSettingFromJSON(e){switch(e){case 0:case"UNSET":return 0;case 1:case"DISABLED":return 1;case 2:case"ENABLED":return 2;case-1:case"UNRECOGNIZED":default:return-1}}function clientConfigSettingToJSON(e){switch(e){case 0:return"UNSET";case 1:return"DISABLED";case 2:return"ENABLED";case-1:default:return"UNRECOGNIZED"}}var DisconnectReason=(e=>(e[e.UNKNOWN_REASON=0]="UNKNOWN_REASON",e[e.CLIENT_INITIATED=1]="CLIENT_INITIATED",e[e.DUPLICATE_IDENTITY=2]="DUPLICATE_IDENTITY",e[e.SERVER_SHUTDOWN=3]="SERVER_SHUTDOWN",e[e.PARTICIPANT_REMOVED=4]="PARTICIPANT_REMOVED",e[e.ROOM_DELETED=5]="ROOM_DELETED",e[e.STATE_MISMATCH=6]="STATE_MISMATCH",e[e.JOIN_FAILURE=7]="JOIN_FAILURE",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e))(DisconnectReason||{});function disconnectReasonFromJSON(e){switch(e){case 0:case"UNKNOWN_REASON":return 0;case 1:case"CLIENT_INITIATED":return 1;case 2:case"DUPLICATE_IDENTITY":return 2;case 3:case"SERVER_SHUTDOWN":return 3;case 4:case"PARTICIPANT_REMOVED":return 4;case 5:case"ROOM_DELETED":return 5;case 6:case"STATE_MISMATCH":return 6;case 7:case"JOIN_FAILURE":return 7;case-1:case"UNRECOGNIZED":default:return-1}}function disconnectReasonToJSON(e){switch(e){case 0:return"UNKNOWN_REASON";case 1:return"CLIENT_INITIATED";case 2:return"DUPLICATE_IDENTITY";case 3:return"SERVER_SHUTDOWN";case 4:return"PARTICIPANT_REMOVED";case 5:return"ROOM_DELETED";case 6:return"STATE_MISMATCH";case 7:return"JOIN_FAILURE";case-1:default:return"UNRECOGNIZED"}}var ReconnectReason=(e=>(e[e.REASON_UNKOWN=0]="REASON_UNKOWN",e[e.REASON_SIGNAL_DISCONNECTED=1]="REASON_SIGNAL_DISCONNECTED",e[e.REASON_PUBLISHER_FAILED=2]="REASON_PUBLISHER_FAILED",e[e.REASON_SUBSCRIBER_FAILED=3]="REASON_SUBSCRIBER_FAILED",e[e.REASON_SWITCH_CANDIDATE=4]="REASON_SWITCH_CANDIDATE",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e))(ReconnectReason||{}),ParticipantInfo_State=(e=>(e[e.JOINING=0]="JOINING",e[e.JOINED=1]="JOINED",e[e.ACTIVE=2]="ACTIVE",e[e.DISCONNECTED=3]="DISCONNECTED",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e))(ParticipantInfo_State||{});function participantInfo_StateFromJSON(e){switch(e){case 0:case"JOINING":return 0;case 1:case"JOINED":return 1;case 2:case"ACTIVE":return 2;case 3:case"DISCONNECTED":return 3;case-1:case"UNRECOGNIZED":default:return-1}}function participantInfo_StateToJSON(e){switch(e){case 0:return"JOINING";case 1:return"JOINED";case 2:return"ACTIVE";case 3:return"DISCONNECTED";case-1:default:return"UNRECOGNIZED"}}function encryption_TypeFromJSON(e){switch(e){case 0:case"NONE":return 0;case 1:case"GCM":return 1;case 2:case"CUSTOM":return 2;case-1:case"UNRECOGNIZED":default:return-1}}function encryption_TypeToJSON(e){switch(e){case 0:return"NONE";case 1:return"GCM";case 2:return"CUSTOM";case-1:default:return"UNRECOGNIZED"}}var DataPacket_Kind=(e=>(e[e.RELIABLE=0]="RELIABLE",e[e.LOSSY=1]="LOSSY",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e))(DataPacket_Kind||{});function dataPacket_KindFromJSON(e){switch(e){case 0:case"RELIABLE":return 0;case 1:case"LOSSY":return 1;case-1:case"UNRECOGNIZED":default:return-1}}function dataPacket_KindToJSON(e){switch(e){case 0:return"RELIABLE";case 1:return"LOSSY";case-1:default:return"UNRECOGNIZED"}}function serverInfo_EditionFromJSON(e){switch(e){case 0:case"Standard":return 0;case 1:case"Cloud":return 1;case-1:case"UNRECOGNIZED":default:return-1}}function serverInfo_EditionToJSON(e){switch(e){case 0:return"Standard";case 1:return"Cloud";case-1:default:return"UNRECOGNIZED"}}var ClientInfo_SDK=(e=>(e[e.UNKNOWN=0]="UNKNOWN",e[e.JS=1]="JS",e[e.SWIFT=2]="SWIFT",e[e.ANDROID=3]="ANDROID",e[e.FLUTTER=4]="FLUTTER",e[e.GO=5]="GO",e[e.UNITY=6]="UNITY",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e))(ClientInfo_SDK||{});function clientInfo_SDKFromJSON(e){switch(e){case 0:case"UNKNOWN":return 0;case 1:case"JS":return 1;case 2:case"SWIFT":return 2;case 3:case"ANDROID":return 3;case 4:case"FLUTTER":return 4;case 5:case"GO":return 5;case 6:case"UNITY":return 6;case-1:case"UNRECOGNIZED":default:return-1}}function clientInfo_SDKToJSON(e){switch(e){case 0:return"UNKNOWN";case 1:return"JS";case 2:return"SWIFT";case 3:return"ANDROID";case 4:return"FLUTTER";case 5:return"GO";case 6:return"UNITY";case-1:default:return"UNRECOGNIZED"}}function createBaseRoom(){return{sid:"",name:"",emptyTimeout:0,maxParticipants:0,creationTime:0,turnPassword:"",enabledCodecs:[],metadata:"",numParticipants:0,activeRecording:!1}}const Room$1={encode(e,i=_m0.Writer.create()){e.sid!==""&&i.uint32(10).string(e.sid),e.name!==""&&i.uint32(18).string(e.name),e.emptyTimeout!==0&&i.uint32(24).uint32(e.emptyTimeout),e.maxParticipants!==0&&i.uint32(32).uint32(e.maxParticipants),e.creationTime!==0&&i.uint32(40).int64(e.creationTime),e.turnPassword!==""&&i.uint32(50).string(e.turnPassword);for(const t of e.enabledCodecs)Codec.encode(t,i.uint32(58).fork()).ldelim();return e.metadata!==""&&i.uint32(66).string(e.metadata),e.numParticipants!==0&&i.uint32(72).uint32(e.numParticipants),e.activeRecording===!0&&i.uint32(80).bool(e.activeRecording),i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseRoom();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.sid=t.string();break;case 2:a.name=t.string();break;case 3:a.emptyTimeout=t.uint32();break;case 4:a.maxParticipants=t.uint32();break;case 5:a.creationTime=longToNumber$1(t.int64());break;case 6:a.turnPassword=t.string();break;case 7:a.enabledCodecs.push(Codec.decode(t,t.uint32()));break;case 8:a.metadata=t.string();break;case 9:a.numParticipants=t.uint32();break;case 10:a.activeRecording=t.bool();break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{sid:isSet$1(e.sid)?String(e.sid):"",name:isSet$1(e.name)?String(e.name):"",emptyTimeout:isSet$1(e.emptyTimeout)?Number(e.emptyTimeout):0,maxParticipants:isSet$1(e.maxParticipants)?Number(e.maxParticipants):0,creationTime:isSet$1(e.creationTime)?Number(e.creationTime):0,turnPassword:isSet$1(e.turnPassword)?String(e.turnPassword):"",enabledCodecs:Array.isArray(e==null?void 0:e.enabledCodecs)?e.enabledCodecs.map(i=>Codec.fromJSON(i)):[],metadata:isSet$1(e.metadata)?String(e.metadata):"",numParticipants:isSet$1(e.numParticipants)?Number(e.numParticipants):0,activeRecording:isSet$1(e.activeRecording)?Boolean(e.activeRecording):!1}},toJSON(e){const i={};return e.sid!==void 0&&(i.sid=e.sid),e.name!==void 0&&(i.name=e.name),e.emptyTimeout!==void 0&&(i.emptyTimeout=Math.round(e.emptyTimeout)),e.maxParticipants!==void 0&&(i.maxParticipants=Math.round(e.maxParticipants)),e.creationTime!==void 0&&(i.creationTime=Math.round(e.creationTime)),e.turnPassword!==void 0&&(i.turnPassword=e.turnPassword),e.enabledCodecs?i.enabledCodecs=e.enabledCodecs.map(t=>t?Codec.toJSON(t):void 0):i.enabledCodecs=[],e.metadata!==void 0&&(i.metadata=e.metadata),e.numParticipants!==void 0&&(i.numParticipants=Math.round(e.numParticipants)),e.activeRecording!==void 0&&(i.activeRecording=e.activeRecording),i},fromPartial(e){var t,n,a,s,o,c,d,u,l,f;const i=createBaseRoom();return i.sid=(t=e.sid)!=null?t:"",i.name=(n=e.name)!=null?n:"",i.emptyTimeout=(a=e.emptyTimeout)!=null?a:0,i.maxParticipants=(s=e.maxParticipants)!=null?s:0,i.creationTime=(o=e.creationTime)!=null?o:0,i.turnPassword=(c=e.turnPassword)!=null?c:"",i.enabledCodecs=((d=e.enabledCodecs)==null?void 0:d.map(p=>Codec.fromPartial(p)))||[],i.metadata=(u=e.metadata)!=null?u:"",i.numParticipants=(l=e.numParticipants)!=null?l:0,i.activeRecording=(f=e.activeRecording)!=null?f:!1,i}};function createBaseCodec(){return{mime:"",fmtpLine:""}}const Codec={encode(e,i=_m0.Writer.create()){return e.mime!==""&&i.uint32(10).string(e.mime),e.fmtpLine!==""&&i.uint32(18).string(e.fmtpLine),i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseCodec();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.mime=t.string();break;case 2:a.fmtpLine=t.string();break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{mime:isSet$1(e.mime)?String(e.mime):"",fmtpLine:isSet$1(e.fmtpLine)?String(e.fmtpLine):""}},toJSON(e){const i={};return e.mime!==void 0&&(i.mime=e.mime),e.fmtpLine!==void 0&&(i.fmtpLine=e.fmtpLine),i},fromPartial(e){var t,n;const i=createBaseCodec();return i.mime=(t=e.mime)!=null?t:"",i.fmtpLine=(n=e.fmtpLine)!=null?n:"",i}};function createBaseParticipantPermission(){return{canSubscribe:!1,canPublish:!1,canPublishData:!1,canPublishSources:[],hidden:!1,recorder:!1}}const ParticipantPermission={encode(e,i=_m0.Writer.create()){e.canSubscribe===!0&&i.uint32(8).bool(e.canSubscribe),e.canPublish===!0&&i.uint32(16).bool(e.canPublish),e.canPublishData===!0&&i.uint32(24).bool(e.canPublishData),i.uint32(74).fork();for(const t of e.canPublishSources)i.int32(t);return i.ldelim(),e.hidden===!0&&i.uint32(56).bool(e.hidden),e.recorder===!0&&i.uint32(64).bool(e.recorder),i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseParticipantPermission();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.canSubscribe=t.bool();break;case 2:a.canPublish=t.bool();break;case 3:a.canPublishData=t.bool();break;case 9:if((s&7)===2){const o=t.uint32()+t.pos;for(;t.pos<o;)a.canPublishSources.push(t.int32())}else a.canPublishSources.push(t.int32());break;case 7:a.hidden=t.bool();break;case 8:a.recorder=t.bool();break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{canSubscribe:isSet$1(e.canSubscribe)?Boolean(e.canSubscribe):!1,canPublish:isSet$1(e.canPublish)?Boolean(e.canPublish):!1,canPublishData:isSet$1(e.canPublishData)?Boolean(e.canPublishData):!1,canPublishSources:Array.isArray(e==null?void 0:e.canPublishSources)?e.canPublishSources.map(i=>trackSourceFromJSON(i)):[],hidden:isSet$1(e.hidden)?Boolean(e.hidden):!1,recorder:isSet$1(e.recorder)?Boolean(e.recorder):!1}},toJSON(e){const i={};return e.canSubscribe!==void 0&&(i.canSubscribe=e.canSubscribe),e.canPublish!==void 0&&(i.canPublish=e.canPublish),e.canPublishData!==void 0&&(i.canPublishData=e.canPublishData),e.canPublishSources?i.canPublishSources=e.canPublishSources.map(t=>trackSourceToJSON(t)):i.canPublishSources=[],e.hidden!==void 0&&(i.hidden=e.hidden),e.recorder!==void 0&&(i.recorder=e.recorder),i},fromPartial(e){var t,n,a,s,o,c;const i=createBaseParticipantPermission();return i.canSubscribe=(t=e.canSubscribe)!=null?t:!1,i.canPublish=(n=e.canPublish)!=null?n:!1,i.canPublishData=(a=e.canPublishData)!=null?a:!1,i.canPublishSources=((s=e.canPublishSources)==null?void 0:s.map(d=>d))||[],i.hidden=(o=e.hidden)!=null?o:!1,i.recorder=(c=e.recorder)!=null?c:!1,i}};function createBaseParticipantInfo(){return{sid:"",identity:"",state:0,tracks:[],metadata:"",joinedAt:0,name:"",version:0,permission:void 0,region:"",isPublisher:!1}}const ParticipantInfo={encode(e,i=_m0.Writer.create()){e.sid!==""&&i.uint32(10).string(e.sid),e.identity!==""&&i.uint32(18).string(e.identity),e.state!==0&&i.uint32(24).int32(e.state);for(const t of e.tracks)TrackInfo.encode(t,i.uint32(34).fork()).ldelim();return e.metadata!==""&&i.uint32(42).string(e.metadata),e.joinedAt!==0&&i.uint32(48).int64(e.joinedAt),e.name!==""&&i.uint32(74).string(e.name),e.version!==0&&i.uint32(80).uint32(e.version),e.permission!==void 0&&ParticipantPermission.encode(e.permission,i.uint32(90).fork()).ldelim(),e.region!==""&&i.uint32(98).string(e.region),e.isPublisher===!0&&i.uint32(104).bool(e.isPublisher),i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseParticipantInfo();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.sid=t.string();break;case 2:a.identity=t.string();break;case 3:a.state=t.int32();break;case 4:a.tracks.push(TrackInfo.decode(t,t.uint32()));break;case 5:a.metadata=t.string();break;case 6:a.joinedAt=longToNumber$1(t.int64());break;case 9:a.name=t.string();break;case 10:a.version=t.uint32();break;case 11:a.permission=ParticipantPermission.decode(t,t.uint32());break;case 12:a.region=t.string();break;case 13:a.isPublisher=t.bool();break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{sid:isSet$1(e.sid)?String(e.sid):"",identity:isSet$1(e.identity)?String(e.identity):"",state:isSet$1(e.state)?participantInfo_StateFromJSON(e.state):0,tracks:Array.isArray(e==null?void 0:e.tracks)?e.tracks.map(i=>TrackInfo.fromJSON(i)):[],metadata:isSet$1(e.metadata)?String(e.metadata):"",joinedAt:isSet$1(e.joinedAt)?Number(e.joinedAt):0,name:isSet$1(e.name)?String(e.name):"",version:isSet$1(e.version)?Number(e.version):0,permission:isSet$1(e.permission)?ParticipantPermission.fromJSON(e.permission):void 0,region:isSet$1(e.region)?String(e.region):"",isPublisher:isSet$1(e.isPublisher)?Boolean(e.isPublisher):!1}},toJSON(e){const i={};return e.sid!==void 0&&(i.sid=e.sid),e.identity!==void 0&&(i.identity=e.identity),e.state!==void 0&&(i.state=participantInfo_StateToJSON(e.state)),e.tracks?i.tracks=e.tracks.map(t=>t?TrackInfo.toJSON(t):void 0):i.tracks=[],e.metadata!==void 0&&(i.metadata=e.metadata),e.joinedAt!==void 0&&(i.joinedAt=Math.round(e.joinedAt)),e.name!==void 0&&(i.name=e.name),e.version!==void 0&&(i.version=Math.round(e.version)),e.permission!==void 0&&(i.permission=e.permission?ParticipantPermission.toJSON(e.permission):void 0),e.region!==void 0&&(i.region=e.region),e.isPublisher!==void 0&&(i.isPublisher=e.isPublisher),i},fromPartial(e){var t,n,a,s,o,c,d,u,l,f;const i=createBaseParticipantInfo();return i.sid=(t=e.sid)!=null?t:"",i.identity=(n=e.identity)!=null?n:"",i.state=(a=e.state)!=null?a:0,i.tracks=((s=e.tracks)==null?void 0:s.map(p=>TrackInfo.fromPartial(p)))||[],i.metadata=(o=e.metadata)!=null?o:"",i.joinedAt=(c=e.joinedAt)!=null?c:0,i.name=(d=e.name)!=null?d:"",i.version=(u=e.version)!=null?u:0,i.permission=e.permission!==void 0&&e.permission!==null?ParticipantPermission.fromPartial(e.permission):void 0,i.region=(l=e.region)!=null?l:"",i.isPublisher=(f=e.isPublisher)!=null?f:!1,i}};function createBaseSimulcastCodecInfo(){return{mimeType:"",mid:"",cid:"",layers:[]}}const SimulcastCodecInfo={encode(e,i=_m0.Writer.create()){e.mimeType!==""&&i.uint32(10).string(e.mimeType),e.mid!==""&&i.uint32(18).string(e.mid),e.cid!==""&&i.uint32(26).string(e.cid);for(const t of e.layers)VideoLayer.encode(t,i.uint32(34).fork()).ldelim();return i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseSimulcastCodecInfo();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.mimeType=t.string();break;case 2:a.mid=t.string();break;case 3:a.cid=t.string();break;case 4:a.layers.push(VideoLayer.decode(t,t.uint32()));break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{mimeType:isSet$1(e.mimeType)?String(e.mimeType):"",mid:isSet$1(e.mid)?String(e.mid):"",cid:isSet$1(e.cid)?String(e.cid):"",layers:Array.isArray(e==null?void 0:e.layers)?e.layers.map(i=>VideoLayer.fromJSON(i)):[]}},toJSON(e){const i={};return e.mimeType!==void 0&&(i.mimeType=e.mimeType),e.mid!==void 0&&(i.mid=e.mid),e.cid!==void 0&&(i.cid=e.cid),e.layers?i.layers=e.layers.map(t=>t?VideoLayer.toJSON(t):void 0):i.layers=[],i},fromPartial(e){var t,n,a,s;const i=createBaseSimulcastCodecInfo();return i.mimeType=(t=e.mimeType)!=null?t:"",i.mid=(n=e.mid)!=null?n:"",i.cid=(a=e.cid)!=null?a:"",i.layers=((s=e.layers)==null?void 0:s.map(o=>VideoLayer.fromPartial(o)))||[],i}};function createBaseTrackInfo(){return{sid:"",type:0,name:"",muted:!1,width:0,height:0,simulcast:!1,disableDtx:!1,source:0,layers:[],mimeType:"",mid:"",codecs:[],stereo:!1,disableRed:!1,encryption:0}}const TrackInfo={encode(e,i=_m0.Writer.create()){e.sid!==""&&i.uint32(10).string(e.sid),e.type!==0&&i.uint32(16).int32(e.type),e.name!==""&&i.uint32(26).string(e.name),e.muted===!0&&i.uint32(32).bool(e.muted),e.width!==0&&i.uint32(40).uint32(e.width),e.height!==0&&i.uint32(48).uint32(e.height),e.simulcast===!0&&i.uint32(56).bool(e.simulcast),e.disableDtx===!0&&i.uint32(64).bool(e.disableDtx),e.source!==0&&i.uint32(72).int32(e.source);for(const t of e.layers)VideoLayer.encode(t,i.uint32(82).fork()).ldelim();e.mimeType!==""&&i.uint32(90).string(e.mimeType),e.mid!==""&&i.uint32(98).string(e.mid);for(const t of e.codecs)SimulcastCodecInfo.encode(t,i.uint32(106).fork()).ldelim();return e.stereo===!0&&i.uint32(112).bool(e.stereo),e.disableRed===!0&&i.uint32(120).bool(e.disableRed),e.encryption!==0&&i.uint32(128).int32(e.encryption),i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseTrackInfo();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.sid=t.string();break;case 2:a.type=t.int32();break;case 3:a.name=t.string();break;case 4:a.muted=t.bool();break;case 5:a.width=t.uint32();break;case 6:a.height=t.uint32();break;case 7:a.simulcast=t.bool();break;case 8:a.disableDtx=t.bool();break;case 9:a.source=t.int32();break;case 10:a.layers.push(VideoLayer.decode(t,t.uint32()));break;case 11:a.mimeType=t.string();break;case 12:a.mid=t.string();break;case 13:a.codecs.push(SimulcastCodecInfo.decode(t,t.uint32()));break;case 14:a.stereo=t.bool();break;case 15:a.disableRed=t.bool();break;case 16:a.encryption=t.int32();break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{sid:isSet$1(e.sid)?String(e.sid):"",type:isSet$1(e.type)?trackTypeFromJSON(e.type):0,name:isSet$1(e.name)?String(e.name):"",muted:isSet$1(e.muted)?Boolean(e.muted):!1,width:isSet$1(e.width)?Number(e.width):0,height:isSet$1(e.height)?Number(e.height):0,simulcast:isSet$1(e.simulcast)?Boolean(e.simulcast):!1,disableDtx:isSet$1(e.disableDtx)?Boolean(e.disableDtx):!1,source:isSet$1(e.source)?trackSourceFromJSON(e.source):0,layers:Array.isArray(e==null?void 0:e.layers)?e.layers.map(i=>VideoLayer.fromJSON(i)):[],mimeType:isSet$1(e.mimeType)?String(e.mimeType):"",mid:isSet$1(e.mid)?String(e.mid):"",codecs:Array.isArray(e==null?void 0:e.codecs)?e.codecs.map(i=>SimulcastCodecInfo.fromJSON(i)):[],stereo:isSet$1(e.stereo)?Boolean(e.stereo):!1,disableRed:isSet$1(e.disableRed)?Boolean(e.disableRed):!1,encryption:isSet$1(e.encryption)?encryption_TypeFromJSON(e.encryption):0}},toJSON(e){const i={};return e.sid!==void 0&&(i.sid=e.sid),e.type!==void 0&&(i.type=trackTypeToJSON(e.type)),e.name!==void 0&&(i.name=e.name),e.muted!==void 0&&(i.muted=e.muted),e.width!==void 0&&(i.width=Math.round(e.width)),e.height!==void 0&&(i.height=Math.round(e.height)),e.simulcast!==void 0&&(i.simulcast=e.simulcast),e.disableDtx!==void 0&&(i.disableDtx=e.disableDtx),e.source!==void 0&&(i.source=trackSourceToJSON(e.source)),e.layers?i.layers=e.layers.map(t=>t?VideoLayer.toJSON(t):void 0):i.layers=[],e.mimeType!==void 0&&(i.mimeType=e.mimeType),e.mid!==void 0&&(i.mid=e.mid),e.codecs?i.codecs=e.codecs.map(t=>t?SimulcastCodecInfo.toJSON(t):void 0):i.codecs=[],e.stereo!==void 0&&(i.stereo=e.stereo),e.disableRed!==void 0&&(i.disableRed=e.disableRed),e.encryption!==void 0&&(i.encryption=encryption_TypeToJSON(e.encryption)),i},fromPartial(e){var t,n,a,s,o,c,d,u,l,f,p,m,g,S,v,T;const i=createBaseTrackInfo();return i.sid=(t=e.sid)!=null?t:"",i.type=(n=e.type)!=null?n:0,i.name=(a=e.name)!=null?a:"",i.muted=(s=e.muted)!=null?s:!1,i.width=(o=e.width)!=null?o:0,i.height=(c=e.height)!=null?c:0,i.simulcast=(d=e.simulcast)!=null?d:!1,i.disableDtx=(u=e.disableDtx)!=null?u:!1,i.source=(l=e.source)!=null?l:0,i.layers=((f=e.layers)==null?void 0:f.map(k=>VideoLayer.fromPartial(k)))||[],i.mimeType=(p=e.mimeType)!=null?p:"",i.mid=(m=e.mid)!=null?m:"",i.codecs=((g=e.codecs)==null?void 0:g.map(k=>SimulcastCodecInfo.fromPartial(k)))||[],i.stereo=(S=e.stereo)!=null?S:!1,i.disableRed=(v=e.disableRed)!=null?v:!1,i.encryption=(T=e.encryption)!=null?T:0,i}};function createBaseVideoLayer(){return{quality:0,width:0,height:0,bitrate:0,ssrc:0}}const VideoLayer={encode(e,i=_m0.Writer.create()){return e.quality!==0&&i.uint32(8).int32(e.quality),e.width!==0&&i.uint32(16).uint32(e.width),e.height!==0&&i.uint32(24).uint32(e.height),e.bitrate!==0&&i.uint32(32).uint32(e.bitrate),e.ssrc!==0&&i.uint32(40).uint32(e.ssrc),i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseVideoLayer();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.quality=t.int32();break;case 2:a.width=t.uint32();break;case 3:a.height=t.uint32();break;case 4:a.bitrate=t.uint32();break;case 5:a.ssrc=t.uint32();break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{quality:isSet$1(e.quality)?videoQualityFromJSON(e.quality):0,width:isSet$1(e.width)?Number(e.width):0,height:isSet$1(e.height)?Number(e.height):0,bitrate:isSet$1(e.bitrate)?Number(e.bitrate):0,ssrc:isSet$1(e.ssrc)?Number(e.ssrc):0}},toJSON(e){const i={};return e.quality!==void 0&&(i.quality=videoQualityToJSON(e.quality)),e.width!==void 0&&(i.width=Math.round(e.width)),e.height!==void 0&&(i.height=Math.round(e.height)),e.bitrate!==void 0&&(i.bitrate=Math.round(e.bitrate)),e.ssrc!==void 0&&(i.ssrc=Math.round(e.ssrc)),i},fromPartial(e){var t,n,a,s,o;const i=createBaseVideoLayer();return i.quality=(t=e.quality)!=null?t:0,i.width=(n=e.width)!=null?n:0,i.height=(a=e.height)!=null?a:0,i.bitrate=(s=e.bitrate)!=null?s:0,i.ssrc=(o=e.ssrc)!=null?o:0,i}};function createBaseDataPacket(){return{kind:0,value:void 0}}const DataPacket={encode(e,i=_m0.Writer.create()){var t,n;return e.kind!==0&&i.uint32(8).int32(e.kind),((t=e.value)==null?void 0:t.$case)==="user"&&UserPacket.encode(e.value.user,i.uint32(18).fork()).ldelim(),((n=e.value)==null?void 0:n.$case)==="speaker"&&ActiveSpeakerUpdate.encode(e.value.speaker,i.uint32(26).fork()).ldelim(),i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseDataPacket();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.kind=t.int32();break;case 2:a.value={$case:"user",user:UserPacket.decode(t,t.uint32())};break;case 3:a.value={$case:"speaker",speaker:ActiveSpeakerUpdate.decode(t,t.uint32())};break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{kind:isSet$1(e.kind)?dataPacket_KindFromJSON(e.kind):0,value:isSet$1(e.user)?{$case:"user",user:UserPacket.fromJSON(e.user)}:isSet$1(e.speaker)?{$case:"speaker",speaker:ActiveSpeakerUpdate.fromJSON(e.speaker)}:void 0}},toJSON(e){var t,n,a,s,o,c;const i={};return e.kind!==void 0&&(i.kind=dataPacket_KindToJSON(e.kind)),((t=e.value)==null?void 0:t.$case)==="user"&&(i.user=(n=e.value)!=null&&n.user?UserPacket.toJSON((a=e.value)==null?void 0:a.user):void 0),((s=e.value)==null?void 0:s.$case)==="speaker"&&(i.speaker=(o=e.value)!=null&&o.speaker?ActiveSpeakerUpdate.toJSON((c=e.value)==null?void 0:c.speaker):void 0),i},fromPartial(e){var t,n,a,s,o,c,d;const i=createBaseDataPacket();return i.kind=(t=e.kind)!=null?t:0,((n=e.value)==null?void 0:n.$case)==="user"&&((a=e.value)==null?void 0:a.user)!==void 0&&((s=e.value)==null?void 0:s.user)!==null&&(i.value={$case:"user",user:UserPacket.fromPartial(e.value.user)}),((o=e.value)==null?void 0:o.$case)==="speaker"&&((c=e.value)==null?void 0:c.speaker)!==void 0&&((d=e.value)==null?void 0:d.speaker)!==null&&(i.value={$case:"speaker",speaker:ActiveSpeakerUpdate.fromPartial(e.value.speaker)}),i}};function createBaseActiveSpeakerUpdate(){return{speakers:[]}}const ActiveSpeakerUpdate={encode(e,i=_m0.Writer.create()){for(const t of e.speakers)SpeakerInfo.encode(t,i.uint32(10).fork()).ldelim();return i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseActiveSpeakerUpdate();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.speakers.push(SpeakerInfo.decode(t,t.uint32()));break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{speakers:Array.isArray(e==null?void 0:e.speakers)?e.speakers.map(i=>SpeakerInfo.fromJSON(i)):[]}},toJSON(e){const i={};return e.speakers?i.speakers=e.speakers.map(t=>t?SpeakerInfo.toJSON(t):void 0):i.speakers=[],i},fromPartial(e){var t;const i=createBaseActiveSpeakerUpdate();return i.speakers=((t=e.speakers)==null?void 0:t.map(n=>SpeakerInfo.fromPartial(n)))||[],i}};function createBaseSpeakerInfo(){return{sid:"",level:0,active:!1}}const SpeakerInfo={encode(e,i=_m0.Writer.create()){return e.sid!==""&&i.uint32(10).string(e.sid),e.level!==0&&i.uint32(21).float(e.level),e.active===!0&&i.uint32(24).bool(e.active),i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseSpeakerInfo();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.sid=t.string();break;case 2:a.level=t.float();break;case 3:a.active=t.bool();break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{sid:isSet$1(e.sid)?String(e.sid):"",level:isSet$1(e.level)?Number(e.level):0,active:isSet$1(e.active)?Boolean(e.active):!1}},toJSON(e){const i={};return e.sid!==void 0&&(i.sid=e.sid),e.level!==void 0&&(i.level=e.level),e.active!==void 0&&(i.active=e.active),i},fromPartial(e){var t,n,a;const i=createBaseSpeakerInfo();return i.sid=(t=e.sid)!=null?t:"",i.level=(n=e.level)!=null?n:0,i.active=(a=e.active)!=null?a:!1,i}};function createBaseUserPacket(){return{participantSid:"",payload:new Uint8Array,destinationSids:[]}}const UserPacket={encode(e,i=_m0.Writer.create()){e.participantSid!==""&&i.uint32(10).string(e.participantSid),e.payload.length!==0&&i.uint32(18).bytes(e.payload);for(const t of e.destinationSids)i.uint32(26).string(t);return i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseUserPacket();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.participantSid=t.string();break;case 2:a.payload=t.bytes();break;case 3:a.destinationSids.push(t.string());break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{participantSid:isSet$1(e.participantSid)?String(e.participantSid):"",payload:isSet$1(e.payload)?bytesFromBase64(e.payload):new Uint8Array,destinationSids:Array.isArray(e==null?void 0:e.destinationSids)?e.destinationSids.map(i=>String(i)):[]}},toJSON(e){const i={};return e.participantSid!==void 0&&(i.participantSid=e.participantSid),e.payload!==void 0&&(i.payload=base64FromBytes(e.payload!==void 0?e.payload:new Uint8Array)),e.destinationSids?i.destinationSids=e.destinationSids.map(t=>t):i.destinationSids=[],i},fromPartial(e){var t,n,a;const i=createBaseUserPacket();return i.participantSid=(t=e.participantSid)!=null?t:"",i.payload=(n=e.payload)!=null?n:new Uint8Array,i.destinationSids=((a=e.destinationSids)==null?void 0:a.map(s=>s))||[],i}};function createBaseParticipantTracks(){return{participantSid:"",trackSids:[]}}const ParticipantTracks={encode(e,i=_m0.Writer.create()){e.participantSid!==""&&i.uint32(10).string(e.participantSid);for(const t of e.trackSids)i.uint32(18).string(t);return i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseParticipantTracks();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.participantSid=t.string();break;case 2:a.trackSids.push(t.string());break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{participantSid:isSet$1(e.participantSid)?String(e.participantSid):"",trackSids:Array.isArray(e==null?void 0:e.trackSids)?e.trackSids.map(i=>String(i)):[]}},toJSON(e){const i={};return e.participantSid!==void 0&&(i.participantSid=e.participantSid),e.trackSids?i.trackSids=e.trackSids.map(t=>t):i.trackSids=[],i},fromPartial(e){var t,n;const i=createBaseParticipantTracks();return i.participantSid=(t=e.participantSid)!=null?t:"",i.trackSids=((n=e.trackSids)==null?void 0:n.map(a=>a))||[],i}};function createBaseServerInfo(){return{edition:0,version:"",protocol:0,region:"",nodeId:"",debugInfo:""}}const ServerInfo={encode(e,i=_m0.Writer.create()){return e.edition!==0&&i.uint32(8).int32(e.edition),e.version!==""&&i.uint32(18).string(e.version),e.protocol!==0&&i.uint32(24).int32(e.protocol),e.region!==""&&i.uint32(34).string(e.region),e.nodeId!==""&&i.uint32(42).string(e.nodeId),e.debugInfo!==""&&i.uint32(50).string(e.debugInfo),i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseServerInfo();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.edition=t.int32();break;case 2:a.version=t.string();break;case 3:a.protocol=t.int32();break;case 4:a.region=t.string();break;case 5:a.nodeId=t.string();break;case 6:a.debugInfo=t.string();break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{edition:isSet$1(e.edition)?serverInfo_EditionFromJSON(e.edition):0,version:isSet$1(e.version)?String(e.version):"",protocol:isSet$1(e.protocol)?Number(e.protocol):0,region:isSet$1(e.region)?String(e.region):"",nodeId:isSet$1(e.nodeId)?String(e.nodeId):"",debugInfo:isSet$1(e.debugInfo)?String(e.debugInfo):""}},toJSON(e){const i={};return e.edition!==void 0&&(i.edition=serverInfo_EditionToJSON(e.edition)),e.version!==void 0&&(i.version=e.version),e.protocol!==void 0&&(i.protocol=Math.round(e.protocol)),e.region!==void 0&&(i.region=e.region),e.nodeId!==void 0&&(i.nodeId=e.nodeId),e.debugInfo!==void 0&&(i.debugInfo=e.debugInfo),i},fromPartial(e){var t,n,a,s,o,c;const i=createBaseServerInfo();return i.edition=(t=e.edition)!=null?t:0,i.version=(n=e.version)!=null?n:"",i.protocol=(a=e.protocol)!=null?a:0,i.region=(s=e.region)!=null?s:"",i.nodeId=(o=e.nodeId)!=null?o:"",i.debugInfo=(c=e.debugInfo)!=null?c:"",i}};function createBaseClientInfo(){return{sdk:0,version:"",protocol:0,os:"",osVersion:"",deviceModel:"",browser:"",browserVersion:"",address:"",network:""}}const ClientInfo={encode(e,i=_m0.Writer.create()){return e.sdk!==0&&i.uint32(8).int32(e.sdk),e.version!==""&&i.uint32(18).string(e.version),e.protocol!==0&&i.uint32(24).int32(e.protocol),e.os!==""&&i.uint32(34).string(e.os),e.osVersion!==""&&i.uint32(42).string(e.osVersion),e.deviceModel!==""&&i.uint32(50).string(e.deviceModel),e.browser!==""&&i.uint32(58).string(e.browser),e.browserVersion!==""&&i.uint32(66).string(e.browserVersion),e.address!==""&&i.uint32(74).string(e.address),e.network!==""&&i.uint32(82).string(e.network),i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseClientInfo();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.sdk=t.int32();break;case 2:a.version=t.string();break;case 3:a.protocol=t.int32();break;case 4:a.os=t.string();break;case 5:a.osVersion=t.string();break;case 6:a.deviceModel=t.string();break;case 7:a.browser=t.string();break;case 8:a.browserVersion=t.string();break;case 9:a.address=t.string();break;case 10:a.network=t.string();break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{sdk:isSet$1(e.sdk)?clientInfo_SDKFromJSON(e.sdk):0,version:isSet$1(e.version)?String(e.version):"",protocol:isSet$1(e.protocol)?Number(e.protocol):0,os:isSet$1(e.os)?String(e.os):"",osVersion:isSet$1(e.osVersion)?String(e.osVersion):"",deviceModel:isSet$1(e.deviceModel)?String(e.deviceModel):"",browser:isSet$1(e.browser)?String(e.browser):"",browserVersion:isSet$1(e.browserVersion)?String(e.browserVersion):"",address:isSet$1(e.address)?String(e.address):"",network:isSet$1(e.network)?String(e.network):""}},toJSON(e){const i={};return e.sdk!==void 0&&(i.sdk=clientInfo_SDKToJSON(e.sdk)),e.version!==void 0&&(i.version=e.version),e.protocol!==void 0&&(i.protocol=Math.round(e.protocol)),e.os!==void 0&&(i.os=e.os),e.osVersion!==void 0&&(i.osVersion=e.osVersion),e.deviceModel!==void 0&&(i.deviceModel=e.deviceModel),e.browser!==void 0&&(i.browser=e.browser),e.browserVersion!==void 0&&(i.browserVersion=e.browserVersion),e.address!==void 0&&(i.address=e.address),e.network!==void 0&&(i.network=e.network),i},fromPartial(e){var t,n,a,s,o,c,d,u,l,f;const i=createBaseClientInfo();return i.sdk=(t=e.sdk)!=null?t:0,i.version=(n=e.version)!=null?n:"",i.protocol=(a=e.protocol)!=null?a:0,i.os=(s=e.os)!=null?s:"",i.osVersion=(o=e.osVersion)!=null?o:"",i.deviceModel=(c=e.deviceModel)!=null?c:"",i.browser=(d=e.browser)!=null?d:"",i.browserVersion=(u=e.browserVersion)!=null?u:"",i.address=(l=e.address)!=null?l:"",i.network=(f=e.network)!=null?f:"",i}};function createBaseClientConfiguration(){return{video:void 0,screen:void 0,resumeConnection:0,disabledCodecs:void 0,forceRelay:0}}const ClientConfiguration={encode(e,i=_m0.Writer.create()){return e.video!==void 0&&VideoConfiguration.encode(e.video,i.uint32(10).fork()).ldelim(),e.screen!==void 0&&VideoConfiguration.encode(e.screen,i.uint32(18).fork()).ldelim(),e.resumeConnection!==0&&i.uint32(24).int32(e.resumeConnection),e.disabledCodecs!==void 0&&DisabledCodecs.encode(e.disabledCodecs,i.uint32(34).fork()).ldelim(),e.forceRelay!==0&&i.uint32(40).int32(e.forceRelay),i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseClientConfiguration();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.video=VideoConfiguration.decode(t,t.uint32());break;case 2:a.screen=VideoConfiguration.decode(t,t.uint32());break;case 3:a.resumeConnection=t.int32();break;case 4:a.disabledCodecs=DisabledCodecs.decode(t,t.uint32());break;case 5:a.forceRelay=t.int32();break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{video:isSet$1(e.video)?VideoConfiguration.fromJSON(e.video):void 0,screen:isSet$1(e.screen)?VideoConfiguration.fromJSON(e.screen):void 0,resumeConnection:isSet$1(e.resumeConnection)?clientConfigSettingFromJSON(e.resumeConnection):0,disabledCodecs:isSet$1(e.disabledCodecs)?DisabledCodecs.fromJSON(e.disabledCodecs):void 0,forceRelay:isSet$1(e.forceRelay)?clientConfigSettingFromJSON(e.forceRelay):0}},toJSON(e){const i={};return e.video!==void 0&&(i.video=e.video?VideoConfiguration.toJSON(e.video):void 0),e.screen!==void 0&&(i.screen=e.screen?VideoConfiguration.toJSON(e.screen):void 0),e.resumeConnection!==void 0&&(i.resumeConnection=clientConfigSettingToJSON(e.resumeConnection)),e.disabledCodecs!==void 0&&(i.disabledCodecs=e.disabledCodecs?DisabledCodecs.toJSON(e.disabledCodecs):void 0),e.forceRelay!==void 0&&(i.forceRelay=clientConfigSettingToJSON(e.forceRelay)),i},fromPartial(e){var t,n;const i=createBaseClientConfiguration();return i.video=e.video!==void 0&&e.video!==null?VideoConfiguration.fromPartial(e.video):void 0,i.screen=e.screen!==void 0&&e.screen!==null?VideoConfiguration.fromPartial(e.screen):void 0,i.resumeConnection=(t=e.resumeConnection)!=null?t:0,i.disabledCodecs=e.disabledCodecs!==void 0&&e.disabledCodecs!==null?DisabledCodecs.fromPartial(e.disabledCodecs):void 0,i.forceRelay=(n=e.forceRelay)!=null?n:0,i}};function createBaseVideoConfiguration(){return{hardwareEncoder:0}}const VideoConfiguration={encode(e,i=_m0.Writer.create()){return e.hardwareEncoder!==0&&i.uint32(8).int32(e.hardwareEncoder),i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseVideoConfiguration();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.hardwareEncoder=t.int32();break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{hardwareEncoder:isSet$1(e.hardwareEncoder)?clientConfigSettingFromJSON(e.hardwareEncoder):0}},toJSON(e){const i={};return e.hardwareEncoder!==void 0&&(i.hardwareEncoder=clientConfigSettingToJSON(e.hardwareEncoder)),i},fromPartial(e){var t;const i=createBaseVideoConfiguration();return i.hardwareEncoder=(t=e.hardwareEncoder)!=null?t:0,i}};function createBaseDisabledCodecs(){return{codecs:[]}}const DisabledCodecs={encode(e,i=_m0.Writer.create()){for(const t of e.codecs)Codec.encode(t,i.uint32(10).fork()).ldelim();return i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseDisabledCodecs();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.codecs.push(Codec.decode(t,t.uint32()));break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{codecs:Array.isArray(e==null?void 0:e.codecs)?e.codecs.map(i=>Codec.fromJSON(i)):[]}},toJSON(e){const i={};return e.codecs?i.codecs=e.codecs.map(t=>t?Codec.toJSON(t):void 0):i.codecs=[],i},fromPartial(e){var t;const i=createBaseDisabledCodecs();return i.codecs=((t=e.codecs)==null?void 0:t.map(n=>Codec.fromPartial(n)))||[],i}};var tsProtoGlobalThis$1=(()=>{if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw"Unable to locate global object"})();function bytesFromBase64(e){if(tsProtoGlobalThis$1.Buffer)return Uint8Array.from(tsProtoGlobalThis$1.Buffer.from(e,"base64"));{const i=tsProtoGlobalThis$1.atob(e),t=new Uint8Array(i.length);for(let n=0;n<i.length;++n)t[n]=i.charCodeAt(n);return t}}function base64FromBytes(e){if(tsProtoGlobalThis$1.Buffer)return tsProtoGlobalThis$1.Buffer.from(e).toString("base64");{const i=[];return e.forEach(t=>{i.push(String.fromCharCode(t))}),tsProtoGlobalThis$1.btoa(i.join(""))}}function longToNumber$1(e){if(e.gt(Number.MAX_SAFE_INTEGER))throw new tsProtoGlobalThis$1.Error("Value is larger than Number.MAX_SAFE_INTEGER");return e.toNumber()}_m0.util.Long!==long&&(_m0.util.Long=long,_m0.configure());function isSet$1(e){return e!=null}const maxRetryDelay=7e3,DEFAULT_RETRY_DELAYS_IN_MS=[0,300,2*2*300,3*3*300,4*4*300,maxRetryDelay,maxRetryDelay,maxRetryDelay,maxRetryDelay,maxRetryDelay];class DefaultReconnectPolicy{constructor(i){h(this,"_retryDelays");this._retryDelays=i!==void 0?[...i]:DEFAULT_RETRY_DELAYS_IN_MS}nextRetryDelayInMs(i){if(i.retryCount>=this._retryDelays.length)return null;const t=this._retryDelays[i.retryCount];return i.retryCount<=1?t:t+Math.random()*1e3}}let logDisabled_=!0,deprecationWarnings_=!0;function extractVersion(e,i,t){const n=e.match(i);return n&&n.length>=t&&parseInt(n[t],10)}function wrapPeerConnectionEvent(e,i,t){if(!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype,a=n.addEventListener;n.addEventListener=function(o,c){if(o!==i)return a.apply(this,arguments);const d=u=>{const l=t(u);l&&(c.handleEvent?c.handleEvent(l):c(l))};return this._eventMap=this._eventMap||{},this._eventMap[i]||(this._eventMap[i]=new Map),this._eventMap[i].set(c,d),a.apply(this,[o,d])};const s=n.removeEventListener;n.removeEventListener=function(o,c){if(o!==i||!this._eventMap||!this._eventMap[i])return s.apply(this,arguments);if(!this._eventMap[i].has(c))return s.apply(this,arguments);const d=this._eventMap[i].get(c);return this._eventMap[i].delete(c),this._eventMap[i].size===0&&delete this._eventMap[i],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[o,d])},Object.defineProperty(n,"on"+i,{get(){return this["_on"+i]},set(o){this["_on"+i]&&(this.removeEventListener(i,this["_on"+i]),delete this["_on"+i]),o&&this.addEventListener(i,this["_on"+i]=o)},enumerable:!0,configurable:!0})}function disableLog(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(logDisabled_=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function disableWarnings(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(deprecationWarnings_=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function log(){if(typeof window=="object"){if(logDisabled_)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function deprecated(e,i){!deprecationWarnings_||console.warn(e+" is deprecated, please use "+i+" instead.")}function detectBrowser(e){const i={browser:null,version:null};if(typeof e>"u"||!e.navigator)return i.browser="Not a browser.",i;const{navigator:t}=e;if(t.mozGetUserMedia)i.browser="firefox",i.version=extractVersion(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||e.isSecureContext===!1&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)i.browser="chrome",i.version=extractVersion(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(e.RTCPeerConnection&&t.userAgent.match(/AppleWebKit\/(\d+)\./))i.browser="safari",i.version=extractVersion(t.userAgent,/AppleWebKit\/(\d+)\./,1),i.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype;else return i.browser="Not a supported browser.",i;return i}function isObject(e){return Object.prototype.toString.call(e)==="[object Object]"}function compactObject(e){return isObject(e)?Object.keys(e).reduce(function(i,t){const n=isObject(e[t]),a=n?compactObject(e[t]):e[t],s=n&&!Object.keys(a).length;return a===void 0||s?i:Object.assign(i,{[t]:a})},{}):e}function walkStats(e,i,t){!i||t.has(i.id)||(t.set(i.id,i),Object.keys(i).forEach(n=>{n.endsWith("Id")?walkStats(e,e.get(i[n]),t):n.endsWith("Ids")&&i[n].forEach(a=>{walkStats(e,e.get(a),t)})}))}function filterStats(e,i,t){const n=t?"outbound-rtp":"inbound-rtp",a=new Map;if(i===null)return a;const s=[];return e.forEach(o=>{o.type==="track"&&o.trackIdentifier===i.id&&s.push(o)}),s.forEach(o=>{e.forEach(c=>{c.type===n&&c.trackId===o.id&&walkStats(e,c,a)})}),a}const logging=log;function shimGetUserMedia$2(e,i){const t=e&&e.navigator;if(!t.mediaDevices)return;const n=function(c){if(typeof c!="object"||c.mandatory||c.optional)return c;const d={};return Object.keys(c).forEach(u=>{if(u==="require"||u==="advanced"||u==="mediaSource")return;const l=typeof c[u]=="object"?c[u]:{ideal:c[u]};l.exact!==void 0&&typeof l.exact=="number"&&(l.min=l.max=l.exact);const f=function(p,m){return p?p+m.charAt(0).toUpperCase()+m.slice(1):m==="deviceId"?"sourceId":m};if(l.ideal!==void 0){d.optional=d.optional||[];let p={};typeof l.ideal=="number"?(p[f("min",u)]=l.ideal,d.optional.push(p),p={},p[f("max",u)]=l.ideal,d.optional.push(p)):(p[f("",u)]=l.ideal,d.optional.push(p))}l.exact!==void 0&&typeof l.exact!="number"?(d.mandatory=d.mandatory||{},d.mandatory[f("",u)]=l.exact):["min","max"].forEach(p=>{l[p]!==void 0&&(d.mandatory=d.mandatory||{},d.mandatory[f(p,u)]=l[p])})}),c.advanced&&(d.optional=(d.optional||[]).concat(c.advanced)),d},a=function(c,d){if(i.version>=61)return d(c);if(c=JSON.parse(JSON.stringify(c)),c&&typeof c.audio=="object"){const u=function(l,f,p){f in l&&!(p in l)&&(l[p]=l[f],delete l[f])};c=JSON.parse(JSON.stringify(c)),u(c.audio,"autoGainControl","googAutoGainControl"),u(c.audio,"noiseSuppression","googNoiseSuppression"),c.audio=n(c.audio)}if(c&&typeof c.video=="object"){let u=c.video.facingMode;u=u&&(typeof u=="object"?u:{ideal:u});const l=i.version<66;if(u&&(u.exact==="user"||u.exact==="environment"||u.ideal==="user"||u.ideal==="environment")&&!(t.mediaDevices.getSupportedConstraints&&t.mediaDevices.getSupportedConstraints().facingMode&&!l)){delete c.video.facingMode;let f;if(u.exact==="environment"||u.ideal==="environment"?f=["back","rear"]:(u.exact==="user"||u.ideal==="user")&&(f=["front"]),f)return t.mediaDevices.enumerateDevices().then(p=>{p=p.filter(g=>g.kind==="videoinput");let m=p.find(g=>f.some(S=>g.label.toLowerCase().includes(S)));return!m&&p.length&&f.includes("back")&&(m=p[p.length-1]),m&&(c.video.deviceId=u.exact?{exact:m.deviceId}:{ideal:m.deviceId}),c.video=n(c.video),logging("chrome: "+JSON.stringify(c)),d(c)})}c.video=n(c.video)}return logging("chrome: "+JSON.stringify(c)),d(c)},s=function(c){return i.version>=64?c:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[c.name]||c.name,message:c.message,constraint:c.constraint||c.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(c,d,u){a(c,l=>{t.webkitGetUserMedia(l,d,f=>{u&&u(s(f))})})};if(t.getUserMedia=o.bind(t),t.mediaDevices.getUserMedia){const c=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(d){return a(d,u=>c(u).then(l=>{if(u.audio&&!l.getAudioTracks().length||u.video&&!l.getVideoTracks().length)throw l.getTracks().forEach(f=>{f.stop()}),new DOMException("","NotFoundError");return l},l=>Promise.reject(s(l))))}}}function shimGetDisplayMedia$1(e,i){if(!(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices)&&!!e.navigator.mediaDevices){if(typeof i!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}e.navigator.mediaDevices.getDisplayMedia=function(n){return i(n).then(a=>{const s=n.video&&n.video.width,o=n.video&&n.video.height,c=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:a,maxFrameRate:c||3}},s&&(n.video.mandatory.maxWidth=s),o&&(n.video.mandatory.maxHeight=o),e.navigator.mediaDevices.getUserMedia(n)})}}}function shimMediaStream(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function shimOnTrack$1(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(t){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=t)},enumerable:!0,configurable:!0});const i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",a=>{let s;e.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(c=>c.track&&c.track.id===a.track.id):s={track:a.track};const o=new Event("track");o.track=a.track,o.receiver=s,o.transceiver={receiver:s},o.streams=[n.stream],this.dispatchEvent(o)}),n.stream.getTracks().forEach(a=>{let s;e.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(c=>c.track&&c.track.id===a.id):s={track:a};const o=new Event("track");o.track=a,o.receiver=s,o.transceiver={receiver:s},o.streams=[n.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),i.apply(this,arguments)}}else wrapPeerConnectionEvent(e,"track",i=>(i.transceiver||Object.defineProperty(i,"transceiver",{value:{receiver:i.receiver}}),i))}function shimGetSendersWithDtmf(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const i=function(a,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=a.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:a}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const a=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(c,d){let u=a.apply(this,arguments);return u||(u=i(this,c),this._senders.push(u)),u};const s=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(c){s.apply(this,arguments);const d=this._senders.indexOf(c);d!==-1&&this._senders.splice(d,1)}}const t=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],t.apply(this,[s]),s.getTracks().forEach(o=>{this._senders.push(i(this,o))})};const n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],n.apply(this,[s]),s.getTracks().forEach(o=>{const c=this._senders.find(d=>d.track===o);c&&this._senders.splice(this._senders.indexOf(c),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const i=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const n=i.apply(this,[]);return n.forEach(a=>a._pc=this),n},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function shimGetStats(e){if(!e.RTCPeerConnection)return;const i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[n,a,s]=arguments;if(arguments.length>0&&typeof n=="function")return i.apply(this,arguments);if(i.length===0&&(arguments.length===0||typeof n!="function"))return i.apply(this,[]);const o=function(d){const u={};return d.result().forEach(f=>{const p={id:f.id,timestamp:f.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[f.type]||f.type};f.names().forEach(m=>{p[m]=f.stat(m)}),u[p.id]=p}),u},c=function(d){return new Map(Object.keys(d).map(u=>[u,d[u]]))};if(arguments.length>=2){const d=function(u){a(c(o(u)))};return i.apply(this,[d,n])}return new Promise((d,u)=>{i.apply(this,[function(l){d(c(o(l)))},u])}).then(a,s)}}function shimSenderReceiverGetStats(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const s=t.apply(this,[]);return s.forEach(o=>o._pc=this),s});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const s=n.apply(this,arguments);return s._pc=this,s}),e.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(o=>filterStats(o,s.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const a=t.apply(this,[]);return a.forEach(s=>s._pc=this),a}),wrapPeerConnectionEvent(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){const a=this;return this._pc.getStats().then(s=>filterStats(s,a.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype))return;const i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const n=arguments[0];let a,s,o;return this.getSenders().forEach(c=>{c.track===n&&(a?o=!0:a=c)}),this.getReceivers().forEach(c=>(c.track===n&&(s?o=!0:s=c),c.track===n)),o||a&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):a?a.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return i.apply(this,arguments)}}function shimAddTrackRemoveTrackWithNative(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(o,c){if(!c)return i.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const d=i.apply(this,arguments);return this._shimmedLocalStreams[c.id]?this._shimmedLocalStreams[c.id].indexOf(d)===-1&&this._shimmedLocalStreams[c.id].push(d):this._shimmedLocalStreams[c.id]=[c,d],d};const t=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(u=>{if(this.getSenders().find(f=>f.track===u))throw new DOMException("Track already exists.","InvalidAccessError")});const c=this.getSenders();t.apply(this,arguments);const d=this.getSenders().filter(u=>c.indexOf(u)===-1);this._shimmedLocalStreams[o.id]=[o].concat(d)};const n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],n.apply(this,arguments)};const a=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(c=>{const d=this._shimmedLocalStreams[c].indexOf(o);d!==-1&&this._shimmedLocalStreams[c].splice(d,1),this._shimmedLocalStreams[c].length===1&&delete this._shimmedLocalStreams[c]}),a.apply(this,arguments)}}function shimAddTrackRemoveTrack(e,i){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&i.version>=65)return shimAddTrackRemoveTrackWithNative(e);const t=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const l=t.apply(this);return this._reverseStreams=this._reverseStreams||{},l.map(f=>this._reverseStreams[f.id])};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(l){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},l.getTracks().forEach(f=>{if(this.getSenders().find(m=>m.track===f))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[l.id]){const f=new e.MediaStream(l.getTracks());this._streams[l.id]=f,this._reverseStreams[f.id]=l,l=f}n.apply(this,[l])};const a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(l){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},a.apply(this,[this._streams[l.id]||l]),delete this._reverseStreams[this._streams[l.id]?this._streams[l.id].id:l.id],delete this._streams[l.id]},e.RTCPeerConnection.prototype.addTrack=function(l,f){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const p=[].slice.call(arguments,1);if(p.length!==1||!p[0].getTracks().find(S=>S===l))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(S=>S.track===l))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const g=this._streams[f.id];if(g)g.addTrack(l),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const S=new e.MediaStream([l]);this._streams[f.id]=S,this._reverseStreams[S.id]=f,this.addStream(S)}return this.getSenders().find(S=>S.track===l)};function s(u,l){let f=l.sdp;return Object.keys(u._reverseStreams||[]).forEach(p=>{const m=u._reverseStreams[p],g=u._streams[m.id];f=f.replace(new RegExp(g.id,"g"),m.id)}),new RTCSessionDescription({type:l.type,sdp:f})}function o(u,l){let f=l.sdp;return Object.keys(u._reverseStreams||[]).forEach(p=>{const m=u._reverseStreams[p],g=u._streams[m.id];f=f.replace(new RegExp(m.id,"g"),g.id)}),new RTCSessionDescription({type:l.type,sdp:f})}["createOffer","createAnswer"].forEach(function(u){const l=e.RTCPeerConnection.prototype[u],f={[u](){const p=arguments;return arguments.length&&typeof arguments[0]=="function"?l.apply(this,[g=>{const S=s(this,g);p[0].apply(null,[S])},g=>{p[1]&&p[1].apply(null,g)},arguments[2]]):l.apply(this,arguments).then(g=>s(this,g))}};e.RTCPeerConnection.prototype[u]=f[u]});const c=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?c.apply(this,arguments):(arguments[0]=o(this,arguments[0]),c.apply(this,arguments))};const d=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const u=d.get.apply(this);return u.type===""?u:s(this,u)}}),e.RTCPeerConnection.prototype.removeTrack=function(l){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!l._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(l._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let p;Object.keys(this._streams).forEach(m=>{this._streams[m].getTracks().find(S=>l.track===S)&&(p=this._streams[m])}),p&&(p.getTracks().length===1?this.removeStream(this._reverseStreams[p.id]):p.removeTrack(l.track),this.dispatchEvent(new Event("negotiationneeded")))}}function shimPeerConnection$1(e,i){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),!!e.RTCPeerConnection&&i.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const n=e.RTCPeerConnection.prototype[t],a={[t](){return arguments[0]=new(t==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=a[t]})}function fixNegotiationNeeded(e,i){wrapPeerConnectionEvent(e,"negotiationneeded",t=>{const n=t.target;if(!((i.version<72||n.getConfiguration&&n.getConfiguration().sdpSemantics==="plan-b")&&n.signalingState!=="stable"))return t})}const chromeShim=Object.freeze(Object.defineProperty({__proto__:null,shimMediaStream,shimOnTrack:shimOnTrack$1,shimGetSendersWithDtmf,shimGetStats,shimSenderReceiverGetStats,shimAddTrackRemoveTrackWithNative,shimAddTrackRemoveTrack,shimPeerConnection:shimPeerConnection$1,fixNegotiationNeeded,shimGetUserMedia:shimGetUserMedia$2,shimGetDisplayMedia:shimGetDisplayMedia$1},Symbol.toStringTag,{value:"Module"}));function shimGetUserMedia$1(e,i){const t=e&&e.navigator,n=e&&e.MediaStreamTrack;if(t.getUserMedia=function(a,s,o){deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),t.mediaDevices.getUserMedia(a).then(s,o)},!(i.version>55&&"autoGainControl"in t.mediaDevices.getSupportedConstraints())){const a=function(o,c,d){c in o&&!(d in o)&&(o[d]=o[c],delete o[c])},s=t.mediaDevices.getUserMedia.bind(t.mediaDevices);if(t.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),a(o.audio,"autoGainControl","mozAutoGainControl"),a(o.audio,"noiseSuppression","mozNoiseSuppression")),s(o)},n&&n.prototype.getSettings){const o=n.prototype.getSettings;n.prototype.getSettings=function(){const c=o.apply(this,arguments);return a(c,"mozAutoGainControl","autoGainControl"),a(c,"mozNoiseSuppression","noiseSuppression"),c}}if(n&&n.prototype.applyConstraints){const o=n.prototype.applyConstraints;n.prototype.applyConstraints=function(c){return this.kind==="audio"&&typeof c=="object"&&(c=JSON.parse(JSON.stringify(c)),a(c,"autoGainControl","mozAutoGainControl"),a(c,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[c])}}}}function shimGetDisplayMedia(e,i){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||!e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!(n&&n.video)){const a=new DOMException("getDisplayMedia without video constraints is undefined");return a.name="NotFoundError",a.code=8,Promise.reject(a)}return n.video===!0?n.video={mediaSource:i}:n.video.mediaSource=i,e.navigator.mediaDevices.getUserMedia(n)})}function shimOnTrack(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function shimPeerConnection(e,i){if(typeof e!="object"||!(e.RTCPeerConnection||e.mozRTCPeerConnection))return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),i.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){const s=e.RTCPeerConnection.prototype[a],o={[a](){return arguments[0]=new(a==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};e.RTCPeerConnection.prototype[a]=o[a]});const t={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[s,o,c]=arguments;return n.apply(this,[s||null]).then(d=>{if(i.version<53&&!o)try{d.forEach(u=>{u.type=t[u.type]||u.type})}catch(u){if(u.name!=="TypeError")throw u;d.forEach((l,f)=>{d.set(f,Object.assign({},l,{type:t[l.type]||l.type}))})}return d}).then(o,c)}}function shimSenderGetStats(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const i=e.RTCPeerConnection.prototype.getSenders;i&&(e.RTCPeerConnection.prototype.getSenders=function(){const a=i.apply(this,[]);return a.forEach(s=>s._pc=this),a});const t=e.RTCPeerConnection.prototype.addTrack;t&&(e.RTCPeerConnection.prototype.addTrack=function(){const a=t.apply(this,arguments);return a._pc=this,a}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function shimReceiverGetStats(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){const n=i.apply(this,[]);return n.forEach(a=>a._pc=this),n}),wrapPeerConnectionEvent(e,"track",t=>(t.receiver._pc=t.srcElement,t)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function shimRemoveStream(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){deprecated("removeStream","removeTrack"),this.getSenders().forEach(n=>{n.track&&t.getTracks().includes(n.track)&&this.removeTrack(n)})})}function shimRTCDataChannel(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function shimAddTransceiver(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const i=e.RTCPeerConnection.prototype.addTransceiver;i&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const n=arguments[1],a=n&&"sendEncodings"in n;a&&n.sendEncodings.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=i.apply(this,arguments);if(a){const{sender:o}=s,c=o.getParameters();(!("encodings"in c)||c.encodings.length===1&&Object.keys(c.encodings[0]).length===0)&&(c.encodings=n.sendEncodings,o.sendEncodings=n.sendEncodings,this.setParametersPromises.push(o.setParameters(c).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return s})}function shimGetParameters(e){if(!(typeof e=="object"&&e.RTCRtpSender))return;const i=e.RTCRtpSender.prototype.getParameters;i&&(e.RTCRtpSender.prototype.getParameters=function(){const n=i.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function shimCreateOffer(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const i=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>i.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):i.apply(this,arguments)}}function shimCreateAnswer(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const i=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>i.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):i.apply(this,arguments)}}const firefoxShim=Object.freeze(Object.defineProperty({__proto__:null,shimOnTrack,shimPeerConnection,shimSenderGetStats,shimReceiverGetStats,shimRemoveStream,shimRTCDataChannel,shimAddTransceiver,shimGetParameters,shimCreateOffer,shimCreateAnswer,shimGetUserMedia:shimGetUserMedia$1,shimGetDisplayMedia},Symbol.toStringTag,{value:"Module"}));function shimLocalStreamsAPI(e){if(!(typeof e!="object"||!e.RTCPeerConnection)){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(n){this._localStreams||(this._localStreams=[]),this._localStreams.includes(n)||this._localStreams.push(n),n.getAudioTracks().forEach(a=>i.call(this,a,n)),n.getVideoTracks().forEach(a=>i.call(this,a,n))},e.RTCPeerConnection.prototype.addTrack=function(n,...a){return a&&a.forEach(s=>{this._localStreams?this._localStreams.includes(s)||this._localStreams.push(s):this._localStreams=[s]}),i.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(t);if(n===-1)return;this._localStreams.splice(n,1);const a=t.getTracks();this.getSenders().forEach(s=>{a.includes(s.track)&&this.removeTrack(s)})})}}function shimRemoteStreamsAPI(e){if(!(typeof e!="object"||!e.RTCPeerConnection)&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(t){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=t),this.addEventListener("track",this._onaddstreampoly=n=>{n.streams.forEach(a=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(a))return;this._remoteStreams.push(a);const s=new Event("addstream");s.stream=a,this.dispatchEvent(s)})})}});const i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach(s=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(s)>=0)return;n._remoteStreams.push(s);const o=new Event("addstream");o.stream=s,n.dispatchEvent(o)})}),i.apply(n,arguments)}}}function shimCallbacksAPI(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const i=e.RTCPeerConnection.prototype,t=i.createOffer,n=i.createAnswer,a=i.setLocalDescription,s=i.setRemoteDescription,o=i.addIceCandidate;i.createOffer=function(u,l){const f=arguments.length>=2?arguments[2]:arguments[0],p=t.apply(this,[f]);return l?(p.then(u,l),Promise.resolve()):p},i.createAnswer=function(u,l){const f=arguments.length>=2?arguments[2]:arguments[0],p=n.apply(this,[f]);return l?(p.then(u,l),Promise.resolve()):p};let c=function(d,u,l){const f=a.apply(this,[d]);return l?(f.then(u,l),Promise.resolve()):f};i.setLocalDescription=c,c=function(d,u,l){const f=s.apply(this,[d]);return l?(f.then(u,l),Promise.resolve()):f},i.setRemoteDescription=c,c=function(d,u,l){const f=o.apply(this,[d]);return l?(f.then(u,l),Promise.resolve()):f},i.addIceCandidate=c}function shimGetUserMedia(e){const i=e&&e.navigator;if(i.mediaDevices&&i.mediaDevices.getUserMedia){const t=i.mediaDevices,n=t.getUserMedia.bind(t);i.mediaDevices.getUserMedia=a=>n(shimConstraints(a))}!i.getUserMedia&&i.mediaDevices&&i.mediaDevices.getUserMedia&&(i.getUserMedia=function(n,a,s){i.mediaDevices.getUserMedia(n).then(a,s)}.bind(i))}function shimConstraints(e){return e&&e.video!==void 0?Object.assign({},e,{video:compactObject(e.video)}):e}function shimRTCIceServerUrls(e){if(!e.RTCPeerConnection)return;const i=e.RTCPeerConnection;e.RTCPeerConnection=function(n,a){if(n&&n.iceServers){const s=[];for(let o=0;o<n.iceServers.length;o++){let c=n.iceServers[o];!c.hasOwnProperty("urls")&&c.hasOwnProperty("url")?(deprecated("RTCIceServer.url","RTCIceServer.urls"),c=JSON.parse(JSON.stringify(c)),c.urls=c.url,delete c.url,s.push(c)):s.push(n.iceServers[o])}n.iceServers=s}return new i(n,a)},e.RTCPeerConnection.prototype=i.prototype,"generateCertificate"in i&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get(){return i.generateCertificate}})}function shimTrackEventTransceiver(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function shimCreateOfferLegacy(e){const i=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(n){if(n){typeof n.offerToReceiveAudio<"u"&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const a=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&a?a.direction==="sendrecv"?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":a.direction==="recvonly"&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):n.offerToReceiveAudio===!0&&!a&&this.addTransceiver("audio",{direction:"recvonly"}),typeof n.offerToReceiveVideo<"u"&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):n.offerToReceiveVideo===!0&&!s&&this.addTransceiver("video",{direction:"recvonly"})}return i.apply(this,arguments)}}function shimAudioContext(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}const safariShim=Object.freeze(Object.defineProperty({__proto__:null,shimLocalStreamsAPI,shimRemoteStreamsAPI,shimCallbacksAPI,shimGetUserMedia,shimConstraints,shimRTCIceServerUrls,shimTrackEventTransceiver,shimCreateOfferLegacy,shimAudioContext},Symbol.toStringTag,{value:"Module"}));var sdp$1={exports:{}};(function(e){const i={};i.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},i.localCName=i.generateIdentifier(),i.splitLines=function(t){return t.trim().split(`
`).map(n=>n.trim())},i.splitSections=function(t){return t.split(`
m=`).map((a,s)=>(s>0?"m="+a:a).trim()+`\r
`)},i.getDescription=function(t){const n=i.splitSections(t);return n&&n[0]},i.getMediaSections=function(t){const n=i.splitSections(t);return n.shift(),n},i.matchPrefix=function(t,n){return i.splitLines(t).filter(a=>a.indexOf(n)===0)},i.parseCandidate=function(t){let n;t.indexOf("a=candidate:")===0?n=t.substring(12).split(" "):n=t.substring(10).split(" ");const a={foundation:n[0],component:{1:"rtp",2:"rtcp"}[n[1]]||n[1],protocol:n[2].toLowerCase(),priority:parseInt(n[3],10),ip:n[4],address:n[4],port:parseInt(n[5],10),type:n[7]};for(let s=8;s<n.length;s+=2)switch(n[s]){case"raddr":a.relatedAddress=n[s+1];break;case"rport":a.relatedPort=parseInt(n[s+1],10);break;case"tcptype":a.tcpType=n[s+1];break;case"ufrag":a.ufrag=n[s+1],a.usernameFragment=n[s+1];break;default:a[n[s]]===void 0&&(a[n[s]]=n[s+1]);break}return a},i.writeCandidate=function(t){const n=[];n.push(t.foundation);const a=t.component;a==="rtp"?n.push(1):a==="rtcp"?n.push(2):n.push(a),n.push(t.protocol.toUpperCase()),n.push(t.priority),n.push(t.address||t.ip),n.push(t.port);const s=t.type;return n.push("typ"),n.push(s),s!=="host"&&t.relatedAddress&&t.relatedPort&&(n.push("raddr"),n.push(t.relatedAddress),n.push("rport"),n.push(t.relatedPort)),t.tcpType&&t.protocol.toLowerCase()==="tcp"&&(n.push("tcptype"),n.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(n.push("ufrag"),n.push(t.usernameFragment||t.ufrag)),"candidate:"+n.join(" ")},i.parseIceOptions=function(t){return t.substr(14).split(" ")},i.parseRtpMap=function(t){let n=t.substr(9).split(" ");const a={payloadType:parseInt(n.shift(),10)};return n=n[0].split("/"),a.name=n[0],a.clockRate=parseInt(n[1],10),a.channels=n.length===3?parseInt(n[2],10):1,a.numChannels=a.channels,a},i.writeRtpMap=function(t){let n=t.payloadType;t.preferredPayloadType!==void 0&&(n=t.preferredPayloadType);const a=t.channels||t.numChannels||1;return"a=rtpmap:"+n+" "+t.name+"/"+t.clockRate+(a!==1?"/"+a:"")+`\r
`},i.parseExtmap=function(t){const n=t.substr(9).split(" ");return{id:parseInt(n[0],10),direction:n[0].indexOf("/")>0?n[0].split("/")[1]:"sendrecv",uri:n[1]}},i.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&t.direction!=="sendrecv"?"/"+t.direction:"")+" "+t.uri+`\r
`},i.parseFmtp=function(t){const n={};let a;const s=t.substr(t.indexOf(" ")+1).split(";");for(let o=0;o<s.length;o++)a=s[o].trim().split("="),n[a[0].trim()]=a[1];return n},i.writeFmtp=function(t){let n="",a=t.payloadType;if(t.preferredPayloadType!==void 0&&(a=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){const s=[];Object.keys(t.parameters).forEach(o=>{t.parameters[o]!==void 0?s.push(o+"="+t.parameters[o]):s.push(o)}),n+="a=fmtp:"+a+" "+s.join(";")+`\r
`}return n},i.parseRtcpFb=function(t){const n=t.substr(t.indexOf(" ")+1).split(" ");return{type:n.shift(),parameter:n.join(" ")}},i.writeRtcpFb=function(t){let n="",a=t.payloadType;return t.preferredPayloadType!==void 0&&(a=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach(s=>{n+="a=rtcp-fb:"+a+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),n},i.parseSsrcMedia=function(t){const n=t.indexOf(" "),a={ssrc:parseInt(t.substr(7,n-7),10)},s=t.indexOf(":",n);return s>-1?(a.attribute=t.substr(n+1,s-n-1),a.value=t.substr(s+1)):a.attribute=t.substr(n+1),a},i.parseSsrcGroup=function(t){const n=t.substr(13).split(" ");return{semantics:n.shift(),ssrcs:n.map(a=>parseInt(a,10))}},i.getMid=function(t){const n=i.matchPrefix(t,"a=mid:")[0];if(n)return n.substr(6)},i.parseFingerprint=function(t){const n=t.substr(14).split(" ");return{algorithm:n[0].toLowerCase(),value:n[1].toUpperCase()}},i.getDtlsParameters=function(t,n){const a=i.matchPrefix(t+n,"a=fingerprint:");return{role:"auto",fingerprints:a.map(i.parseFingerprint)}},i.writeDtlsParameters=function(t,n){let a="a=setup:"+n+`\r
`;return t.fingerprints.forEach(s=>{a+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),a},i.parseCryptoLine=function(t){const n=t.substr(9).split(" ");return{tag:parseInt(n[0],10),cryptoSuite:n[1],keyParams:n[2],sessionParams:n.slice(3)}},i.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+(typeof t.keyParams=="object"?i.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+`\r
`},i.parseCryptoKeyParams=function(t){if(t.indexOf("inline:")!==0)return null;const n=t.substr(7).split("|");return{keyMethod:"inline",keySalt:n[0],lifeTime:n[1],mkiValue:n[2]?n[2].split(":")[0]:void 0,mkiLength:n[2]?n[2].split(":")[1]:void 0}},i.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")},i.getCryptoParameters=function(t,n){return i.matchPrefix(t+n,"a=crypto:").map(i.parseCryptoLine)},i.getIceParameters=function(t,n){const a=i.matchPrefix(t+n,"a=ice-ufrag:")[0],s=i.matchPrefix(t+n,"a=ice-pwd:")[0];return a&&s?{usernameFragment:a.substr(12),password:s.substr(10)}:null},i.writeIceParameters=function(t){let n="a=ice-ufrag:"+t.usernameFragment+`\r
a=ice-pwd:`+t.password+`\r
`;return t.iceLite&&(n+=`a=ice-lite\r
`),n},i.parseRtpParameters=function(t){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=i.splitLines(t)[0].split(" ");for(let o=3;o<s.length;o++){const c=s[o],d=i.matchPrefix(t,"a=rtpmap:"+c+" ")[0];if(d){const u=i.parseRtpMap(d),l=i.matchPrefix(t,"a=fmtp:"+c+" ");switch(u.parameters=l.length?i.parseFmtp(l[0]):{},u.rtcpFeedback=i.matchPrefix(t,"a=rtcp-fb:"+c+" ").map(i.parseRtcpFb),n.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(u.name.toUpperCase());break}}}return i.matchPrefix(t,"a=extmap:").forEach(o=>{n.headerExtensions.push(i.parseExtmap(o))}),n},i.writeRtpDescription=function(t,n){let a="";a+="m="+t+" ",a+=n.codecs.length>0?"9":"0",a+=" UDP/TLS/RTP/SAVPF ",a+=n.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,a+=`c=IN IP4 0.0.0.0\r
`,a+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,n.codecs.forEach(o=>{a+=i.writeRtpMap(o),a+=i.writeFmtp(o),a+=i.writeRtcpFb(o)});let s=0;return n.codecs.forEach(o=>{o.maxptime>s&&(s=o.maxptime)}),s>0&&(a+="a=maxptime:"+s+`\r
`),n.headerExtensions&&n.headerExtensions.forEach(o=>{a+=i.writeExtmap(o)}),a},i.parseRtpEncodingParameters=function(t){const n=[],a=i.parseRtpParameters(t),s=a.fecMechanisms.indexOf("RED")!==-1,o=a.fecMechanisms.indexOf("ULPFEC")!==-1,c=i.matchPrefix(t,"a=ssrc:").map(p=>i.parseSsrcMedia(p)).filter(p=>p.attribute==="cname"),d=c.length>0&&c[0].ssrc;let u;const l=i.matchPrefix(t,"a=ssrc-group:FID").map(p=>p.substr(17).split(" ").map(g=>parseInt(g,10)));l.length>0&&l[0].length>1&&l[0][0]===d&&(u=l[0][1]),a.codecs.forEach(p=>{if(p.name.toUpperCase()==="RTX"&&p.parameters.apt){let m={ssrc:d,codecPayloadType:parseInt(p.parameters.apt,10)};d&&u&&(m.rtx={ssrc:u}),n.push(m),s&&(m=JSON.parse(JSON.stringify(m)),m.fec={ssrc:d,mechanism:o?"red+ulpfec":"red"},n.push(m))}}),n.length===0&&d&&n.push({ssrc:d});let f=i.matchPrefix(t,"b=");return f.length&&(f[0].indexOf("b=TIAS:")===0?f=parseInt(f[0].substr(7),10):f[0].indexOf("b=AS:")===0?f=parseInt(f[0].substr(5),10)*1e3*.95-50*40*8:f=void 0,n.forEach(p=>{p.maxBitrate=f})),n},i.parseRtcpParameters=function(t){const n={},a=i.matchPrefix(t,"a=ssrc:").map(c=>i.parseSsrcMedia(c)).filter(c=>c.attribute==="cname")[0];a&&(n.cname=a.value,n.ssrc=a.ssrc);const s=i.matchPrefix(t,"a=rtcp-rsize");n.reducedSize=s.length>0,n.compound=s.length===0;const o=i.matchPrefix(t,"a=rtcp-mux");return n.mux=o.length>0,n},i.writeRtcpParameters=function(t){let n="";return t.reducedSize&&(n+=`a=rtcp-rsize\r
`),t.mux&&(n+=`a=rtcp-mux\r
`),t.ssrc!==void 0&&t.cname&&(n+="a=ssrc:"+t.ssrc+" cname:"+t.cname+`\r
`),n},i.parseMsid=function(t){let n;const a=i.matchPrefix(t,"a=msid:");if(a.length===1)return n=a[0].substr(7).split(" "),{stream:n[0],track:n[1]};const s=i.matchPrefix(t,"a=ssrc:").map(o=>i.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(s.length>0)return n=s[0].value.split(" "),{stream:n[0],track:n[1]}},i.parseSctpDescription=function(t){const n=i.parseMLine(t),a=i.matchPrefix(t,"a=max-message-size:");let s;a.length>0&&(s=parseInt(a[0].substr(19),10)),isNaN(s)&&(s=65536);const o=i.matchPrefix(t,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substr(12),10),protocol:n.fmt,maxMessageSize:s};const c=i.matchPrefix(t,"a=sctpmap:");if(c.length>0){const d=c[0].substr(10).split(" ");return{port:parseInt(d[0],10),protocol:d[1],maxMessageSize:s}}},i.writeSctpDescription=function(t,n){let a=[];return t.protocol!=="DTLS/SCTP"?a=["m="+t.kind+" 9 "+t.protocol+" "+n.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+n.port+`\r
`]:a=["m="+t.kind+" 9 "+t.protocol+" "+n.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+n.port+" "+n.protocol+` 65535\r
`],n.maxMessageSize!==void 0&&a.push("a=max-message-size:"+n.maxMessageSize+`\r
`),a.join("")},i.generateSessionId=function(){return Math.random().toString().substr(2,21)},i.writeSessionBoilerplate=function(t,n,a){let s;const o=n!==void 0?n:2;return t?s=t:s=i.generateSessionId(),`v=0\r
o=`+(a||"thisisadapterortc")+" "+s+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},i.getDirection=function(t,n){const a=i.splitLines(t);for(let s=0;s<a.length;s++)switch(a[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return a[s].substr(2)}return n?i.getDirection(n):"sendrecv"},i.getKind=function(t){return i.splitLines(t)[0].split(" ")[0].substr(2)},i.isRejected=function(t){return t.split(" ",2)[1]==="0"},i.parseMLine=function(t){const a=i.splitLines(t)[0].substr(2).split(" ");return{kind:a[0],port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}},i.parseOLine=function(t){const a=i.matchPrefix(t,"o=")[0].substr(2).split(" ");return{username:a[0],sessionId:a[1],sessionVersion:parseInt(a[2],10),netType:a[3],addressType:a[4],address:a[5]}},i.isValidSDP=function(t){if(typeof t!="string"||t.length===0)return!1;const n=i.splitLines(t);for(let a=0;a<n.length;a++)if(n[a].length<2||n[a].charAt(1)!=="=")return!1;return!0},e.exports=i})(sdp$1);const SDPUtils=sdp$1.exports,sdp=_mergeNamespaces({__proto__:null,default:SDPUtils},[sdp$1.exports]);function shimRTCIceCandidate(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const i=e.RTCIceCandidate;e.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&(n=JSON.parse(JSON.stringify(n)),n.candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const a=new i(n),s=SDPUtils.parseCandidate(n.candidate),o=Object.assign(a,s);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new i(n)},e.RTCIceCandidate.prototype=i.prototype,wrapPeerConnectionEvent(e,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t))}function shimMaxMessageSize(e,i){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const t=function(c){if(!c||!c.sdp)return!1;const d=SDPUtils.splitSections(c.sdp);return d.shift(),d.some(u=>{const l=SDPUtils.parseMLine(u);return l&&l.kind==="application"&&l.protocol.indexOf("SCTP")!==-1})},n=function(c){const d=c.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(d===null||d.length<2)return-1;const u=parseInt(d[1],10);return u!==u?-1:u},a=function(c){let d=65536;return i.browser==="firefox"&&(i.version<57?c===-1?d=16384:d=2147483637:i.version<60?d=i.version===57?65535:65536:d=2147483637),d},s=function(c,d){let u=65536;i.browser==="firefox"&&i.version===57&&(u=65535);const l=SDPUtils.matchPrefix(c.sdp,"a=max-message-size:");return l.length>0?u=parseInt(l[0].substr(19),10):i.browser==="firefox"&&d!==-1&&(u=2147483637),u},o=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,i.browser==="chrome"&&i.version>=76){const{sdpSemantics:d}=this.getConfiguration();d==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(t(arguments[0])){const d=n(arguments[0]),u=a(d),l=s(arguments[0],d);let f;u===0&&l===0?f=Number.POSITIVE_INFINITY:u===0||l===0?f=Math.max(u,l):f=Math.min(u,l);const p={};Object.defineProperty(p,"maxMessageSize",{get(){return f}}),this._sctp=p}return o.apply(this,arguments)}}function shimSendThrowTypeError(e){if(!(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype))return;function i(n,a){const s=n.send;n.send=function(){const c=arguments[0],d=c.length||c.size||c.byteLength;if(n.readyState==="open"&&a.sctp&&d>a.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+a.sctp.maxMessageSize+" bytes)");return s.apply(n,arguments)}}const t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const a=t.apply(this,arguments);return i(a,this),a},wrapPeerConnectionEvent(e,"datachannel",n=>(i(n.channel,n.target),n))}function shimConnectionState(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const i=e.RTCPeerConnection.prototype;Object.defineProperty(i,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(i,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(t){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),t&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=t)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(t=>{const n=i[t];i[t]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=a=>{const s=a.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const o=new Event("connectionstatechange",a);s.dispatchEvent(o)}return a},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}function removeExtmapAllowMixed(e,i){if(!e.RTCPeerConnection||i.browser==="chrome"&&i.version>=71||i.browser==="safari"&&i.version>=605)return;const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(a){if(a&&a.sdp&&a.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=a.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&a instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:a.type,sdp:s}):a.sdp=s}return t.apply(this,arguments)}}function shimAddIceCandidateNullOrEmpty(e,i){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;const t=e.RTCPeerConnection.prototype.addIceCandidate;!t||t.length===0||(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(i.browser==="chrome"&&i.version<78||i.browser==="firefox"&&i.version<68||i.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function shimParameterlessSetLocalDescription(e,i){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;const t=e.RTCPeerConnection.prototype.setLocalDescription;!t||t.length===0||(e.RTCPeerConnection.prototype.setLocalDescription=function(){let a=arguments[0]||{};if(typeof a!="object"||a.type&&a.sdp)return t.apply(this,arguments);if(a={type:a.type,sdp:a.sdp},!a.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":a.type="offer";break;default:a.type="answer";break}return a.sdp||a.type!=="offer"&&a.type!=="answer"?t.apply(this,[a]):(a.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>t.apply(this,[o]))})}const commonShim=Object.freeze(Object.defineProperty({__proto__:null,shimRTCIceCandidate,shimMaxMessageSize,shimSendThrowTypeError,shimConnectionState,removeExtmapAllowMixed,shimAddIceCandidateNullOrEmpty,shimParameterlessSetLocalDescription},Symbol.toStringTag,{value:"Module"}));function adapterFactory({window:e}={},i={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const t=log,n=detectBrowser(e),a={browserDetails:n,commonShim,extractVersion,disableLog,disableWarnings,sdp};switch(n.browser){case"chrome":if(!chromeShim||!shimPeerConnection$1||!i.shimChrome)return t("Chrome shim is not included in this adapter release."),a;if(n.version===null)return t("Chrome shim can not determine version, not shimming."),a;t("adapter.js shimming chrome."),a.browserShim=chromeShim,shimAddIceCandidateNullOrEmpty(e,n),shimParameterlessSetLocalDescription(e),shimGetUserMedia$2(e,n),shimMediaStream(e),shimPeerConnection$1(e,n),shimOnTrack$1(e),shimAddTrackRemoveTrack(e,n),shimGetSendersWithDtmf(e),shimGetStats(e),shimSenderReceiverGetStats(e),fixNegotiationNeeded(e,n),shimRTCIceCandidate(e),shimConnectionState(e),shimMaxMessageSize(e,n),shimSendThrowTypeError(e),removeExtmapAllowMixed(e,n);break;case"firefox":if(!firefoxShim||!shimPeerConnection||!i.shimFirefox)return t("Firefox shim is not included in this adapter release."),a;t("adapter.js shimming firefox."),a.browserShim=firefoxShim,shimAddIceCandidateNullOrEmpty(e,n),shimParameterlessSetLocalDescription(e),shimGetUserMedia$1(e,n),shimPeerConnection(e,n),shimOnTrack(e),shimRemoveStream(e),shimSenderGetStats(e),shimReceiverGetStats(e),shimRTCDataChannel(e),shimAddTransceiver(e),shimGetParameters(e),shimCreateOffer(e),shimCreateAnswer(e),shimRTCIceCandidate(e),shimConnectionState(e),shimMaxMessageSize(e,n),shimSendThrowTypeError(e);break;case"safari":if(!safariShim||!i.shimSafari)return t("Safari shim is not included in this adapter release."),a;t("adapter.js shimming safari."),a.browserShim=safariShim,shimAddIceCandidateNullOrEmpty(e,n),shimParameterlessSetLocalDescription(e),shimRTCIceServerUrls(e),shimCreateOfferLegacy(e),shimCallbacksAPI(e),shimLocalStreamsAPI(e),shimRemoteStreamsAPI(e),shimTrackEventTransceiver(e),shimGetUserMedia(e),shimAudioContext(e),shimRTCIceCandidate(e),shimMaxMessageSize(e,n),shimSendThrowTypeError(e),removeExtmapAllowMixed(e,n);break;default:t("Unsupported browser!");break}return a}adapterFactory({window:typeof window>"u"?void 0:window});var SignalTarget=(e=>(e[e.PUBLISHER=0]="PUBLISHER",e[e.SUBSCRIBER=1]="SUBSCRIBER",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e))(SignalTarget||{});function signalTargetFromJSON(e){switch(e){case 0:case"PUBLISHER":return 0;case 1:case"SUBSCRIBER":return 1;case-1:case"UNRECOGNIZED":default:return-1}}function signalTargetToJSON(e){switch(e){case 0:return"PUBLISHER";case 1:return"SUBSCRIBER";case-1:default:return"UNRECOGNIZED"}}var StreamState=(e=>(e[e.ACTIVE=0]="ACTIVE",e[e.PAUSED=1]="PAUSED",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e))(StreamState||{});function streamStateFromJSON(e){switch(e){case 0:case"ACTIVE":return 0;case 1:case"PAUSED":return 1;case-1:case"UNRECOGNIZED":default:return-1}}function streamStateToJSON(e){switch(e){case 0:return"ACTIVE";case 1:return"PAUSED";case-1:default:return"UNRECOGNIZED"}}function candidateProtocolFromJSON(e){switch(e){case 0:case"UDP":return 0;case 1:case"TCP":return 1;case 2:case"TLS":return 2;case-1:case"UNRECOGNIZED":default:return-1}}function candidateProtocolToJSON(e){switch(e){case 0:return"UDP";case 1:return"TCP";case 2:return"TLS";case-1:default:return"UNRECOGNIZED"}}function createBaseSignalRequest(){return{message:void 0}}const SignalRequest={encode(e,i=_m0.Writer.create()){var t,n,a,s,o,c,d,u,l,f,p,m,g,S,v;return((t=e.message)==null?void 0:t.$case)==="offer"&&SessionDescription.encode(e.message.offer,i.uint32(10).fork()).ldelim(),((n=e.message)==null?void 0:n.$case)==="answer"&&SessionDescription.encode(e.message.answer,i.uint32(18).fork()).ldelim(),((a=e.message)==null?void 0:a.$case)==="trickle"&&TrickleRequest.encode(e.message.trickle,i.uint32(26).fork()).ldelim(),((s=e.message)==null?void 0:s.$case)==="addTrack"&&AddTrackRequest.encode(e.message.addTrack,i.uint32(34).fork()).ldelim(),((o=e.message)==null?void 0:o.$case)==="mute"&&MuteTrackRequest.encode(e.message.mute,i.uint32(42).fork()).ldelim(),((c=e.message)==null?void 0:c.$case)==="subscription"&&UpdateSubscription.encode(e.message.subscription,i.uint32(50).fork()).ldelim(),((d=e.message)==null?void 0:d.$case)==="trackSetting"&&UpdateTrackSettings.encode(e.message.trackSetting,i.uint32(58).fork()).ldelim(),((u=e.message)==null?void 0:u.$case)==="leave"&&LeaveRequest.encode(e.message.leave,i.uint32(66).fork()).ldelim(),((l=e.message)==null?void 0:l.$case)==="updateLayers"&&UpdateVideoLayers.encode(e.message.updateLayers,i.uint32(82).fork()).ldelim(),((f=e.message)==null?void 0:f.$case)==="subscriptionPermission"&&SubscriptionPermission.encode(e.message.subscriptionPermission,i.uint32(90).fork()).ldelim(),((p=e.message)==null?void 0:p.$case)==="syncState"&&SyncState.encode(e.message.syncState,i.uint32(98).fork()).ldelim(),((m=e.message)==null?void 0:m.$case)==="simulate"&&SimulateScenario.encode(e.message.simulate,i.uint32(106).fork()).ldelim(),((g=e.message)==null?void 0:g.$case)==="ping"&&i.uint32(112).int64(e.message.ping),((S=e.message)==null?void 0:S.$case)==="updateMetadata"&&UpdateParticipantMetadata.encode(e.message.updateMetadata,i.uint32(122).fork()).ldelim(),((v=e.message)==null?void 0:v.$case)==="pingReq"&&Ping.encode(e.message.pingReq,i.uint32(130).fork()).ldelim(),i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseSignalRequest();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.message={$case:"offer",offer:SessionDescription.decode(t,t.uint32())};break;case 2:a.message={$case:"answer",answer:SessionDescription.decode(t,t.uint32())};break;case 3:a.message={$case:"trickle",trickle:TrickleRequest.decode(t,t.uint32())};break;case 4:a.message={$case:"addTrack",addTrack:AddTrackRequest.decode(t,t.uint32())};break;case 5:a.message={$case:"mute",mute:MuteTrackRequest.decode(t,t.uint32())};break;case 6:a.message={$case:"subscription",subscription:UpdateSubscription.decode(t,t.uint32())};break;case 7:a.message={$case:"trackSetting",trackSetting:UpdateTrackSettings.decode(t,t.uint32())};break;case 8:a.message={$case:"leave",leave:LeaveRequest.decode(t,t.uint32())};break;case 10:a.message={$case:"updateLayers",updateLayers:UpdateVideoLayers.decode(t,t.uint32())};break;case 11:a.message={$case:"subscriptionPermission",subscriptionPermission:SubscriptionPermission.decode(t,t.uint32())};break;case 12:a.message={$case:"syncState",syncState:SyncState.decode(t,t.uint32())};break;case 13:a.message={$case:"simulate",simulate:SimulateScenario.decode(t,t.uint32())};break;case 14:a.message={$case:"ping",ping:longToNumber(t.int64())};break;case 15:a.message={$case:"updateMetadata",updateMetadata:UpdateParticipantMetadata.decode(t,t.uint32())};break;case 16:a.message={$case:"pingReq",pingReq:Ping.decode(t,t.uint32())};break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{message:isSet(e.offer)?{$case:"offer",offer:SessionDescription.fromJSON(e.offer)}:isSet(e.answer)?{$case:"answer",answer:SessionDescription.fromJSON(e.answer)}:isSet(e.trickle)?{$case:"trickle",trickle:TrickleRequest.fromJSON(e.trickle)}:isSet(e.addTrack)?{$case:"addTrack",addTrack:AddTrackRequest.fromJSON(e.addTrack)}:isSet(e.mute)?{$case:"mute",mute:MuteTrackRequest.fromJSON(e.mute)}:isSet(e.subscription)?{$case:"subscription",subscription:UpdateSubscription.fromJSON(e.subscription)}:isSet(e.trackSetting)?{$case:"trackSetting",trackSetting:UpdateTrackSettings.fromJSON(e.trackSetting)}:isSet(e.leave)?{$case:"leave",leave:LeaveRequest.fromJSON(e.leave)}:isSet(e.updateLayers)?{$case:"updateLayers",updateLayers:UpdateVideoLayers.fromJSON(e.updateLayers)}:isSet(e.subscriptionPermission)?{$case:"subscriptionPermission",subscriptionPermission:SubscriptionPermission.fromJSON(e.subscriptionPermission)}:isSet(e.syncState)?{$case:"syncState",syncState:SyncState.fromJSON(e.syncState)}:isSet(e.simulate)?{$case:"simulate",simulate:SimulateScenario.fromJSON(e.simulate)}:isSet(e.ping)?{$case:"ping",ping:Number(e.ping)}:isSet(e.updateMetadata)?{$case:"updateMetadata",updateMetadata:UpdateParticipantMetadata.fromJSON(e.updateMetadata)}:isSet(e.pingReq)?{$case:"pingReq",pingReq:Ping.fromJSON(e.pingReq)}:void 0}},toJSON(e){var t,n,a,s,o,c,d,u,l,f,p,m,g,S,v,T,k,b,y,N,D,B,A,C,I,U,F,M,V,te,J,q,Y,Q,H,X,W,z,Z,j,K,ee,ie,G;const i={};return((t=e.message)==null?void 0:t.$case)==="offer"&&(i.offer=(n=e.message)!=null&&n.offer?SessionDescription.toJSON((a=e.message)==null?void 0:a.offer):void 0),((s=e.message)==null?void 0:s.$case)==="answer"&&(i.answer=(o=e.message)!=null&&o.answer?SessionDescription.toJSON((c=e.message)==null?void 0:c.answer):void 0),((d=e.message)==null?void 0:d.$case)==="trickle"&&(i.trickle=(u=e.message)!=null&&u.trickle?TrickleRequest.toJSON((l=e.message)==null?void 0:l.trickle):void 0),((f=e.message)==null?void 0:f.$case)==="addTrack"&&(i.addTrack=(p=e.message)!=null&&p.addTrack?AddTrackRequest.toJSON((m=e.message)==null?void 0:m.addTrack):void 0),((g=e.message)==null?void 0:g.$case)==="mute"&&(i.mute=(S=e.message)!=null&&S.mute?MuteTrackRequest.toJSON((v=e.message)==null?void 0:v.mute):void 0),((T=e.message)==null?void 0:T.$case)==="subscription"&&(i.subscription=(k=e.message)!=null&&k.subscription?UpdateSubscription.toJSON((b=e.message)==null?void 0:b.subscription):void 0),((y=e.message)==null?void 0:y.$case)==="trackSetting"&&(i.trackSetting=(N=e.message)!=null&&N.trackSetting?UpdateTrackSettings.toJSON((D=e.message)==null?void 0:D.trackSetting):void 0),((B=e.message)==null?void 0:B.$case)==="leave"&&(i.leave=(A=e.message)!=null&&A.leave?LeaveRequest.toJSON((C=e.message)==null?void 0:C.leave):void 0),((I=e.message)==null?void 0:I.$case)==="updateLayers"&&(i.updateLayers=(U=e.message)!=null&&U.updateLayers?UpdateVideoLayers.toJSON((F=e.message)==null?void 0:F.updateLayers):void 0),((M=e.message)==null?void 0:M.$case)==="subscriptionPermission"&&(i.subscriptionPermission=(V=e.message)!=null&&V.subscriptionPermission?SubscriptionPermission.toJSON((te=e.message)==null?void 0:te.subscriptionPermission):void 0),((J=e.message)==null?void 0:J.$case)==="syncState"&&(i.syncState=(q=e.message)!=null&&q.syncState?SyncState.toJSON((Y=e.message)==null?void 0:Y.syncState):void 0),((Q=e.message)==null?void 0:Q.$case)==="simulate"&&(i.simulate=(H=e.message)!=null&&H.simulate?SimulateScenario.toJSON((X=e.message)==null?void 0:X.simulate):void 0),((W=e.message)==null?void 0:W.$case)==="ping"&&(i.ping=Math.round((z=e.message)==null?void 0:z.ping)),((Z=e.message)==null?void 0:Z.$case)==="updateMetadata"&&(i.updateMetadata=(j=e.message)!=null&&j.updateMetadata?UpdateParticipantMetadata.toJSON((K=e.message)==null?void 0:K.updateMetadata):void 0),((ee=e.message)==null?void 0:ee.$case)==="pingReq"&&(i.pingReq=(ie=e.message)!=null&&ie.pingReq?Ping.toJSON((G=e.message)==null?void 0:G.pingReq):void 0),i},fromPartial(e){var t,n,a,s,o,c,d,u,l,f,p,m,g,S,v,T,k,b,y,N,D,B,A,C,I,U,F,M,V,te,J,q,Y,Q,H,X,W,z,Z,j,K,ee,ie,G,ne;const i=createBaseSignalRequest();return((t=e.message)==null?void 0:t.$case)==="offer"&&((n=e.message)==null?void 0:n.offer)!==void 0&&((a=e.message)==null?void 0:a.offer)!==null&&(i.message={$case:"offer",offer:SessionDescription.fromPartial(e.message.offer)}),((s=e.message)==null?void 0:s.$case)==="answer"&&((o=e.message)==null?void 0:o.answer)!==void 0&&((c=e.message)==null?void 0:c.answer)!==null&&(i.message={$case:"answer",answer:SessionDescription.fromPartial(e.message.answer)}),((d=e.message)==null?void 0:d.$case)==="trickle"&&((u=e.message)==null?void 0:u.trickle)!==void 0&&((l=e.message)==null?void 0:l.trickle)!==null&&(i.message={$case:"trickle",trickle:TrickleRequest.fromPartial(e.message.trickle)}),((f=e.message)==null?void 0:f.$case)==="addTrack"&&((p=e.message)==null?void 0:p.addTrack)!==void 0&&((m=e.message)==null?void 0:m.addTrack)!==null&&(i.message={$case:"addTrack",addTrack:AddTrackRequest.fromPartial(e.message.addTrack)}),((g=e.message)==null?void 0:g.$case)==="mute"&&((S=e.message)==null?void 0:S.mute)!==void 0&&((v=e.message)==null?void 0:v.mute)!==null&&(i.message={$case:"mute",mute:MuteTrackRequest.fromPartial(e.message.mute)}),((T=e.message)==null?void 0:T.$case)==="subscription"&&((k=e.message)==null?void 0:k.subscription)!==void 0&&((b=e.message)==null?void 0:b.subscription)!==null&&(i.message={$case:"subscription",subscription:UpdateSubscription.fromPartial(e.message.subscription)}),((y=e.message)==null?void 0:y.$case)==="trackSetting"&&((N=e.message)==null?void 0:N.trackSetting)!==void 0&&((D=e.message)==null?void 0:D.trackSetting)!==null&&(i.message={$case:"trackSetting",trackSetting:UpdateTrackSettings.fromPartial(e.message.trackSetting)}),((B=e.message)==null?void 0:B.$case)==="leave"&&((A=e.message)==null?void 0:A.leave)!==void 0&&((C=e.message)==null?void 0:C.leave)!==null&&(i.message={$case:"leave",leave:LeaveRequest.fromPartial(e.message.leave)}),((I=e.message)==null?void 0:I.$case)==="updateLayers"&&((U=e.message)==null?void 0:U.updateLayers)!==void 0&&((F=e.message)==null?void 0:F.updateLayers)!==null&&(i.message={$case:"updateLayers",updateLayers:UpdateVideoLayers.fromPartial(e.message.updateLayers)}),((M=e.message)==null?void 0:M.$case)==="subscriptionPermission"&&((V=e.message)==null?void 0:V.subscriptionPermission)!==void 0&&((te=e.message)==null?void 0:te.subscriptionPermission)!==null&&(i.message={$case:"subscriptionPermission",subscriptionPermission:SubscriptionPermission.fromPartial(e.message.subscriptionPermission)}),((J=e.message)==null?void 0:J.$case)==="syncState"&&((q=e.message)==null?void 0:q.syncState)!==void 0&&((Y=e.message)==null?void 0:Y.syncState)!==null&&(i.message={$case:"syncState",syncState:SyncState.fromPartial(e.message.syncState)}),((Q=e.message)==null?void 0:Q.$case)==="simulate"&&((H=e.message)==null?void 0:H.simulate)!==void 0&&((X=e.message)==null?void 0:X.simulate)!==null&&(i.message={$case:"simulate",simulate:SimulateScenario.fromPartial(e.message.simulate)}),((W=e.message)==null?void 0:W.$case)==="ping"&&((z=e.message)==null?void 0:z.ping)!==void 0&&((Z=e.message)==null?void 0:Z.ping)!==null&&(i.message={$case:"ping",ping:e.message.ping}),((j=e.message)==null?void 0:j.$case)==="updateMetadata"&&((K=e.message)==null?void 0:K.updateMetadata)!==void 0&&((ee=e.message)==null?void 0:ee.updateMetadata)!==null&&(i.message={$case:"updateMetadata",updateMetadata:UpdateParticipantMetadata.fromPartial(e.message.updateMetadata)}),((ie=e.message)==null?void 0:ie.$case)==="pingReq"&&((G=e.message)==null?void 0:G.pingReq)!==void 0&&((ne=e.message)==null?void 0:ne.pingReq)!==null&&(i.message={$case:"pingReq",pingReq:Ping.fromPartial(e.message.pingReq)}),i}};function createBaseSignalResponse(){return{message:void 0}}const SignalResponse={encode(e,i=_m0.Writer.create()){var t,n,a,s,o,c,d,u,l,f,p,m,g,S,v,T,k,b,y;return((t=e.message)==null?void 0:t.$case)==="join"&&JoinResponse.encode(e.message.join,i.uint32(10).fork()).ldelim(),((n=e.message)==null?void 0:n.$case)==="answer"&&SessionDescription.encode(e.message.answer,i.uint32(18).fork()).ldelim(),((a=e.message)==null?void 0:a.$case)==="offer"&&SessionDescription.encode(e.message.offer,i.uint32(26).fork()).ldelim(),((s=e.message)==null?void 0:s.$case)==="trickle"&&TrickleRequest.encode(e.message.trickle,i.uint32(34).fork()).ldelim(),((o=e.message)==null?void 0:o.$case)==="update"&&ParticipantUpdate.encode(e.message.update,i.uint32(42).fork()).ldelim(),((c=e.message)==null?void 0:c.$case)==="trackPublished"&&TrackPublishedResponse.encode(e.message.trackPublished,i.uint32(50).fork()).ldelim(),((d=e.message)==null?void 0:d.$case)==="leave"&&LeaveRequest.encode(e.message.leave,i.uint32(66).fork()).ldelim(),((u=e.message)==null?void 0:u.$case)==="mute"&&MuteTrackRequest.encode(e.message.mute,i.uint32(74).fork()).ldelim(),((l=e.message)==null?void 0:l.$case)==="speakersChanged"&&SpeakersChanged.encode(e.message.speakersChanged,i.uint32(82).fork()).ldelim(),((f=e.message)==null?void 0:f.$case)==="roomUpdate"&&RoomUpdate.encode(e.message.roomUpdate,i.uint32(90).fork()).ldelim(),((p=e.message)==null?void 0:p.$case)==="connectionQuality"&&ConnectionQualityUpdate.encode(e.message.connectionQuality,i.uint32(98).fork()).ldelim(),((m=e.message)==null?void 0:m.$case)==="streamStateUpdate"&&StreamStateUpdate.encode(e.message.streamStateUpdate,i.uint32(106).fork()).ldelim(),((g=e.message)==null?void 0:g.$case)==="subscribedQualityUpdate"&&SubscribedQualityUpdate.encode(e.message.subscribedQualityUpdate,i.uint32(114).fork()).ldelim(),((S=e.message)==null?void 0:S.$case)==="subscriptionPermissionUpdate"&&SubscriptionPermissionUpdate.encode(e.message.subscriptionPermissionUpdate,i.uint32(122).fork()).ldelim(),((v=e.message)==null?void 0:v.$case)==="refreshToken"&&i.uint32(130).string(e.message.refreshToken),((T=e.message)==null?void 0:T.$case)==="trackUnpublished"&&TrackUnpublishedResponse.encode(e.message.trackUnpublished,i.uint32(138).fork()).ldelim(),((k=e.message)==null?void 0:k.$case)==="pong"&&i.uint32(144).int64(e.message.pong),((b=e.message)==null?void 0:b.$case)==="reconnect"&&ReconnectResponse.encode(e.message.reconnect,i.uint32(154).fork()).ldelim(),((y=e.message)==null?void 0:y.$case)==="pongResp"&&Pong.encode(e.message.pongResp,i.uint32(162).fork()).ldelim(),i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseSignalResponse();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.message={$case:"join",join:JoinResponse.decode(t,t.uint32())};break;case 2:a.message={$case:"answer",answer:SessionDescription.decode(t,t.uint32())};break;case 3:a.message={$case:"offer",offer:SessionDescription.decode(t,t.uint32())};break;case 4:a.message={$case:"trickle",trickle:TrickleRequest.decode(t,t.uint32())};break;case 5:a.message={$case:"update",update:ParticipantUpdate.decode(t,t.uint32())};break;case 6:a.message={$case:"trackPublished",trackPublished:TrackPublishedResponse.decode(t,t.uint32())};break;case 8:a.message={$case:"leave",leave:LeaveRequest.decode(t,t.uint32())};break;case 9:a.message={$case:"mute",mute:MuteTrackRequest.decode(t,t.uint32())};break;case 10:a.message={$case:"speakersChanged",speakersChanged:SpeakersChanged.decode(t,t.uint32())};break;case 11:a.message={$case:"roomUpdate",roomUpdate:RoomUpdate.decode(t,t.uint32())};break;case 12:a.message={$case:"connectionQuality",connectionQuality:ConnectionQualityUpdate.decode(t,t.uint32())};break;case 13:a.message={$case:"streamStateUpdate",streamStateUpdate:StreamStateUpdate.decode(t,t.uint32())};break;case 14:a.message={$case:"subscribedQualityUpdate",subscribedQualityUpdate:SubscribedQualityUpdate.decode(t,t.uint32())};break;case 15:a.message={$case:"subscriptionPermissionUpdate",subscriptionPermissionUpdate:SubscriptionPermissionUpdate.decode(t,t.uint32())};break;case 16:a.message={$case:"refreshToken",refreshToken:t.string()};break;case 17:a.message={$case:"trackUnpublished",trackUnpublished:TrackUnpublishedResponse.decode(t,t.uint32())};break;case 18:a.message={$case:"pong",pong:longToNumber(t.int64())};break;case 19:a.message={$case:"reconnect",reconnect:ReconnectResponse.decode(t,t.uint32())};break;case 20:a.message={$case:"pongResp",pongResp:Pong.decode(t,t.uint32())};break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{message:isSet(e.join)?{$case:"join",join:JoinResponse.fromJSON(e.join)}:isSet(e.answer)?{$case:"answer",answer:SessionDescription.fromJSON(e.answer)}:isSet(e.offer)?{$case:"offer",offer:SessionDescription.fromJSON(e.offer)}:isSet(e.trickle)?{$case:"trickle",trickle:TrickleRequest.fromJSON(e.trickle)}:isSet(e.update)?{$case:"update",update:ParticipantUpdate.fromJSON(e.update)}:isSet(e.trackPublished)?{$case:"trackPublished",trackPublished:TrackPublishedResponse.fromJSON(e.trackPublished)}:isSet(e.leave)?{$case:"leave",leave:LeaveRequest.fromJSON(e.leave)}:isSet(e.mute)?{$case:"mute",mute:MuteTrackRequest.fromJSON(e.mute)}:isSet(e.speakersChanged)?{$case:"speakersChanged",speakersChanged:SpeakersChanged.fromJSON(e.speakersChanged)}:isSet(e.roomUpdate)?{$case:"roomUpdate",roomUpdate:RoomUpdate.fromJSON(e.roomUpdate)}:isSet(e.connectionQuality)?{$case:"connectionQuality",connectionQuality:ConnectionQualityUpdate.fromJSON(e.connectionQuality)}:isSet(e.streamStateUpdate)?{$case:"streamStateUpdate",streamStateUpdate:StreamStateUpdate.fromJSON(e.streamStateUpdate)}:isSet(e.subscribedQualityUpdate)?{$case:"subscribedQualityUpdate",subscribedQualityUpdate:SubscribedQualityUpdate.fromJSON(e.subscribedQualityUpdate)}:isSet(e.subscriptionPermissionUpdate)?{$case:"subscriptionPermissionUpdate",subscriptionPermissionUpdate:SubscriptionPermissionUpdate.fromJSON(e.subscriptionPermissionUpdate)}:isSet(e.refreshToken)?{$case:"refreshToken",refreshToken:String(e.refreshToken)}:isSet(e.trackUnpublished)?{$case:"trackUnpublished",trackUnpublished:TrackUnpublishedResponse.fromJSON(e.trackUnpublished)}:isSet(e.pong)?{$case:"pong",pong:Number(e.pong)}:isSet(e.reconnect)?{$case:"reconnect",reconnect:ReconnectResponse.fromJSON(e.reconnect)}:isSet(e.pongResp)?{$case:"pongResp",pongResp:Pong.fromJSON(e.pongResp)}:void 0}},toJSON(e){var t,n,a,s,o,c,d,u,l,f,p,m,g,S,v,T,k,b,y,N,D,B,A,C,I,U,F,M,V,te,J,q,Y,Q,H,X,W,z,Z,j,K,ee,ie,G,ne,ae,pe,ce,se,de,he,ue,le,x,re;const i={};return((t=e.message)==null?void 0:t.$case)==="join"&&(i.join=(n=e.message)!=null&&n.join?JoinResponse.toJSON((a=e.message)==null?void 0:a.join):void 0),((s=e.message)==null?void 0:s.$case)==="answer"&&(i.answer=(o=e.message)!=null&&o.answer?SessionDescription.toJSON((c=e.message)==null?void 0:c.answer):void 0),((d=e.message)==null?void 0:d.$case)==="offer"&&(i.offer=(u=e.message)!=null&&u.offer?SessionDescription.toJSON((l=e.message)==null?void 0:l.offer):void 0),((f=e.message)==null?void 0:f.$case)==="trickle"&&(i.trickle=(p=e.message)!=null&&p.trickle?TrickleRequest.toJSON((m=e.message)==null?void 0:m.trickle):void 0),((g=e.message)==null?void 0:g.$case)==="update"&&(i.update=(S=e.message)!=null&&S.update?ParticipantUpdate.toJSON((v=e.message)==null?void 0:v.update):void 0),((T=e.message)==null?void 0:T.$case)==="trackPublished"&&(i.trackPublished=(k=e.message)!=null&&k.trackPublished?TrackPublishedResponse.toJSON((b=e.message)==null?void 0:b.trackPublished):void 0),((y=e.message)==null?void 0:y.$case)==="leave"&&(i.leave=(N=e.message)!=null&&N.leave?LeaveRequest.toJSON((D=e.message)==null?void 0:D.leave):void 0),((B=e.message)==null?void 0:B.$case)==="mute"&&(i.mute=(A=e.message)!=null&&A.mute?MuteTrackRequest.toJSON((C=e.message)==null?void 0:C.mute):void 0),((I=e.message)==null?void 0:I.$case)==="speakersChanged"&&(i.speakersChanged=(U=e.message)!=null&&U.speakersChanged?SpeakersChanged.toJSON((F=e.message)==null?void 0:F.speakersChanged):void 0),((M=e.message)==null?void 0:M.$case)==="roomUpdate"&&(i.roomUpdate=(V=e.message)!=null&&V.roomUpdate?RoomUpdate.toJSON((te=e.message)==null?void 0:te.roomUpdate):void 0),((J=e.message)==null?void 0:J.$case)==="connectionQuality"&&(i.connectionQuality=(q=e.message)!=null&&q.connectionQuality?ConnectionQualityUpdate.toJSON((Y=e.message)==null?void 0:Y.connectionQuality):void 0),((Q=e.message)==null?void 0:Q.$case)==="streamStateUpdate"&&(i.streamStateUpdate=(H=e.message)!=null&&H.streamStateUpdate?StreamStateUpdate.toJSON((X=e.message)==null?void 0:X.streamStateUpdate):void 0),((W=e.message)==null?void 0:W.$case)==="subscribedQualityUpdate"&&(i.subscribedQualityUpdate=(z=e.message)!=null&&z.subscribedQualityUpdate?SubscribedQualityUpdate.toJSON((Z=e.message)==null?void 0:Z.subscribedQualityUpdate):void 0),((j=e.message)==null?void 0:j.$case)==="subscriptionPermissionUpdate"&&(i.subscriptionPermissionUpdate=(K=e.message)!=null&&K.subscriptionPermissionUpdate?SubscriptionPermissionUpdate.toJSON((ee=e.message)==null?void 0:ee.subscriptionPermissionUpdate):void 0),((ie=e.message)==null?void 0:ie.$case)==="refreshToken"&&(i.refreshToken=(G=e.message)==null?void 0:G.refreshToken),((ne=e.message)==null?void 0:ne.$case)==="trackUnpublished"&&(i.trackUnpublished=(ae=e.message)!=null&&ae.trackUnpublished?TrackUnpublishedResponse.toJSON((pe=e.message)==null?void 0:pe.trackUnpublished):void 0),((ce=e.message)==null?void 0:ce.$case)==="pong"&&(i.pong=Math.round((se=e.message)==null?void 0:se.pong)),((de=e.message)==null?void 0:de.$case)==="reconnect"&&(i.reconnect=(he=e.message)!=null&&he.reconnect?ReconnectResponse.toJSON((ue=e.message)==null?void 0:ue.reconnect):void 0),((le=e.message)==null?void 0:le.$case)==="pongResp"&&(i.pongResp=(x=e.message)!=null&&x.pongResp?Pong.toJSON((re=e.message)==null?void 0:re.pongResp):void 0),i},fromPartial(e){var t,n,a,s,o,c,d,u,l,f,p,m,g,S,v,T,k,b,y,N,D,B,A,C,I,U,F,M,V,te,J,q,Y,Q,H,X,W,z,Z,j,K,ee,ie,G,ne,ae,pe,ce,se,de,he,ue,le,x,re,fe,P;const i=createBaseSignalResponse();return((t=e.message)==null?void 0:t.$case)==="join"&&((n=e.message)==null?void 0:n.join)!==void 0&&((a=e.message)==null?void 0:a.join)!==null&&(i.message={$case:"join",join:JoinResponse.fromPartial(e.message.join)}),((s=e.message)==null?void 0:s.$case)==="answer"&&((o=e.message)==null?void 0:o.answer)!==void 0&&((c=e.message)==null?void 0:c.answer)!==null&&(i.message={$case:"answer",answer:SessionDescription.fromPartial(e.message.answer)}),((d=e.message)==null?void 0:d.$case)==="offer"&&((u=e.message)==null?void 0:u.offer)!==void 0&&((l=e.message)==null?void 0:l.offer)!==null&&(i.message={$case:"offer",offer:SessionDescription.fromPartial(e.message.offer)}),((f=e.message)==null?void 0:f.$case)==="trickle"&&((p=e.message)==null?void 0:p.trickle)!==void 0&&((m=e.message)==null?void 0:m.trickle)!==null&&(i.message={$case:"trickle",trickle:TrickleRequest.fromPartial(e.message.trickle)}),((g=e.message)==null?void 0:g.$case)==="update"&&((S=e.message)==null?void 0:S.update)!==void 0&&((v=e.message)==null?void 0:v.update)!==null&&(i.message={$case:"update",update:ParticipantUpdate.fromPartial(e.message.update)}),((T=e.message)==null?void 0:T.$case)==="trackPublished"&&((k=e.message)==null?void 0:k.trackPublished)!==void 0&&((b=e.message)==null?void 0:b.trackPublished)!==null&&(i.message={$case:"trackPublished",trackPublished:TrackPublishedResponse.fromPartial(e.message.trackPublished)}),((y=e.message)==null?void 0:y.$case)==="leave"&&((N=e.message)==null?void 0:N.leave)!==void 0&&((D=e.message)==null?void 0:D.leave)!==null&&(i.message={$case:"leave",leave:LeaveRequest.fromPartial(e.message.leave)}),((B=e.message)==null?void 0:B.$case)==="mute"&&((A=e.message)==null?void 0:A.mute)!==void 0&&((C=e.message)==null?void 0:C.mute)!==null&&(i.message={$case:"mute",mute:MuteTrackRequest.fromPartial(e.message.mute)}),((I=e.message)==null?void 0:I.$case)==="speakersChanged"&&((U=e.message)==null?void 0:U.speakersChanged)!==void 0&&((F=e.message)==null?void 0:F.speakersChanged)!==null&&(i.message={$case:"speakersChanged",speakersChanged:SpeakersChanged.fromPartial(e.message.speakersChanged)}),((M=e.message)==null?void 0:M.$case)==="roomUpdate"&&((V=e.message)==null?void 0:V.roomUpdate)!==void 0&&((te=e.message)==null?void 0:te.roomUpdate)!==null&&(i.message={$case:"roomUpdate",roomUpdate:RoomUpdate.fromPartial(e.message.roomUpdate)}),((J=e.message)==null?void 0:J.$case)==="connectionQuality"&&((q=e.message)==null?void 0:q.connectionQuality)!==void 0&&((Y=e.message)==null?void 0:Y.connectionQuality)!==null&&(i.message={$case:"connectionQuality",connectionQuality:ConnectionQualityUpdate.fromPartial(e.message.connectionQuality)}),((Q=e.message)==null?void 0:Q.$case)==="streamStateUpdate"&&((H=e.message)==null?void 0:H.streamStateUpdate)!==void 0&&((X=e.message)==null?void 0:X.streamStateUpdate)!==null&&(i.message={$case:"streamStateUpdate",streamStateUpdate:StreamStateUpdate.fromPartial(e.message.streamStateUpdate)}),((W=e.message)==null?void 0:W.$case)==="subscribedQualityUpdate"&&((z=e.message)==null?void 0:z.subscribedQualityUpdate)!==void 0&&((Z=e.message)==null?void 0:Z.subscribedQualityUpdate)!==null&&(i.message={$case:"subscribedQualityUpdate",subscribedQualityUpdate:SubscribedQualityUpdate.fromPartial(e.message.subscribedQualityUpdate)}),((j=e.message)==null?void 0:j.$case)==="subscriptionPermissionUpdate"&&((K=e.message)==null?void 0:K.subscriptionPermissionUpdate)!==void 0&&((ee=e.message)==null?void 0:ee.subscriptionPermissionUpdate)!==null&&(i.message={$case:"subscriptionPermissionUpdate",subscriptionPermissionUpdate:SubscriptionPermissionUpdate.fromPartial(e.message.subscriptionPermissionUpdate)}),((ie=e.message)==null?void 0:ie.$case)==="refreshToken"&&((G=e.message)==null?void 0:G.refreshToken)!==void 0&&((ne=e.message)==null?void 0:ne.refreshToken)!==null&&(i.message={$case:"refreshToken",refreshToken:e.message.refreshToken}),((ae=e.message)==null?void 0:ae.$case)==="trackUnpublished"&&((pe=e.message)==null?void 0:pe.trackUnpublished)!==void 0&&((ce=e.message)==null?void 0:ce.trackUnpublished)!==null&&(i.message={$case:"trackUnpublished",trackUnpublished:TrackUnpublishedResponse.fromPartial(e.message.trackUnpublished)}),((se=e.message)==null?void 0:se.$case)==="pong"&&((de=e.message)==null?void 0:de.pong)!==void 0&&((he=e.message)==null?void 0:he.pong)!==null&&(i.message={$case:"pong",pong:e.message.pong}),((ue=e.message)==null?void 0:ue.$case)==="reconnect"&&((le=e.message)==null?void 0:le.reconnect)!==void 0&&((x=e.message)==null?void 0:x.reconnect)!==null&&(i.message={$case:"reconnect",reconnect:ReconnectResponse.fromPartial(e.message.reconnect)}),((re=e.message)==null?void 0:re.$case)==="pongResp"&&((fe=e.message)==null?void 0:fe.pongResp)!==void 0&&((P=e.message)==null?void 0:P.pongResp)!==null&&(i.message={$case:"pongResp",pongResp:Pong.fromPartial(e.message.pongResp)}),i}};function createBaseSimulcastCodec(){return{codec:"",cid:"",enableSimulcastLayers:!1}}const SimulcastCodec={encode(e,i=_m0.Writer.create()){return e.codec!==""&&i.uint32(10).string(e.codec),e.cid!==""&&i.uint32(18).string(e.cid),e.enableSimulcastLayers===!0&&i.uint32(24).bool(e.enableSimulcastLayers),i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseSimulcastCodec();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.codec=t.string();break;case 2:a.cid=t.string();break;case 3:a.enableSimulcastLayers=t.bool();break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{codec:isSet(e.codec)?String(e.codec):"",cid:isSet(e.cid)?String(e.cid):"",enableSimulcastLayers:isSet(e.enableSimulcastLayers)?Boolean(e.enableSimulcastLayers):!1}},toJSON(e){const i={};return e.codec!==void 0&&(i.codec=e.codec),e.cid!==void 0&&(i.cid=e.cid),e.enableSimulcastLayers!==void 0&&(i.enableSimulcastLayers=e.enableSimulcastLayers),i},fromPartial(e){var t,n,a;const i=createBaseSimulcastCodec();return i.codec=(t=e.codec)!=null?t:"",i.cid=(n=e.cid)!=null?n:"",i.enableSimulcastLayers=(a=e.enableSimulcastLayers)!=null?a:!1,i}};function createBaseAddTrackRequest(){return{cid:"",name:"",type:0,width:0,height:0,muted:!1,disableDtx:!1,source:0,layers:[],simulcastCodecs:[],sid:"",stereo:!1,disableRed:!1,encryption:0}}const AddTrackRequest={encode(e,i=_m0.Writer.create()){e.cid!==""&&i.uint32(10).string(e.cid),e.name!==""&&i.uint32(18).string(e.name),e.type!==0&&i.uint32(24).int32(e.type),e.width!==0&&i.uint32(32).uint32(e.width),e.height!==0&&i.uint32(40).uint32(e.height),e.muted===!0&&i.uint32(48).bool(e.muted),e.disableDtx===!0&&i.uint32(56).bool(e.disableDtx),e.source!==0&&i.uint32(64).int32(e.source);for(const t of e.layers)VideoLayer.encode(t,i.uint32(74).fork()).ldelim();for(const t of e.simulcastCodecs)SimulcastCodec.encode(t,i.uint32(82).fork()).ldelim();return e.sid!==""&&i.uint32(90).string(e.sid),e.stereo===!0&&i.uint32(96).bool(e.stereo),e.disableRed===!0&&i.uint32(104).bool(e.disableRed),e.encryption!==0&&i.uint32(112).int32(e.encryption),i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseAddTrackRequest();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.cid=t.string();break;case 2:a.name=t.string();break;case 3:a.type=t.int32();break;case 4:a.width=t.uint32();break;case 5:a.height=t.uint32();break;case 6:a.muted=t.bool();break;case 7:a.disableDtx=t.bool();break;case 8:a.source=t.int32();break;case 9:a.layers.push(VideoLayer.decode(t,t.uint32()));break;case 10:a.simulcastCodecs.push(SimulcastCodec.decode(t,t.uint32()));break;case 11:a.sid=t.string();break;case 12:a.stereo=t.bool();break;case 13:a.disableRed=t.bool();break;case 14:a.encryption=t.int32();break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{cid:isSet(e.cid)?String(e.cid):"",name:isSet(e.name)?String(e.name):"",type:isSet(e.type)?trackTypeFromJSON(e.type):0,width:isSet(e.width)?Number(e.width):0,height:isSet(e.height)?Number(e.height):0,muted:isSet(e.muted)?Boolean(e.muted):!1,disableDtx:isSet(e.disableDtx)?Boolean(e.disableDtx):!1,source:isSet(e.source)?trackSourceFromJSON(e.source):0,layers:Array.isArray(e==null?void 0:e.layers)?e.layers.map(i=>VideoLayer.fromJSON(i)):[],simulcastCodecs:Array.isArray(e==null?void 0:e.simulcastCodecs)?e.simulcastCodecs.map(i=>SimulcastCodec.fromJSON(i)):[],sid:isSet(e.sid)?String(e.sid):"",stereo:isSet(e.stereo)?Boolean(e.stereo):!1,disableRed:isSet(e.disableRed)?Boolean(e.disableRed):!1,encryption:isSet(e.encryption)?encryption_TypeFromJSON(e.encryption):0}},toJSON(e){const i={};return e.cid!==void 0&&(i.cid=e.cid),e.name!==void 0&&(i.name=e.name),e.type!==void 0&&(i.type=trackTypeToJSON(e.type)),e.width!==void 0&&(i.width=Math.round(e.width)),e.height!==void 0&&(i.height=Math.round(e.height)),e.muted!==void 0&&(i.muted=e.muted),e.disableDtx!==void 0&&(i.disableDtx=e.disableDtx),e.source!==void 0&&(i.source=trackSourceToJSON(e.source)),e.layers?i.layers=e.layers.map(t=>t?VideoLayer.toJSON(t):void 0):i.layers=[],e.simulcastCodecs?i.simulcastCodecs=e.simulcastCodecs.map(t=>t?SimulcastCodec.toJSON(t):void 0):i.simulcastCodecs=[],e.sid!==void 0&&(i.sid=e.sid),e.stereo!==void 0&&(i.stereo=e.stereo),e.disableRed!==void 0&&(i.disableRed=e.disableRed),e.encryption!==void 0&&(i.encryption=encryption_TypeToJSON(e.encryption)),i},fromPartial(e){var t,n,a,s,o,c,d,u,l,f,p,m,g,S;const i=createBaseAddTrackRequest();return i.cid=(t=e.cid)!=null?t:"",i.name=(n=e.name)!=null?n:"",i.type=(a=e.type)!=null?a:0,i.width=(s=e.width)!=null?s:0,i.height=(o=e.height)!=null?o:0,i.muted=(c=e.muted)!=null?c:!1,i.disableDtx=(d=e.disableDtx)!=null?d:!1,i.source=(u=e.source)!=null?u:0,i.layers=((l=e.layers)==null?void 0:l.map(v=>VideoLayer.fromPartial(v)))||[],i.simulcastCodecs=((f=e.simulcastCodecs)==null?void 0:f.map(v=>SimulcastCodec.fromPartial(v)))||[],i.sid=(p=e.sid)!=null?p:"",i.stereo=(m=e.stereo)!=null?m:!1,i.disableRed=(g=e.disableRed)!=null?g:!1,i.encryption=(S=e.encryption)!=null?S:0,i}};function createBaseTrickleRequest(){return{candidateInit:"",target:0}}const TrickleRequest={encode(e,i=_m0.Writer.create()){return e.candidateInit!==""&&i.uint32(10).string(e.candidateInit),e.target!==0&&i.uint32(16).int32(e.target),i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseTrickleRequest();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.candidateInit=t.string();break;case 2:a.target=t.int32();break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{candidateInit:isSet(e.candidateInit)?String(e.candidateInit):"",target:isSet(e.target)?signalTargetFromJSON(e.target):0}},toJSON(e){const i={};return e.candidateInit!==void 0&&(i.candidateInit=e.candidateInit),e.target!==void 0&&(i.target=signalTargetToJSON(e.target)),i},fromPartial(e){var t,n;const i=createBaseTrickleRequest();return i.candidateInit=(t=e.candidateInit)!=null?t:"",i.target=(n=e.target)!=null?n:0,i}};function createBaseMuteTrackRequest(){return{sid:"",muted:!1}}const MuteTrackRequest={encode(e,i=_m0.Writer.create()){return e.sid!==""&&i.uint32(10).string(e.sid),e.muted===!0&&i.uint32(16).bool(e.muted),i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseMuteTrackRequest();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.sid=t.string();break;case 2:a.muted=t.bool();break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{sid:isSet(e.sid)?String(e.sid):"",muted:isSet(e.muted)?Boolean(e.muted):!1}},toJSON(e){const i={};return e.sid!==void 0&&(i.sid=e.sid),e.muted!==void 0&&(i.muted=e.muted),i},fromPartial(e){var t,n;const i=createBaseMuteTrackRequest();return i.sid=(t=e.sid)!=null?t:"",i.muted=(n=e.muted)!=null?n:!1,i}};function createBaseJoinResponse(){return{room:void 0,participant:void 0,otherParticipants:[],serverVersion:"",iceServers:[],subscriberPrimary:!1,alternativeUrl:"",clientConfiguration:void 0,serverRegion:"",pingTimeout:0,pingInterval:0,serverInfo:void 0}}const JoinResponse={encode(e,i=_m0.Writer.create()){e.room!==void 0&&Room$1.encode(e.room,i.uint32(10).fork()).ldelim(),e.participant!==void 0&&ParticipantInfo.encode(e.participant,i.uint32(18).fork()).ldelim();for(const t of e.otherParticipants)ParticipantInfo.encode(t,i.uint32(26).fork()).ldelim();e.serverVersion!==""&&i.uint32(34).string(e.serverVersion);for(const t of e.iceServers)ICEServer.encode(t,i.uint32(42).fork()).ldelim();return e.subscriberPrimary===!0&&i.uint32(48).bool(e.subscriberPrimary),e.alternativeUrl!==""&&i.uint32(58).string(e.alternativeUrl),e.clientConfiguration!==void 0&&ClientConfiguration.encode(e.clientConfiguration,i.uint32(66).fork()).ldelim(),e.serverRegion!==""&&i.uint32(74).string(e.serverRegion),e.pingTimeout!==0&&i.uint32(80).int32(e.pingTimeout),e.pingInterval!==0&&i.uint32(88).int32(e.pingInterval),e.serverInfo!==void 0&&ServerInfo.encode(e.serverInfo,i.uint32(98).fork()).ldelim(),i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseJoinResponse();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.room=Room$1.decode(t,t.uint32());break;case 2:a.participant=ParticipantInfo.decode(t,t.uint32());break;case 3:a.otherParticipants.push(ParticipantInfo.decode(t,t.uint32()));break;case 4:a.serverVersion=t.string();break;case 5:a.iceServers.push(ICEServer.decode(t,t.uint32()));break;case 6:a.subscriberPrimary=t.bool();break;case 7:a.alternativeUrl=t.string();break;case 8:a.clientConfiguration=ClientConfiguration.decode(t,t.uint32());break;case 9:a.serverRegion=t.string();break;case 10:a.pingTimeout=t.int32();break;case 11:a.pingInterval=t.int32();break;case 12:a.serverInfo=ServerInfo.decode(t,t.uint32());break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{room:isSet(e.room)?Room$1.fromJSON(e.room):void 0,participant:isSet(e.participant)?ParticipantInfo.fromJSON(e.participant):void 0,otherParticipants:Array.isArray(e==null?void 0:e.otherParticipants)?e.otherParticipants.map(i=>ParticipantInfo.fromJSON(i)):[],serverVersion:isSet(e.serverVersion)?String(e.serverVersion):"",iceServers:Array.isArray(e==null?void 0:e.iceServers)?e.iceServers.map(i=>ICEServer.fromJSON(i)):[],subscriberPrimary:isSet(e.subscriberPrimary)?Boolean(e.subscriberPrimary):!1,alternativeUrl:isSet(e.alternativeUrl)?String(e.alternativeUrl):"",clientConfiguration:isSet(e.clientConfiguration)?ClientConfiguration.fromJSON(e.clientConfiguration):void 0,serverRegion:isSet(e.serverRegion)?String(e.serverRegion):"",pingTimeout:isSet(e.pingTimeout)?Number(e.pingTimeout):0,pingInterval:isSet(e.pingInterval)?Number(e.pingInterval):0,serverInfo:isSet(e.serverInfo)?ServerInfo.fromJSON(e.serverInfo):void 0}},toJSON(e){const i={};return e.room!==void 0&&(i.room=e.room?Room$1.toJSON(e.room):void 0),e.participant!==void 0&&(i.participant=e.participant?ParticipantInfo.toJSON(e.participant):void 0),e.otherParticipants?i.otherParticipants=e.otherParticipants.map(t=>t?ParticipantInfo.toJSON(t):void 0):i.otherParticipants=[],e.serverVersion!==void 0&&(i.serverVersion=e.serverVersion),e.iceServers?i.iceServers=e.iceServers.map(t=>t?ICEServer.toJSON(t):void 0):i.iceServers=[],e.subscriberPrimary!==void 0&&(i.subscriberPrimary=e.subscriberPrimary),e.alternativeUrl!==void 0&&(i.alternativeUrl=e.alternativeUrl),e.clientConfiguration!==void 0&&(i.clientConfiguration=e.clientConfiguration?ClientConfiguration.toJSON(e.clientConfiguration):void 0),e.serverRegion!==void 0&&(i.serverRegion=e.serverRegion),e.pingTimeout!==void 0&&(i.pingTimeout=Math.round(e.pingTimeout)),e.pingInterval!==void 0&&(i.pingInterval=Math.round(e.pingInterval)),e.serverInfo!==void 0&&(i.serverInfo=e.serverInfo?ServerInfo.toJSON(e.serverInfo):void 0),i},fromPartial(e){var t,n,a,s,o,c,d,u;const i=createBaseJoinResponse();return i.room=e.room!==void 0&&e.room!==null?Room$1.fromPartial(e.room):void 0,i.participant=e.participant!==void 0&&e.participant!==null?ParticipantInfo.fromPartial(e.participant):void 0,i.otherParticipants=((t=e.otherParticipants)==null?void 0:t.map(l=>ParticipantInfo.fromPartial(l)))||[],i.serverVersion=(n=e.serverVersion)!=null?n:"",i.iceServers=((a=e.iceServers)==null?void 0:a.map(l=>ICEServer.fromPartial(l)))||[],i.subscriberPrimary=(s=e.subscriberPrimary)!=null?s:!1,i.alternativeUrl=(o=e.alternativeUrl)!=null?o:"",i.clientConfiguration=e.clientConfiguration!==void 0&&e.clientConfiguration!==null?ClientConfiguration.fromPartial(e.clientConfiguration):void 0,i.serverRegion=(c=e.serverRegion)!=null?c:"",i.pingTimeout=(d=e.pingTimeout)!=null?d:0,i.pingInterval=(u=e.pingInterval)!=null?u:0,i.serverInfo=e.serverInfo!==void 0&&e.serverInfo!==null?ServerInfo.fromPartial(e.serverInfo):void 0,i}};function createBaseReconnectResponse(){return{iceServers:[],clientConfiguration:void 0,room:void 0,participant:void 0,otherParticipants:[]}}const ReconnectResponse={encode(e,i=_m0.Writer.create()){for(const t of e.iceServers)ICEServer.encode(t,i.uint32(10).fork()).ldelim();e.clientConfiguration!==void 0&&ClientConfiguration.encode(e.clientConfiguration,i.uint32(18).fork()).ldelim(),e.room!==void 0&&Room$1.encode(e.room,i.uint32(26).fork()).ldelim(),e.participant!==void 0&&ParticipantInfo.encode(e.participant,i.uint32(34).fork()).ldelim();for(const t of e.otherParticipants)ParticipantInfo.encode(t,i.uint32(42).fork()).ldelim();return i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseReconnectResponse();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.iceServers.push(ICEServer.decode(t,t.uint32()));break;case 2:a.clientConfiguration=ClientConfiguration.decode(t,t.uint32());break;case 3:a.room=Room$1.decode(t,t.uint32());break;case 4:a.participant=ParticipantInfo.decode(t,t.uint32());break;case 5:a.otherParticipants.push(ParticipantInfo.decode(t,t.uint32()));break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{iceServers:Array.isArray(e==null?void 0:e.iceServers)?e.iceServers.map(i=>ICEServer.fromJSON(i)):[],clientConfiguration:isSet(e.clientConfiguration)?ClientConfiguration.fromJSON(e.clientConfiguration):void 0,room:isSet(e.room)?Room$1.fromJSON(e.room):void 0,participant:isSet(e.participant)?ParticipantInfo.fromJSON(e.participant):void 0,otherParticipants:Array.isArray(e==null?void 0:e.otherParticipants)?e.otherParticipants.map(i=>ParticipantInfo.fromJSON(i)):[]}},toJSON(e){const i={};return e.iceServers?i.iceServers=e.iceServers.map(t=>t?ICEServer.toJSON(t):void 0):i.iceServers=[],e.clientConfiguration!==void 0&&(i.clientConfiguration=e.clientConfiguration?ClientConfiguration.toJSON(e.clientConfiguration):void 0),e.room!==void 0&&(i.room=e.room?Room$1.toJSON(e.room):void 0),e.participant!==void 0&&(i.participant=e.participant?ParticipantInfo.toJSON(e.participant):void 0),e.otherParticipants?i.otherParticipants=e.otherParticipants.map(t=>t?ParticipantInfo.toJSON(t):void 0):i.otherParticipants=[],i},fromPartial(e){var t,n;const i=createBaseReconnectResponse();return i.iceServers=((t=e.iceServers)==null?void 0:t.map(a=>ICEServer.fromPartial(a)))||[],i.clientConfiguration=e.clientConfiguration!==void 0&&e.clientConfiguration!==null?ClientConfiguration.fromPartial(e.clientConfiguration):void 0,i.room=e.room!==void 0&&e.room!==null?Room$1.fromPartial(e.room):void 0,i.participant=e.participant!==void 0&&e.participant!==null?ParticipantInfo.fromPartial(e.participant):void 0,i.otherParticipants=((n=e.otherParticipants)==null?void 0:n.map(a=>ParticipantInfo.fromPartial(a)))||[],i}};function createBaseTrackPublishedResponse(){return{cid:"",track:void 0}}const TrackPublishedResponse={encode(e,i=_m0.Writer.create()){return e.cid!==""&&i.uint32(10).string(e.cid),e.track!==void 0&&TrackInfo.encode(e.track,i.uint32(18).fork()).ldelim(),i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseTrackPublishedResponse();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.cid=t.string();break;case 2:a.track=TrackInfo.decode(t,t.uint32());break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{cid:isSet(e.cid)?String(e.cid):"",track:isSet(e.track)?TrackInfo.fromJSON(e.track):void 0}},toJSON(e){const i={};return e.cid!==void 0&&(i.cid=e.cid),e.track!==void 0&&(i.track=e.track?TrackInfo.toJSON(e.track):void 0),i},fromPartial(e){var t;const i=createBaseTrackPublishedResponse();return i.cid=(t=e.cid)!=null?t:"",i.track=e.track!==void 0&&e.track!==null?TrackInfo.fromPartial(e.track):void 0,i}};function createBaseTrackUnpublishedResponse(){return{trackSid:""}}const TrackUnpublishedResponse={encode(e,i=_m0.Writer.create()){return e.trackSid!==""&&i.uint32(10).string(e.trackSid),i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseTrackUnpublishedResponse();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.trackSid=t.string();break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{trackSid:isSet(e.trackSid)?String(e.trackSid):""}},toJSON(e){const i={};return e.trackSid!==void 0&&(i.trackSid=e.trackSid),i},fromPartial(e){var t;const i=createBaseTrackUnpublishedResponse();return i.trackSid=(t=e.trackSid)!=null?t:"",i}};function createBaseSessionDescription(){return{type:"",sdp:""}}const SessionDescription={encode(e,i=_m0.Writer.create()){return e.type!==""&&i.uint32(10).string(e.type),e.sdp!==""&&i.uint32(18).string(e.sdp),i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseSessionDescription();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.type=t.string();break;case 2:a.sdp=t.string();break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{type:isSet(e.type)?String(e.type):"",sdp:isSet(e.sdp)?String(e.sdp):""}},toJSON(e){const i={};return e.type!==void 0&&(i.type=e.type),e.sdp!==void 0&&(i.sdp=e.sdp),i},fromPartial(e){var t,n;const i=createBaseSessionDescription();return i.type=(t=e.type)!=null?t:"",i.sdp=(n=e.sdp)!=null?n:"",i}};function createBaseParticipantUpdate(){return{participants:[]}}const ParticipantUpdate={encode(e,i=_m0.Writer.create()){for(const t of e.participants)ParticipantInfo.encode(t,i.uint32(10).fork()).ldelim();return i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseParticipantUpdate();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.participants.push(ParticipantInfo.decode(t,t.uint32()));break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{participants:Array.isArray(e==null?void 0:e.participants)?e.participants.map(i=>ParticipantInfo.fromJSON(i)):[]}},toJSON(e){const i={};return e.participants?i.participants=e.participants.map(t=>t?ParticipantInfo.toJSON(t):void 0):i.participants=[],i},fromPartial(e){var t;const i=createBaseParticipantUpdate();return i.participants=((t=e.participants)==null?void 0:t.map(n=>ParticipantInfo.fromPartial(n)))||[],i}};function createBaseUpdateSubscription(){return{trackSids:[],subscribe:!1,participantTracks:[]}}const UpdateSubscription={encode(e,i=_m0.Writer.create()){for(const t of e.trackSids)i.uint32(10).string(t);e.subscribe===!0&&i.uint32(16).bool(e.subscribe);for(const t of e.participantTracks)ParticipantTracks.encode(t,i.uint32(26).fork()).ldelim();return i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseUpdateSubscription();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.trackSids.push(t.string());break;case 2:a.subscribe=t.bool();break;case 3:a.participantTracks.push(ParticipantTracks.decode(t,t.uint32()));break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{trackSids:Array.isArray(e==null?void 0:e.trackSids)?e.trackSids.map(i=>String(i)):[],subscribe:isSet(e.subscribe)?Boolean(e.subscribe):!1,participantTracks:Array.isArray(e==null?void 0:e.participantTracks)?e.participantTracks.map(i=>ParticipantTracks.fromJSON(i)):[]}},toJSON(e){const i={};return e.trackSids?i.trackSids=e.trackSids.map(t=>t):i.trackSids=[],e.subscribe!==void 0&&(i.subscribe=e.subscribe),e.participantTracks?i.participantTracks=e.participantTracks.map(t=>t?ParticipantTracks.toJSON(t):void 0):i.participantTracks=[],i},fromPartial(e){var t,n,a;const i=createBaseUpdateSubscription();return i.trackSids=((t=e.trackSids)==null?void 0:t.map(s=>s))||[],i.subscribe=(n=e.subscribe)!=null?n:!1,i.participantTracks=((a=e.participantTracks)==null?void 0:a.map(s=>ParticipantTracks.fromPartial(s)))||[],i}};function createBaseUpdateTrackSettings(){return{trackSids:[],disabled:!1,quality:0,width:0,height:0,fps:0,priority:0}}const UpdateTrackSettings={encode(e,i=_m0.Writer.create()){for(const t of e.trackSids)i.uint32(10).string(t);return e.disabled===!0&&i.uint32(24).bool(e.disabled),e.quality!==0&&i.uint32(32).int32(e.quality),e.width!==0&&i.uint32(40).uint32(e.width),e.height!==0&&i.uint32(48).uint32(e.height),e.fps!==0&&i.uint32(56).uint32(e.fps),e.priority!==0&&i.uint32(64).uint32(e.priority),i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseUpdateTrackSettings();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.trackSids.push(t.string());break;case 3:a.disabled=t.bool();break;case 4:a.quality=t.int32();break;case 5:a.width=t.uint32();break;case 6:a.height=t.uint32();break;case 7:a.fps=t.uint32();break;case 8:a.priority=t.uint32();break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{trackSids:Array.isArray(e==null?void 0:e.trackSids)?e.trackSids.map(i=>String(i)):[],disabled:isSet(e.disabled)?Boolean(e.disabled):!1,quality:isSet(e.quality)?videoQualityFromJSON(e.quality):0,width:isSet(e.width)?Number(e.width):0,height:isSet(e.height)?Number(e.height):0,fps:isSet(e.fps)?Number(e.fps):0,priority:isSet(e.priority)?Number(e.priority):0}},toJSON(e){const i={};return e.trackSids?i.trackSids=e.trackSids.map(t=>t):i.trackSids=[],e.disabled!==void 0&&(i.disabled=e.disabled),e.quality!==void 0&&(i.quality=videoQualityToJSON(e.quality)),e.width!==void 0&&(i.width=Math.round(e.width)),e.height!==void 0&&(i.height=Math.round(e.height)),e.fps!==void 0&&(i.fps=Math.round(e.fps)),e.priority!==void 0&&(i.priority=Math.round(e.priority)),i},fromPartial(e){var t,n,a,s,o,c,d;const i=createBaseUpdateTrackSettings();return i.trackSids=((t=e.trackSids)==null?void 0:t.map(u=>u))||[],i.disabled=(n=e.disabled)!=null?n:!1,i.quality=(a=e.quality)!=null?a:0,i.width=(s=e.width)!=null?s:0,i.height=(o=e.height)!=null?o:0,i.fps=(c=e.fps)!=null?c:0,i.priority=(d=e.priority)!=null?d:0,i}};function createBaseLeaveRequest(){return{canReconnect:!1,reason:0}}const LeaveRequest={encode(e,i=_m0.Writer.create()){return e.canReconnect===!0&&i.uint32(8).bool(e.canReconnect),e.reason!==0&&i.uint32(16).int32(e.reason),i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseLeaveRequest();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.canReconnect=t.bool();break;case 2:a.reason=t.int32();break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{canReconnect:isSet(e.canReconnect)?Boolean(e.canReconnect):!1,reason:isSet(e.reason)?disconnectReasonFromJSON(e.reason):0}},toJSON(e){const i={};return e.canReconnect!==void 0&&(i.canReconnect=e.canReconnect),e.reason!==void 0&&(i.reason=disconnectReasonToJSON(e.reason)),i},fromPartial(e){var t,n;const i=createBaseLeaveRequest();return i.canReconnect=(t=e.canReconnect)!=null?t:!1,i.reason=(n=e.reason)!=null?n:0,i}};function createBaseUpdateVideoLayers(){return{trackSid:"",layers:[]}}const UpdateVideoLayers={encode(e,i=_m0.Writer.create()){e.trackSid!==""&&i.uint32(10).string(e.trackSid);for(const t of e.layers)VideoLayer.encode(t,i.uint32(18).fork()).ldelim();return i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseUpdateVideoLayers();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.trackSid=t.string();break;case 2:a.layers.push(VideoLayer.decode(t,t.uint32()));break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{trackSid:isSet(e.trackSid)?String(e.trackSid):"",layers:Array.isArray(e==null?void 0:e.layers)?e.layers.map(i=>VideoLayer.fromJSON(i)):[]}},toJSON(e){const i={};return e.trackSid!==void 0&&(i.trackSid=e.trackSid),e.layers?i.layers=e.layers.map(t=>t?VideoLayer.toJSON(t):void 0):i.layers=[],i},fromPartial(e){var t,n;const i=createBaseUpdateVideoLayers();return i.trackSid=(t=e.trackSid)!=null?t:"",i.layers=((n=e.layers)==null?void 0:n.map(a=>VideoLayer.fromPartial(a)))||[],i}};function createBaseUpdateParticipantMetadata(){return{metadata:""}}const UpdateParticipantMetadata={encode(e,i=_m0.Writer.create()){return e.metadata!==""&&i.uint32(10).string(e.metadata),i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseUpdateParticipantMetadata();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.metadata=t.string();break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{metadata:isSet(e.metadata)?String(e.metadata):""}},toJSON(e){const i={};return e.metadata!==void 0&&(i.metadata=e.metadata),i},fromPartial(e){var t;const i=createBaseUpdateParticipantMetadata();return i.metadata=(t=e.metadata)!=null?t:"",i}};function createBaseICEServer(){return{urls:[],username:"",credential:""}}const ICEServer={encode(e,i=_m0.Writer.create()){for(const t of e.urls)i.uint32(10).string(t);return e.username!==""&&i.uint32(18).string(e.username),e.credential!==""&&i.uint32(26).string(e.credential),i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseICEServer();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.urls.push(t.string());break;case 2:a.username=t.string();break;case 3:a.credential=t.string();break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{urls:Array.isArray(e==null?void 0:e.urls)?e.urls.map(i=>String(i)):[],username:isSet(e.username)?String(e.username):"",credential:isSet(e.credential)?String(e.credential):""}},toJSON(e){const i={};return e.urls?i.urls=e.urls.map(t=>t):i.urls=[],e.username!==void 0&&(i.username=e.username),e.credential!==void 0&&(i.credential=e.credential),i},fromPartial(e){var t,n,a;const i=createBaseICEServer();return i.urls=((t=e.urls)==null?void 0:t.map(s=>s))||[],i.username=(n=e.username)!=null?n:"",i.credential=(a=e.credential)!=null?a:"",i}};function createBaseSpeakersChanged(){return{speakers:[]}}const SpeakersChanged={encode(e,i=_m0.Writer.create()){for(const t of e.speakers)SpeakerInfo.encode(t,i.uint32(10).fork()).ldelim();return i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseSpeakersChanged();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.speakers.push(SpeakerInfo.decode(t,t.uint32()));break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{speakers:Array.isArray(e==null?void 0:e.speakers)?e.speakers.map(i=>SpeakerInfo.fromJSON(i)):[]}},toJSON(e){const i={};return e.speakers?i.speakers=e.speakers.map(t=>t?SpeakerInfo.toJSON(t):void 0):i.speakers=[],i},fromPartial(e){var t;const i=createBaseSpeakersChanged();return i.speakers=((t=e.speakers)==null?void 0:t.map(n=>SpeakerInfo.fromPartial(n)))||[],i}};function createBaseRoomUpdate(){return{room:void 0}}const RoomUpdate={encode(e,i=_m0.Writer.create()){return e.room!==void 0&&Room$1.encode(e.room,i.uint32(10).fork()).ldelim(),i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseRoomUpdate();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.room=Room$1.decode(t,t.uint32());break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{room:isSet(e.room)?Room$1.fromJSON(e.room):void 0}},toJSON(e){const i={};return e.room!==void 0&&(i.room=e.room?Room$1.toJSON(e.room):void 0),i},fromPartial(e){const i=createBaseRoomUpdate();return i.room=e.room!==void 0&&e.room!==null?Room$1.fromPartial(e.room):void 0,i}};function createBaseConnectionQualityInfo(){return{participantSid:"",quality:0,score:0}}const ConnectionQualityInfo={encode(e,i=_m0.Writer.create()){return e.participantSid!==""&&i.uint32(10).string(e.participantSid),e.quality!==0&&i.uint32(16).int32(e.quality),e.score!==0&&i.uint32(29).float(e.score),i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseConnectionQualityInfo();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.participantSid=t.string();break;case 2:a.quality=t.int32();break;case 3:a.score=t.float();break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{participantSid:isSet(e.participantSid)?String(e.participantSid):"",quality:isSet(e.quality)?connectionQualityFromJSON(e.quality):0,score:isSet(e.score)?Number(e.score):0}},toJSON(e){const i={};return e.participantSid!==void 0&&(i.participantSid=e.participantSid),e.quality!==void 0&&(i.quality=connectionQualityToJSON(e.quality)),e.score!==void 0&&(i.score=e.score),i},fromPartial(e){var t,n,a;const i=createBaseConnectionQualityInfo();return i.participantSid=(t=e.participantSid)!=null?t:"",i.quality=(n=e.quality)!=null?n:0,i.score=(a=e.score)!=null?a:0,i}};function createBaseConnectionQualityUpdate(){return{updates:[]}}const ConnectionQualityUpdate={encode(e,i=_m0.Writer.create()){for(const t of e.updates)ConnectionQualityInfo.encode(t,i.uint32(10).fork()).ldelim();return i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseConnectionQualityUpdate();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.updates.push(ConnectionQualityInfo.decode(t,t.uint32()));break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{updates:Array.isArray(e==null?void 0:e.updates)?e.updates.map(i=>ConnectionQualityInfo.fromJSON(i)):[]}},toJSON(e){const i={};return e.updates?i.updates=e.updates.map(t=>t?ConnectionQualityInfo.toJSON(t):void 0):i.updates=[],i},fromPartial(e){var t;const i=createBaseConnectionQualityUpdate();return i.updates=((t=e.updates)==null?void 0:t.map(n=>ConnectionQualityInfo.fromPartial(n)))||[],i}};function createBaseStreamStateInfo(){return{participantSid:"",trackSid:"",state:0}}const StreamStateInfo={encode(e,i=_m0.Writer.create()){return e.participantSid!==""&&i.uint32(10).string(e.participantSid),e.trackSid!==""&&i.uint32(18).string(e.trackSid),e.state!==0&&i.uint32(24).int32(e.state),i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseStreamStateInfo();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.participantSid=t.string();break;case 2:a.trackSid=t.string();break;case 3:a.state=t.int32();break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{participantSid:isSet(e.participantSid)?String(e.participantSid):"",trackSid:isSet(e.trackSid)?String(e.trackSid):"",state:isSet(e.state)?streamStateFromJSON(e.state):0}},toJSON(e){const i={};return e.participantSid!==void 0&&(i.participantSid=e.participantSid),e.trackSid!==void 0&&(i.trackSid=e.trackSid),e.state!==void 0&&(i.state=streamStateToJSON(e.state)),i},fromPartial(e){var t,n,a;const i=createBaseStreamStateInfo();return i.participantSid=(t=e.participantSid)!=null?t:"",i.trackSid=(n=e.trackSid)!=null?n:"",i.state=(a=e.state)!=null?a:0,i}};function createBaseStreamStateUpdate(){return{streamStates:[]}}const StreamStateUpdate={encode(e,i=_m0.Writer.create()){for(const t of e.streamStates)StreamStateInfo.encode(t,i.uint32(10).fork()).ldelim();return i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseStreamStateUpdate();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.streamStates.push(StreamStateInfo.decode(t,t.uint32()));break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{streamStates:Array.isArray(e==null?void 0:e.streamStates)?e.streamStates.map(i=>StreamStateInfo.fromJSON(i)):[]}},toJSON(e){const i={};return e.streamStates?i.streamStates=e.streamStates.map(t=>t?StreamStateInfo.toJSON(t):void 0):i.streamStates=[],i},fromPartial(e){var t;const i=createBaseStreamStateUpdate();return i.streamStates=((t=e.streamStates)==null?void 0:t.map(n=>StreamStateInfo.fromPartial(n)))||[],i}};function createBaseSubscribedQuality(){return{quality:0,enabled:!1}}const SubscribedQuality={encode(e,i=_m0.Writer.create()){return e.quality!==0&&i.uint32(8).int32(e.quality),e.enabled===!0&&i.uint32(16).bool(e.enabled),i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseSubscribedQuality();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.quality=t.int32();break;case 2:a.enabled=t.bool();break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{quality:isSet(e.quality)?videoQualityFromJSON(e.quality):0,enabled:isSet(e.enabled)?Boolean(e.enabled):!1}},toJSON(e){const i={};return e.quality!==void 0&&(i.quality=videoQualityToJSON(e.quality)),e.enabled!==void 0&&(i.enabled=e.enabled),i},fromPartial(e){var t,n;const i=createBaseSubscribedQuality();return i.quality=(t=e.quality)!=null?t:0,i.enabled=(n=e.enabled)!=null?n:!1,i}};function createBaseSubscribedCodec(){return{codec:"",qualities:[]}}const SubscribedCodec={encode(e,i=_m0.Writer.create()){e.codec!==""&&i.uint32(10).string(e.codec);for(const t of e.qualities)SubscribedQuality.encode(t,i.uint32(18).fork()).ldelim();return i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseSubscribedCodec();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.codec=t.string();break;case 2:a.qualities.push(SubscribedQuality.decode(t,t.uint32()));break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{codec:isSet(e.codec)?String(e.codec):"",qualities:Array.isArray(e==null?void 0:e.qualities)?e.qualities.map(i=>SubscribedQuality.fromJSON(i)):[]}},toJSON(e){const i={};return e.codec!==void 0&&(i.codec=e.codec),e.qualities?i.qualities=e.qualities.map(t=>t?SubscribedQuality.toJSON(t):void 0):i.qualities=[],i},fromPartial(e){var t,n;const i=createBaseSubscribedCodec();return i.codec=(t=e.codec)!=null?t:"",i.qualities=((n=e.qualities)==null?void 0:n.map(a=>SubscribedQuality.fromPartial(a)))||[],i}};function createBaseSubscribedQualityUpdate(){return{trackSid:"",subscribedQualities:[],subscribedCodecs:[]}}const SubscribedQualityUpdate={encode(e,i=_m0.Writer.create()){e.trackSid!==""&&i.uint32(10).string(e.trackSid);for(const t of e.subscribedQualities)SubscribedQuality.encode(t,i.uint32(18).fork()).ldelim();for(const t of e.subscribedCodecs)SubscribedCodec.encode(t,i.uint32(26).fork()).ldelim();return i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseSubscribedQualityUpdate();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.trackSid=t.string();break;case 2:a.subscribedQualities.push(SubscribedQuality.decode(t,t.uint32()));break;case 3:a.subscribedCodecs.push(SubscribedCodec.decode(t,t.uint32()));break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{trackSid:isSet(e.trackSid)?String(e.trackSid):"",subscribedQualities:Array.isArray(e==null?void 0:e.subscribedQualities)?e.subscribedQualities.map(i=>SubscribedQuality.fromJSON(i)):[],subscribedCodecs:Array.isArray(e==null?void 0:e.subscribedCodecs)?e.subscribedCodecs.map(i=>SubscribedCodec.fromJSON(i)):[]}},toJSON(e){const i={};return e.trackSid!==void 0&&(i.trackSid=e.trackSid),e.subscribedQualities?i.subscribedQualities=e.subscribedQualities.map(t=>t?SubscribedQuality.toJSON(t):void 0):i.subscribedQualities=[],e.subscribedCodecs?i.subscribedCodecs=e.subscribedCodecs.map(t=>t?SubscribedCodec.toJSON(t):void 0):i.subscribedCodecs=[],i},fromPartial(e){var t,n,a;const i=createBaseSubscribedQualityUpdate();return i.trackSid=(t=e.trackSid)!=null?t:"",i.subscribedQualities=((n=e.subscribedQualities)==null?void 0:n.map(s=>SubscribedQuality.fromPartial(s)))||[],i.subscribedCodecs=((a=e.subscribedCodecs)==null?void 0:a.map(s=>SubscribedCodec.fromPartial(s)))||[],i}};function createBaseTrackPermission(){return{participantSid:"",allTracks:!1,trackSids:[],participantIdentity:""}}const TrackPermission={encode(e,i=_m0.Writer.create()){e.participantSid!==""&&i.uint32(10).string(e.participantSid),e.allTracks===!0&&i.uint32(16).bool(e.allTracks);for(const t of e.trackSids)i.uint32(26).string(t);return e.participantIdentity!==""&&i.uint32(34).string(e.participantIdentity),i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseTrackPermission();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.participantSid=t.string();break;case 2:a.allTracks=t.bool();break;case 3:a.trackSids.push(t.string());break;case 4:a.participantIdentity=t.string();break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{participantSid:isSet(e.participantSid)?String(e.participantSid):"",allTracks:isSet(e.allTracks)?Boolean(e.allTracks):!1,trackSids:Array.isArray(e==null?void 0:e.trackSids)?e.trackSids.map(i=>String(i)):[],participantIdentity:isSet(e.participantIdentity)?String(e.participantIdentity):""}},toJSON(e){const i={};return e.participantSid!==void 0&&(i.participantSid=e.participantSid),e.allTracks!==void 0&&(i.allTracks=e.allTracks),e.trackSids?i.trackSids=e.trackSids.map(t=>t):i.trackSids=[],e.participantIdentity!==void 0&&(i.participantIdentity=e.participantIdentity),i},fromPartial(e){var t,n,a,s;const i=createBaseTrackPermission();return i.participantSid=(t=e.participantSid)!=null?t:"",i.allTracks=(n=e.allTracks)!=null?n:!1,i.trackSids=((a=e.trackSids)==null?void 0:a.map(o=>o))||[],i.participantIdentity=(s=e.participantIdentity)!=null?s:"",i}};function createBaseSubscriptionPermission(){return{allParticipants:!1,trackPermissions:[]}}const SubscriptionPermission={encode(e,i=_m0.Writer.create()){e.allParticipants===!0&&i.uint32(8).bool(e.allParticipants);for(const t of e.trackPermissions)TrackPermission.encode(t,i.uint32(18).fork()).ldelim();return i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseSubscriptionPermission();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.allParticipants=t.bool();break;case 2:a.trackPermissions.push(TrackPermission.decode(t,t.uint32()));break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{allParticipants:isSet(e.allParticipants)?Boolean(e.allParticipants):!1,trackPermissions:Array.isArray(e==null?void 0:e.trackPermissions)?e.trackPermissions.map(i=>TrackPermission.fromJSON(i)):[]}},toJSON(e){const i={};return e.allParticipants!==void 0&&(i.allParticipants=e.allParticipants),e.trackPermissions?i.trackPermissions=e.trackPermissions.map(t=>t?TrackPermission.toJSON(t):void 0):i.trackPermissions=[],i},fromPartial(e){var t,n;const i=createBaseSubscriptionPermission();return i.allParticipants=(t=e.allParticipants)!=null?t:!1,i.trackPermissions=((n=e.trackPermissions)==null?void 0:n.map(a=>TrackPermission.fromPartial(a)))||[],i}};function createBaseSubscriptionPermissionUpdate(){return{participantSid:"",trackSid:"",allowed:!1}}const SubscriptionPermissionUpdate={encode(e,i=_m0.Writer.create()){return e.participantSid!==""&&i.uint32(10).string(e.participantSid),e.trackSid!==""&&i.uint32(18).string(e.trackSid),e.allowed===!0&&i.uint32(24).bool(e.allowed),i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseSubscriptionPermissionUpdate();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.participantSid=t.string();break;case 2:a.trackSid=t.string();break;case 3:a.allowed=t.bool();break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{participantSid:isSet(e.participantSid)?String(e.participantSid):"",trackSid:isSet(e.trackSid)?String(e.trackSid):"",allowed:isSet(e.allowed)?Boolean(e.allowed):!1}},toJSON(e){const i={};return e.participantSid!==void 0&&(i.participantSid=e.participantSid),e.trackSid!==void 0&&(i.trackSid=e.trackSid),e.allowed!==void 0&&(i.allowed=e.allowed),i},fromPartial(e){var t,n,a;const i=createBaseSubscriptionPermissionUpdate();return i.participantSid=(t=e.participantSid)!=null?t:"",i.trackSid=(n=e.trackSid)!=null?n:"",i.allowed=(a=e.allowed)!=null?a:!1,i}};function createBaseSyncState(){return{answer:void 0,subscription:void 0,publishTracks:[],dataChannels:[],offer:void 0}}const SyncState={encode(e,i=_m0.Writer.create()){e.answer!==void 0&&SessionDescription.encode(e.answer,i.uint32(10).fork()).ldelim(),e.subscription!==void 0&&UpdateSubscription.encode(e.subscription,i.uint32(18).fork()).ldelim();for(const t of e.publishTracks)TrackPublishedResponse.encode(t,i.uint32(26).fork()).ldelim();for(const t of e.dataChannels)DataChannelInfo.encode(t,i.uint32(34).fork()).ldelim();return e.offer!==void 0&&SessionDescription.encode(e.offer,i.uint32(42).fork()).ldelim(),i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseSyncState();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.answer=SessionDescription.decode(t,t.uint32());break;case 2:a.subscription=UpdateSubscription.decode(t,t.uint32());break;case 3:a.publishTracks.push(TrackPublishedResponse.decode(t,t.uint32()));break;case 4:a.dataChannels.push(DataChannelInfo.decode(t,t.uint32()));break;case 5:a.offer=SessionDescription.decode(t,t.uint32());break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{answer:isSet(e.answer)?SessionDescription.fromJSON(e.answer):void 0,subscription:isSet(e.subscription)?UpdateSubscription.fromJSON(e.subscription):void 0,publishTracks:Array.isArray(e==null?void 0:e.publishTracks)?e.publishTracks.map(i=>TrackPublishedResponse.fromJSON(i)):[],dataChannels:Array.isArray(e==null?void 0:e.dataChannels)?e.dataChannels.map(i=>DataChannelInfo.fromJSON(i)):[],offer:isSet(e.offer)?SessionDescription.fromJSON(e.offer):void 0}},toJSON(e){const i={};return e.answer!==void 0&&(i.answer=e.answer?SessionDescription.toJSON(e.answer):void 0),e.subscription!==void 0&&(i.subscription=e.subscription?UpdateSubscription.toJSON(e.subscription):void 0),e.publishTracks?i.publishTracks=e.publishTracks.map(t=>t?TrackPublishedResponse.toJSON(t):void 0):i.publishTracks=[],e.dataChannels?i.dataChannels=e.dataChannels.map(t=>t?DataChannelInfo.toJSON(t):void 0):i.dataChannels=[],e.offer!==void 0&&(i.offer=e.offer?SessionDescription.toJSON(e.offer):void 0),i},fromPartial(e){var t,n;const i=createBaseSyncState();return i.answer=e.answer!==void 0&&e.answer!==null?SessionDescription.fromPartial(e.answer):void 0,i.subscription=e.subscription!==void 0&&e.subscription!==null?UpdateSubscription.fromPartial(e.subscription):void 0,i.publishTracks=((t=e.publishTracks)==null?void 0:t.map(a=>TrackPublishedResponse.fromPartial(a)))||[],i.dataChannels=((n=e.dataChannels)==null?void 0:n.map(a=>DataChannelInfo.fromPartial(a)))||[],i.offer=e.offer!==void 0&&e.offer!==null?SessionDescription.fromPartial(e.offer):void 0,i}};function createBaseDataChannelInfo(){return{label:"",id:0,target:0}}const DataChannelInfo={encode(e,i=_m0.Writer.create()){return e.label!==""&&i.uint32(10).string(e.label),e.id!==0&&i.uint32(16).uint32(e.id),e.target!==0&&i.uint32(24).int32(e.target),i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseDataChannelInfo();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.label=t.string();break;case 2:a.id=t.uint32();break;case 3:a.target=t.int32();break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{label:isSet(e.label)?String(e.label):"",id:isSet(e.id)?Number(e.id):0,target:isSet(e.target)?signalTargetFromJSON(e.target):0}},toJSON(e){const i={};return e.label!==void 0&&(i.label=e.label),e.id!==void 0&&(i.id=Math.round(e.id)),e.target!==void 0&&(i.target=signalTargetToJSON(e.target)),i},fromPartial(e){var t,n,a;const i=createBaseDataChannelInfo();return i.label=(t=e.label)!=null?t:"",i.id=(n=e.id)!=null?n:0,i.target=(a=e.target)!=null?a:0,i}};function createBaseSimulateScenario(){return{scenario:void 0}}const SimulateScenario={encode(e,i=_m0.Writer.create()){var t,n,a,s,o;return((t=e.scenario)==null?void 0:t.$case)==="speakerUpdate"&&i.uint32(8).int32(e.scenario.speakerUpdate),((n=e.scenario)==null?void 0:n.$case)==="nodeFailure"&&i.uint32(16).bool(e.scenario.nodeFailure),((a=e.scenario)==null?void 0:a.$case)==="migration"&&i.uint32(24).bool(e.scenario.migration),((s=e.scenario)==null?void 0:s.$case)==="serverLeave"&&i.uint32(32).bool(e.scenario.serverLeave),((o=e.scenario)==null?void 0:o.$case)==="switchCandidateProtocol"&&i.uint32(40).int32(e.scenario.switchCandidateProtocol),i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBaseSimulateScenario();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.scenario={$case:"speakerUpdate",speakerUpdate:t.int32()};break;case 2:a.scenario={$case:"nodeFailure",nodeFailure:t.bool()};break;case 3:a.scenario={$case:"migration",migration:t.bool()};break;case 4:a.scenario={$case:"serverLeave",serverLeave:t.bool()};break;case 5:a.scenario={$case:"switchCandidateProtocol",switchCandidateProtocol:t.int32()};break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{scenario:isSet(e.speakerUpdate)?{$case:"speakerUpdate",speakerUpdate:Number(e.speakerUpdate)}:isSet(e.nodeFailure)?{$case:"nodeFailure",nodeFailure:Boolean(e.nodeFailure)}:isSet(e.migration)?{$case:"migration",migration:Boolean(e.migration)}:isSet(e.serverLeave)?{$case:"serverLeave",serverLeave:Boolean(e.serverLeave)}:isSet(e.switchCandidateProtocol)?{$case:"switchCandidateProtocol",switchCandidateProtocol:candidateProtocolFromJSON(e.switchCandidateProtocol)}:void 0}},toJSON(e){var t,n,a,s,o,c,d,u,l,f,p;const i={};return((t=e.scenario)==null?void 0:t.$case)==="speakerUpdate"&&(i.speakerUpdate=Math.round((n=e.scenario)==null?void 0:n.speakerUpdate)),((a=e.scenario)==null?void 0:a.$case)==="nodeFailure"&&(i.nodeFailure=(s=e.scenario)==null?void 0:s.nodeFailure),((o=e.scenario)==null?void 0:o.$case)==="migration"&&(i.migration=(c=e.scenario)==null?void 0:c.migration),((d=e.scenario)==null?void 0:d.$case)==="serverLeave"&&(i.serverLeave=(u=e.scenario)==null?void 0:u.serverLeave),((l=e.scenario)==null?void 0:l.$case)==="switchCandidateProtocol"&&(i.switchCandidateProtocol=((f=e.scenario)==null?void 0:f.switchCandidateProtocol)!==void 0?candidateProtocolToJSON((p=e.scenario)==null?void 0:p.switchCandidateProtocol):void 0),i},fromPartial(e){var t,n,a,s,o,c,d,u,l,f,p,m,g,S,v;const i=createBaseSimulateScenario();return((t=e.scenario)==null?void 0:t.$case)==="speakerUpdate"&&((n=e.scenario)==null?void 0:n.speakerUpdate)!==void 0&&((a=e.scenario)==null?void 0:a.speakerUpdate)!==null&&(i.scenario={$case:"speakerUpdate",speakerUpdate:e.scenario.speakerUpdate}),((s=e.scenario)==null?void 0:s.$case)==="nodeFailure"&&((o=e.scenario)==null?void 0:o.nodeFailure)!==void 0&&((c=e.scenario)==null?void 0:c.nodeFailure)!==null&&(i.scenario={$case:"nodeFailure",nodeFailure:e.scenario.nodeFailure}),((d=e.scenario)==null?void 0:d.$case)==="migration"&&((u=e.scenario)==null?void 0:u.migration)!==void 0&&((l=e.scenario)==null?void 0:l.migration)!==null&&(i.scenario={$case:"migration",migration:e.scenario.migration}),((f=e.scenario)==null?void 0:f.$case)==="serverLeave"&&((p=e.scenario)==null?void 0:p.serverLeave)!==void 0&&((m=e.scenario)==null?void 0:m.serverLeave)!==null&&(i.scenario={$case:"serverLeave",serverLeave:e.scenario.serverLeave}),((g=e.scenario)==null?void 0:g.$case)==="switchCandidateProtocol"&&((S=e.scenario)==null?void 0:S.switchCandidateProtocol)!==void 0&&((v=e.scenario)==null?void 0:v.switchCandidateProtocol)!==null&&(i.scenario={$case:"switchCandidateProtocol",switchCandidateProtocol:e.scenario.switchCandidateProtocol}),i}};function createBasePing(){return{timestamp:0,rtt:0}}const Ping={encode(e,i=_m0.Writer.create()){return e.timestamp!==0&&i.uint32(8).int64(e.timestamp),e.rtt!==0&&i.uint32(16).int64(e.rtt),i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBasePing();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.timestamp=longToNumber(t.int64());break;case 2:a.rtt=longToNumber(t.int64());break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{timestamp:isSet(e.timestamp)?Number(e.timestamp):0,rtt:isSet(e.rtt)?Number(e.rtt):0}},toJSON(e){const i={};return e.timestamp!==void 0&&(i.timestamp=Math.round(e.timestamp)),e.rtt!==void 0&&(i.rtt=Math.round(e.rtt)),i},fromPartial(e){var t,n;const i=createBasePing();return i.timestamp=(t=e.timestamp)!=null?t:0,i.rtt=(n=e.rtt)!=null?n:0,i}};function createBasePong(){return{lastPingTimestamp:0,timestamp:0}}const Pong={encode(e,i=_m0.Writer.create()){return e.lastPingTimestamp!==0&&i.uint32(8).int64(e.lastPingTimestamp),e.timestamp!==0&&i.uint32(16).int64(e.timestamp),i},decode(e,i){const t=e instanceof _m0.Reader?e:new _m0.Reader(e);let n=i===void 0?t.len:t.pos+i;const a=createBasePong();for(;t.pos<n;){const s=t.uint32();switch(s>>>3){case 1:a.lastPingTimestamp=longToNumber(t.int64());break;case 2:a.timestamp=longToNumber(t.int64());break;default:t.skipType(s&7);break}}return a},fromJSON(e){return{lastPingTimestamp:isSet(e.lastPingTimestamp)?Number(e.lastPingTimestamp):0,timestamp:isSet(e.timestamp)?Number(e.timestamp):0}},toJSON(e){const i={};return e.lastPingTimestamp!==void 0&&(i.lastPingTimestamp=Math.round(e.lastPingTimestamp)),e.timestamp!==void 0&&(i.timestamp=Math.round(e.timestamp)),i},fromPartial(e){var t,n;const i=createBasePong();return i.lastPingTimestamp=(t=e.lastPingTimestamp)!=null?t:0,i.timestamp=(n=e.timestamp)!=null?n:0,i}};var tsProtoGlobalThis=(()=>{if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw"Unable to locate global object"})();function longToNumber(e){if(e.gt(Number.MAX_SAFE_INTEGER))throw new tsProtoGlobalThis.Error("Value is larger than Number.MAX_SAFE_INTEGER");return e.toNumber()}_m0.util.Long!==long&&(_m0.util.Long=long,_m0.configure());function isSet(e){return e!=null}class LivekitError extends Error{constructor(t,n){super(n||"an error has occured");h(this,"code");this.code=t}}var ConnectionErrorReason=(e=>(e[e.NotAllowed=0]="NotAllowed",e[e.ServerUnreachable=1]="ServerUnreachable",e[e.InternalError=2]="InternalError",e))(ConnectionErrorReason||{});class ConnectionError extends LivekitError{constructor(t,n,a){super(1,t);h(this,"status");h(this,"reason");this.status=a,this.reason=n}}class DeviceUnsupportedError extends LivekitError{constructor(i){super(21,i!=null?i:"device is unsupported")}}class TrackInvalidError extends LivekitError{constructor(i){super(20,i!=null?i:"track is invalid")}}class UnsupportedServer extends LivekitError{constructor(i){super(10,i!=null?i:"unsupported server")}}class UnexpectedConnectionState extends LivekitError{constructor(i){super(12,i!=null?i:"unexpected connection state")}}class NegotiationError extends LivekitError{constructor(i){super(13,i!=null?i:"unable to negotiate")}}var MediaDeviceFailure=(e=>(e.PermissionDenied="PermissionDenied",e.NotFound="NotFound",e.DeviceInUse="DeviceInUse",e.Other="Other",e))(MediaDeviceFailure||{});(e=>{function i(t){if(t&&"name"in t)return t.name==="NotFoundError"||t.name==="DevicesNotFoundError"?"NotFound":t.name==="NotAllowedError"||t.name==="PermissionDeniedError"?"PermissionDenied":t.name==="NotReadableError"||t.name==="TrackStartError"?"DeviceInUse":"Other"}e.getFailure=i})(MediaDeviceFailure||(MediaDeviceFailure={}));var RoomEvent=(e=>(e.Connected="connected",e.Reconnecting="reconnecting",e.Reconnected="reconnected",e.Disconnected="disconnected",e.ConnectionStateChanged="connectionStateChanged",e.StateChanged="connectionStateChanged",e.MediaDevicesChanged="mediaDevicesChanged",e.ParticipantConnected="participantConnected",e.ParticipantDisconnected="participantDisconnected",e.TrackPublished="trackPublished",e.TrackSubscribed="trackSubscribed",e.TrackSubscriptionFailed="trackSubscriptionFailed",e.TrackUnpublished="trackUnpublished",e.TrackUnsubscribed="trackUnsubscribed",e.TrackMuted="trackMuted",e.TrackUnmuted="trackUnmuted",e.LocalTrackPublished="localTrackPublished",e.LocalTrackUnpublished="localTrackUnpublished",e.ActiveSpeakersChanged="activeSpeakersChanged",e.ParticipantMetadataChanged="participantMetadataChanged",e.RoomMetadataChanged="roomMetadataChanged",e.DataReceived="dataReceived",e.ConnectionQualityChanged="connectionQualityChanged",e.TrackStreamStateChanged="trackStreamStateChanged",e.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",e.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",e.AudioPlaybackStatusChanged="audioPlaybackChanged",e.MediaDevicesError="mediaDevicesError",e.ParticipantPermissionsChanged="participantPermissionsChanged",e.SignalConnected="signalConnected",e.RecordingStatusChanged="recordingStatusChanged",e))(RoomEvent||{}),ParticipantEvent=(e=>(e.TrackPublished="trackPublished",e.TrackSubscribed="trackSubscribed",e.TrackSubscriptionFailed="trackSubscriptionFailed",e.TrackUnpublished="trackUnpublished",e.TrackUnsubscribed="trackUnsubscribed",e.TrackMuted="trackMuted",e.TrackUnmuted="trackUnmuted",e.LocalTrackPublished="localTrackPublished",e.LocalTrackUnpublished="localTrackUnpublished",e.ParticipantMetadataChanged="participantMetadataChanged",e.DataReceived="dataReceived",e.IsSpeakingChanged="isSpeakingChanged",e.ConnectionQualityChanged="connectionQualityChanged",e.TrackStreamStateChanged="trackStreamStateChanged",e.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",e.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",e.MediaDevicesError="mediaDevicesError",e.ParticipantPermissionsChanged="participantPermissionsChanged",e))(ParticipantEvent||{}),EngineEvent=(e=>(e.TransportsCreated="transportsCreated",e.Connected="connected",e.Disconnected="disconnected",e.Resuming="resuming",e.Resumed="resumed",e.Restarting="restarting",e.Restarted="restarted",e.SignalResumed="signalResumed",e.Closing="closing",e.MediaTrackAdded="mediaTrackAdded",e.ActiveSpeakersUpdate="activeSpeakersUpdate",e.DataPacketReceived="dataPacketReceived",e))(EngineEvent||{}),TrackEvent=(e=>(e.Message="message",e.Muted="muted",e.Unmuted="unmuted",e.Restarted="restarted",e.Ended="ended",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed",e.UpdateSettings="updateSettings",e.UpdateSubscription="updateSubscription",e.AudioPlaybackStarted="audioPlaybackStarted",e.AudioPlaybackFailed="audioPlaybackFailed",e.AudioSilenceDetected="audioSilenceDetected",e.VisibilityChanged="visibilityChanged",e.VideoDimensionsChanged="videoDimensionsChanged",e.ElementAttached="elementAttached",e.ElementDetached="elementDetached",e.UpstreamPaused="upstreamPaused",e.UpstreamResumed="upstreamResumed",e.SubscriptionPermissionChanged="subscriptionPermissionChanged",e.SubscriptionStatusChanged="subscriptionStatusChanged",e))(TrackEvent||{});const monitorFrequency=2e3;function computeBitrate(e,i){if(!i)return 0;let t,n;return"bytesReceived"in e?(t=e.bytesReceived,n=i.bytesReceived):"bytesSent"in e&&(t=e.bytesSent,n=i.bytesSent),t===void 0||n===void 0||e.timestamp===void 0||i.timestamp===void 0?0:(t-n)*8*1e3/(e.timestamp-i.timestamp)}var uaParser={exports:{}};(function(e,i){(function(t,n){var a="1.0.2",s="",o="?",c="function",d="undefined",u="object",l="string",f="major",p="model",m="name",g="type",S="vendor",v="version",T="architecture",k="console",b="mobile",y="tablet",N="smarttv",D="wearable",B="embedded",A=255,C="Amazon",I="Apple",U="ASUS",F="BlackBerry",M="Browser",V="Chrome",te="Edge",J="Firefox",q="Google",Y="Huawei",Q="LG",H="Microsoft",X="Motorola",W="Opera",z="Samsung",Z="Sony",j="Xiaomi",K="Zebra",ee="Facebook",ie=function(P,L){var E={};for(var _ in P)L[_]&&L[_].length%2===0?E[_]=L[_].concat(P[_]):E[_]=P[_];return E},G=function(P){for(var L={},E=0;E<P.length;E++)L[P[E].toUpperCase()]=P[E];return L},ne=function(P,L){return typeof P===l?ae(L).indexOf(ae(P))!==-1:!1},ae=function(P){return P.toLowerCase()},pe=function(P){return typeof P===l?P.replace(/[^\d\.]/g,s).split(".")[0]:n},ce=function(P,L){if(typeof P===l)return P=P.replace(/^\s\s*/,s).replace(/\s\s*$/,s),typeof L===d?P:P.substring(0,A)},se=function(P,L){for(var E=0,_,w,Se,O,ge,oe;E<L.length&&!ge;){var ve=L[E],ke=L[E+1];for(_=w=0;_<ve.length&&!ge;)if(ge=ve[_++].exec(P),ge)for(Se=0;Se<ke.length;Se++)oe=ge[++w],O=ke[Se],typeof O===u&&O.length>0?O.length===2?typeof O[1]==c?this[O[0]]=O[1].call(this,oe):this[O[0]]=O[1]:O.length===3?typeof O[1]===c&&!(O[1].exec&&O[1].test)?this[O[0]]=oe?O[1].call(this,oe,O[2]):n:this[O[0]]=oe?oe.replace(O[1],O[2]):n:O.length===4&&(this[O[0]]=oe?O[3].call(this,oe.replace(O[1],O[2])):n):this[O]=oe||n;E+=2}},de=function(P,L){for(var E in L)if(typeof L[E]===u&&L[E].length>0){for(var _=0;_<L[E].length;_++)if(ne(L[E][_],P))return E===o?n:E}else if(ne(L[E],P))return E===o?n:E;return P},he={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},ue={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},le={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[v,[m,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[v,[m,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[m,v],[/opios[\/ ]+([\w\.]+)/i],[v,[m,W+" Mini"]],[/\bopr\/([\w\.]+)/i],[v,[m,W]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[m,v],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[v,[m,"UC"+M]],[/\bqbcore\/([\w\.]+)/i],[v,[m,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[v,[m,"WeChat"]],[/konqueror\/([\w\.]+)/i],[v,[m,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[v,[m,"IE"]],[/yabrowser\/([\w\.]+)/i],[v,[m,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[m,/(.+)/,"$1 Secure "+M],v],[/\bfocus\/([\w\.]+)/i],[v,[m,J+" Focus"]],[/\bopt\/([\w\.]+)/i],[v,[m,W+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[v,[m,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[v,[m,"Dolphin"]],[/coast\/([\w\.]+)/i],[v,[m,W+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[v,[m,"MIUI "+M]],[/fxios\/([-\w\.]+)/i],[v,[m,J]],[/\bqihu|(qi?ho?o?|360)browser/i],[[m,"360 "+M]],[/(oculus|samsung|sailfish)browser\/([\w\.]+)/i],[[m,/(.+)/,"$1 "+M],v],[/(comodo_dragon)\/([\w\.]+)/i],[[m,/_/g," "],v],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[m,v],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i],[m],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[m,ee],v],[/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[m,v],[/\bgsa\/([\w\.]+) .*safari\//i],[v,[m,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[v,[m,V+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[m,V+" WebView"],v],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[v,[m,"Android "+M]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[m,v],[/version\/([\w\.]+) .*mobile\/\w+ (safari)/i],[v,[m,"Mobile Safari"]],[/version\/([\w\.]+) .*(mobile ?safari|safari)/i],[v,m],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[m,[v,de,he]],[/(webkit|khtml)\/([\w\.]+)/i],[m,v],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[m,"Netscape"],v],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[v,[m,J+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[m,v]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[T,"amd64"]],[/(ia32(?=;))/i],[[T,ae]],[/((?:i[346]|x)86)[;\)]/i],[[T,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[T,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[T,"armhf"]],[/windows (ce|mobile); ppc;/i],[[T,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[T,/ower/,s,ae]],[/(sun4\w)[;\)]/i],[[T,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[T,ae]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[pt]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[p,[S,z],[g,y]],[/\b((?:s[cgp]h|gt|sm)-\w+|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[p,[S,z],[g,b]],[/\((ip(?:hone|od)[\w ]*);/i],[p,[S,I],[g,b]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[p,[S,I],[g,y]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[p,[S,Y],[g,y]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}-[atu]?[ln][01259x][012359][an]?)\b(?!.+d\/s)/i],[p,[S,Y],[g,b]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[p,/_/g," "],[S,j],[g,b]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[p,/_/g," "],[S,j],[g,y]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[p,[S,"OPPO"],[g,b]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[p,[S,"Vivo"],[g,b]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[p,[S,"Realme"],[g,b]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[p,[S,X],[g,b]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[p,[S,X],[g,y]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[p,[S,Q],[g,y]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[p,[S,Q],[g,b]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[p,[S,"Lenovo"],[g,y]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[p,/_/g," "],[S,"Nokia"],[g,b]],[/(pixel c)\b/i],[p,[S,q],[g,y]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[p,[S,q],[g,b]],[/droid.+ ([c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[p,[S,Z],[g,b]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[p,"Xperia Tablet"],[S,Z],[g,y]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[p,[S,"OnePlus"],[g,b]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[p,[S,C],[g,y]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[p,/(.+)/g,"Fire Phone $1"],[S,C],[g,b]],[/(playbook);[-\w\),; ]+(rim)/i],[p,S,[g,y]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[p,[S,F],[g,b]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[p,[S,U],[g,y]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[p,[S,U],[g,b]],[/(nexus 9)/i],[p,[S,"HTC"],[g,y]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic|sony)[-_ ]?([-\w]*)/i],[S,[p,/_/g," "],[g,b]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[p,[S,"Acer"],[g,y]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[p,[S,"Meizu"],[g,b]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[p,[S,"Sharp"],[g,b]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[S,p,[g,b]],[/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[S,p,[g,y]],[/(surface duo)/i],[p,[S,H],[g,y]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[p,[S,"Fairphone"],[g,b]],[/(u304aa)/i],[p,[S,"AT&T"],[g,b]],[/\bsie-(\w*)/i],[p,[S,"Siemens"],[g,b]],[/\b(rct\w+) b/i],[p,[S,"RCA"],[g,y]],[/\b(venue[\d ]{2,7}) b/i],[p,[S,"Dell"],[g,y]],[/\b(q(?:mv|ta)\w+) b/i],[p,[S,"Verizon"],[g,y]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[p,[S,"Barnes & Noble"],[g,y]],[/\b(tm\d{3}\w+) b/i],[p,[S,"NuVision"],[g,y]],[/\b(k88) b/i],[p,[S,"ZTE"],[g,y]],[/\b(nx\d{3}j) b/i],[p,[S,"ZTE"],[g,b]],[/\b(gen\d{3}) b.+49h/i],[p,[S,"Swiss"],[g,b]],[/\b(zur\d{3}) b/i],[p,[S,"Swiss"],[g,y]],[/\b((zeki)?tb.*\b) b/i],[p,[S,"Zeki"],[g,y]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[S,"Dragon Touch"],p,[g,y]],[/\b(ns-?\w{0,9}) b/i],[p,[S,"Insignia"],[g,y]],[/\b((nxa|next)-?\w{0,9}) b/i],[p,[S,"NextBook"],[g,y]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[S,"Voice"],p,[g,b]],[/\b(lvtel\-)?(v1[12]) b/i],[[S,"LvTel"],p,[g,b]],[/\b(ph-1) /i],[p,[S,"Essential"],[g,b]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[p,[S,"Envizen"],[g,y]],[/\b(trio[-\w\. ]+) b/i],[p,[S,"MachSpeed"],[g,y]],[/\btu_(1491) b/i],[p,[S,"Rotor"],[g,y]],[/(shield[\w ]+) b/i],[p,[S,"Nvidia"],[g,y]],[/(sprint) (\w+)/i],[S,p,[g,b]],[/(kin\.[onetw]{3})/i],[[p,/\./g," "],[S,H],[g,b]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[p,[S,K],[g,y]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[p,[S,K],[g,b]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[S,p,[g,k]],[/droid.+; (shield) bui/i],[p,[S,"Nvidia"],[g,k]],[/(playstation [345portablevi]+)/i],[p,[S,Z],[g,k]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[p,[S,H],[g,k]],[/smart-tv.+(samsung)/i],[S,[g,N]],[/hbbtv.+maple;(\d+)/i],[[p,/^/,"SmartTV"],[S,z],[g,N]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[S,Q],[g,N]],[/(apple) ?tv/i],[S,[p,I+" TV"],[g,N]],[/crkey/i],[[p,V+"cast"],[S,q],[g,N]],[/droid.+aft(\w)( bui|\))/i],[p,[S,C],[g,N]],[/\(dtv[\);].+(aquos)/i],[p,[S,"Sharp"],[g,N]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w ]*; *(\w[^;]*);([^;]*)/i],[[S,ce],[p,ce],[g,N]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[g,N]],[/((pebble))app/i],[S,p,[g,D]],[/droid.+; (glass) \d/i],[p,[S,q],[g,D]],[/droid.+; (wt63?0{2,3})\)/i],[p,[S,K],[g,D]],[/(quest( 2)?)/i],[p,[S,ee],[g,D]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[S,[g,B]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[p,[g,b]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[p,[g,y]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[g,y]],[/(phone|mobile(?:[;\/]| safari)|pda(?=.+windows ce))/i],[[g,b]],[/(android[-\w\. ]{0,9});.+buil/i],[p,[S,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[v,[m,te+"HTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[v,[m,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[m,v],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[v,m]],os:[[/microsoft (windows) (vista|xp)/i],[m,v],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[m,[v,de,ue]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[m,"Windows"],[v,de,ue]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[v,/_/g,"."],[m,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[m,"Mac OS"],[v,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86)/i],[v,m],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[m,v],[/\(bb(10);/i],[v,[m,F]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[v,[m,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[v,[m,J+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[v,[m,"webOS"]],[/crkey\/([\d\.]+)/i],[v,[m,V+"cast"]],[/(cros) [\w]+ ([\w\.]+\w)/i],[[m,"Chromium OS"],v],[/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[m,v],[/(sunos) ?([\w\.\d]*)/i],[[m,"Solaris"],v],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[m,v]]},x=function(P,L){if(typeof P===u&&(L=P,P=n),!(this instanceof x))return new x(P,L).getResult();var E=P||(typeof t!==d&&t.navigator&&t.navigator.userAgent?t.navigator.userAgent:s),_=L?ie(le,L):le;return this.getBrowser=function(){var w={};return w[m]=n,w[v]=n,se.call(w,E,_.browser),w.major=pe(w.version),w},this.getCPU=function(){var w={};return w[T]=n,se.call(w,E,_.cpu),w},this.getDevice=function(){var w={};return w[S]=n,w[p]=n,w[g]=n,se.call(w,E,_.device),w},this.getEngine=function(){var w={};return w[m]=n,w[v]=n,se.call(w,E,_.engine),w},this.getOS=function(){var w={};return w[m]=n,w[v]=n,se.call(w,E,_.os),w},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return E},this.setUA=function(w){return E=typeof w===l&&w.length>A?ce(w,A):w,this},this.setUA(E),this};x.VERSION=a,x.BROWSER=G([m,v,f]),x.CPU=G([T]),x.DEVICE=G([p,S,g,k,b,N,y,D,B]),x.ENGINE=x.OS=G([m,v]),e.exports&&(i=e.exports=x),i.UAParser=x;var re=typeof t!==d&&(t.jQuery||t.Zepto);if(re&&!re.ua){var fe=new x;re.ua=fe.getResult(),re.ua.get=function(){return fe.getUA()},re.ua.set=function(P){fe.setUA(P);var L=fe.getResult();for(var E in L)re.ua[E]=L[E]}}})(typeof window=="object"?window:commonjsGlobal)})(uaParser,uaParser.exports);const UAParser=uaParser.exports,version$1="1.6.5",version=version$1,protocolVersion=8;function mergeDefaultOptions(e,i,t){const n={...e};return n.audio===!0&&(n.audio={}),n.video===!0&&(n.video={}),n.audio&&mergeObjectWithoutOverwriting(n.audio,i),n.video&&mergeObjectWithoutOverwriting(n.video,t),n}function mergeObjectWithoutOverwriting(e,i){return Object.keys(i).forEach(t=>{e[t]===void 0&&(e[t]=i[t])}),e}function constraintsForOptions(e){const i={};if(e.video)if(typeof e.video=="object"){const t={},n=t,a=e.video;Object.keys(a).forEach(s=>{switch(s){case"resolution":mergeObjectWithoutOverwriting(n,a.resolution);break;default:n[s]=a[s]}}),i.video=t}else i.video=e.video;else i.video=!1;return e.audio?typeof e.audio=="object"?i.audio=e.audio:i.audio=!0:i.audio=!1,i}async function detectSilence(e,i=200){const t=getNewAudioContext();if(t){const n=t.createAnalyser();n.fftSize=2048;const a=n.frequencyBinCount,s=new Uint8Array(a);t.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(n),await sleep(i),n.getByteTimeDomainData(s);const c=s.some(d=>d!==128&&d!==0);return t.close(),!c}return!1}function getNewAudioContext(){const e=window.AudioContext||window.webkitAudioContext;if(e)return new e({latencyHint:"interactive"})}const separator="|";function unpackStreamId(e){const i=e.split(separator);return i.length>1?[i[0],e.substr(i[0].length+1)]:[e,""]}async function sleep(e){return new Promise(i=>setTimeout(i,e))}function supportsTransceiver(){return"addTransceiver"in RTCPeerConnection.prototype}function supportsAddTrack(){return"addTrack"in RTCPeerConnection.prototype}function supportsAV1(){const e=RTCRtpReceiver.getCapabilities("video");let i=!1,t=!1;if(e){for(const n of e.codecs)if(n.mimeType==="video/AV1"){i=!0;break}for(const n of e.headerExtensions)if(n.uri==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension"){t=!0;break}}return i&&t}function supportsSetSinkId(e){return document?(e||(e=document.createElement("audio")),"setSinkId"in e):!1}const setCodecPreferencesVersions={Chrome:"100",Chromium:"100",Safari:"15",Firefox:"100",Edge:"100",Brave:"1.40"};function supportsSetCodecPreferences(e){if(!isWeb()||!("setCodecPreferences"in e))return!1;const i=UAParser();if(!i.browser.name||!i.browser.version)return!1;const t=setCodecPreferencesVersions[i.browser.name];return t?compareVersions(i.browser.version,t)>=0:!1}function isFireFox(){return isWeb()?navigator.userAgent.indexOf("Firefox")!==-1:!1}function isSafari(){return isWeb()?/^((?!chrome|android).)*safari/i.test(navigator.userAgent):!1}function isMobile(){return isWeb()?/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function isWeb(){return typeof document<"u"}function compareVersions(e,i){const t=e.split("."),n=i.split("."),a=Math.min(e.length,i.length);for(let s=0;s<a;++s){const o=parseInt(t[s],10),c=parseInt(n[s],10);if(o>c)return 1;if(o<c)return-1}return t.length==n.length?0:t.length<n.length?-1:1}function roDispatchCallback(e){for(const i of e)i.target.handleResize(i)}function ioDispatchCallback(e){for(const i of e)i.target.handleVisibilityChanged(i)}let resizeObserver=null;const getResizeObserver=()=>(resizeObserver||(resizeObserver=new ResizeObserver(roDispatchCallback)),resizeObserver);let intersectionObserver=null;const getIntersectionObserver=()=>(intersectionObserver||(intersectionObserver=new IntersectionObserver(ioDispatchCallback,{root:document,rootMargin:"0px"})),intersectionObserver);function getClientInfo(){return ClientInfo.fromPartial({sdk:ClientInfo_SDK.JS,protocol:protocolVersion,version})}let emptyVideoStreamTrack;function getEmptyVideoStreamTrack(){return emptyVideoStreamTrack||(emptyVideoStreamTrack=createDummyVideoStreamTrack()),emptyVideoStreamTrack}function createDummyVideoStreamTrack(e=16,i=16,t=!1,n=!1){const a=document.createElement("canvas");a.width=e,a.height=i;const s=a.getContext("2d");s==null||s.fillRect(0,0,a.width,a.height),n&&s&&(s.beginPath(),s.arc(e/2,i/2,50,0,Math.PI*2,!0),s.closePath(),s.fillStyle="grey",s.fill());const o=a.captureStream(),[c]=o.getTracks();if(!c)throw Error("Could not get empty media stream video track");return c.enabled=t,c}let emptyAudioStreamTrack;function getEmptyAudioStreamTrack(){if(!emptyAudioStreamTrack){const e=new AudioContext,i=e.createOscillator(),t=e.createMediaStreamDestination();if(i.connect(t),i.start(),[emptyAudioStreamTrack]=t.stream.getAudioTracks(),!emptyAudioStreamTrack)throw Error("Could not get empty media stream audio track");emptyAudioStreamTrack.enabled=!1}return emptyAudioStreamTrack}class Future{constructor(i,t){h(this,"promise");h(this,"resolve");h(this,"reject");h(this,"onFinally");this.onFinally=t,this.promise=new Promise(async(n,a)=>{this.resolve=n,this.reject=a,i&&await i(n,a)}).finally(()=>{var n;return(n=this.onFinally)==null?void 0:n.call(this)})}}function createAudioAnalyser(e,i){const t={cloneTrack:!1,fftSize:2048,smoothingTimeConstant:.8,minDecibels:-100,maxDecibels:-80,...i},n=getNewAudioContext();if(!n)throw new Error("Audio Context not supported on this browser");const a=t.cloneTrack?e.mediaStreamTrack.clone():e.mediaStreamTrack,s=n.createMediaStreamSource(new MediaStream([a])),o=n.createAnalyser();o.minDecibels=t.minDecibels,o.maxDecibels=t.maxDecibels,o.fftSize=t.fftSize,o.smoothingTimeConstant=t.smoothingTimeConstant,s.connect(o);const c=new Uint8Array(o.frequencyBinCount);return{calculateVolume:()=>{o.getByteFrequencyData(c);let l=0;for(const p of c)l+=Math.pow(p/255,2);return Math.sqrt(l/c.length)},analyser:o,cleanup:()=>{n.close(),t.cloneTrack&&a.stop()}}}class Mutex{constructor(){h(this,"_locking");h(this,"_locks");this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let i;const t=new Promise(a=>i=()=>{this._locks-=1,a()}),n=this._locking.then(()=>i);return this._locking=this._locking.then(()=>t),n}}class Queue{constructor(i,t){this.maxConcurrent=i||1,this.minCycle=t||0,this.queueRunning=[],this.queueWaiting={},this.lastRun=0}dequeue(i){const t=this.queueRunning,n=t.findIndex(s=>s.hash===i);if(n==-1)throw"queue desync";const a=t[n];return t.splice(n,1),a}getFirstWaiting(){for(let i of Object.keys(this.queueWaiting).sort((t,n)=>t-n))if(this.queueWaiting[i]!==void 0&&this.queueWaiting[i].length>0)return this.queueWaiting[i]}end(i){this.dequeue(i).resolve();const n=this.getFirstWaiting();n!==void 0&&n.shift().resolve()}async wait(i,t){const n=t===void 0?0:t;let a={hash:i,priority:n};for(this.queueWaiting[n]==null&&(this.queueWaiting[n]=[]),this.queueRunning.length>=this.maxConcurrent&&(a.promise=new Promise(s=>{a.resolve=s}),this.queueWaiting[n].push(a),await a.promise),this.queueRunning.push(a),a.promise=new Promise(s=>{a.resolve=s});Date.now()-this.lastRun<this.minCycle;)await new Promise(s=>setTimeout(s,this.minCycle-Date.now()+this.lastRun));this.lastRun=Date.now()}run(i,t){const n=t===void 0?0:t,a=Symbol();return this.wait(a,n).then(()=>i()).finally(()=>{this.end(a)})}stat(){return{running:this.queueRunning.length,waiting:Object.keys(this.queueWaiting).reduce((i,t)=>i+=this.queueWaiting[t].length,0),last:this.lastRun}}async flush(){for(;this.stat().waiting>0;)for(let i of Object.keys(this.queueWaiting).sort((t,n)=>n-t)){const t=this.queueWaiting[i];t!==void 0&&t.length>0&&await t[t.length-1].promise}for(;this.queueRunning.length>0;)await Promise.allSettled(this.queueRunning.map(i=>i.promise))}}const defaultId="default",me=class{static getInstance(){return this.instance===void 0&&(this.instance=new me),this.instance}async getDevices(i,t=!0){var a;if(((a=me.userMediaPromiseMap)==null?void 0:a.size)>0){livekitLogger.debug("awaiting getUserMedia promise");try{i?await me.userMediaPromiseMap.get(i):await Promise.all(me.userMediaPromiseMap.values())}catch{livekitLogger.warn("error waiting for media permissons")}}let n=await navigator.mediaDevices.enumerateDevices();if(t&&i&&(!me.userMediaPromiseMap.get(i)||!isSafari())&&(n.length===0||n.some(o=>{const c=o.label==="",d=i?o.kind===i:!0;return c&&d}))){const o={video:i!=="audioinput"&&i!=="audiooutput",audio:i!=="videoinput"},c=await navigator.mediaDevices.getUserMedia(o);n=await navigator.mediaDevices.enumerateDevices(),c.getTracks().forEach(d=>{d.stop()})}return i&&(n=n.filter(s=>s.kind===i)),n}async normalizeDeviceId(i,t,n){if(t!==defaultId)return t;const s=(await this.getDevices(i)).find(o=>o.groupId===n&&o.deviceId!==defaultId);return s==null?void 0:s.deviceId}};let DeviceManager=me;h(DeviceManager,"instance"),h(DeviceManager,"mediaDeviceKinds",["audioinput","audiooutput","videoinput"]),h(DeviceManager,"userMediaPromiseMap",new Map);var events={exports:{}},R=typeof Reflect=="object"?Reflect:null,ReflectApply=R&&typeof R.apply=="function"?R.apply:function e(i,t,n){return Function.prototype.apply.call(i,t,n)},ReflectOwnKeys;R&&typeof R.ownKeys=="function"?ReflectOwnKeys=R.ownKeys:Object.getOwnPropertySymbols?ReflectOwnKeys=function(i){return Object.getOwnPropertyNames(i).concat(Object.getOwnPropertySymbols(i))}:ReflectOwnKeys=function(i){return Object.getOwnPropertyNames(i)};function ProcessEmitWarning(e){console&&console.warn&&console.warn(e)}var NumberIsNaN=Number.isNaN||function e(i){return i!==i};function EventEmitter(){EventEmitter.init.call(this)}events.exports=EventEmitter;events.exports.once=once;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=void 0;EventEmitter.prototype._eventsCount=0;EventEmitter.prototype._maxListeners=void 0;var defaultMaxListeners=10;function checkListener(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(e){if(typeof e!="number"||e<0||NumberIsNaN(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");defaultMaxListeners=e}});EventEmitter.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};EventEmitter.prototype.setMaxListeners=function e(i){if(typeof i!="number"||i<0||NumberIsNaN(i))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+i+".");return this._maxListeners=i,this};function _getMaxListeners(e){return e._maxListeners===void 0?EventEmitter.defaultMaxListeners:e._maxListeners}EventEmitter.prototype.getMaxListeners=function e(){return _getMaxListeners(this)};EventEmitter.prototype.emit=function e(i){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var a=i==="error",s=this._events;if(s!==void 0)a=a&&s.error===void 0;else if(!a)return!1;if(a){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var c=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw c.context=o,c}var d=s[i];if(d===void 0)return!1;if(typeof d=="function")ReflectApply(d,this,t);else for(var u=d.length,l=arrayClone(d,u),n=0;n<u;++n)ReflectApply(l[n],this,t);return!0};function _addListener(e,i,t,n){var a,s,o;if(checkListener(t),s=e._events,s===void 0?(s=e._events=Object.create(null),e._eventsCount=0):(s.newListener!==void 0&&(e.emit("newListener",i,t.listener?t.listener:t),s=e._events),o=s[i]),o===void 0)o=s[i]=t,++e._eventsCount;else if(typeof o=="function"?o=s[i]=n?[t,o]:[o,t]:n?o.unshift(t):o.push(t),a=_getMaxListeners(e),a>0&&o.length>a&&!o.warned){o.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(i)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=i,c.count=o.length,ProcessEmitWarning(c)}return e}EventEmitter.prototype.addListener=function e(i,t){return _addListener(this,i,t,!1)};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.prependListener=function e(i,t){return _addListener(this,i,t,!0)};function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap(e,i,t){var n={fired:!1,wrapFn:void 0,target:e,type:i,listener:t},a=onceWrapper.bind(n);return a.listener=t,n.wrapFn=a,a}EventEmitter.prototype.once=function e(i,t){return checkListener(t),this.on(i,_onceWrap(this,i,t)),this};EventEmitter.prototype.prependOnceListener=function e(i,t){return checkListener(t),this.prependListener(i,_onceWrap(this,i,t)),this};EventEmitter.prototype.removeListener=function e(i,t){var n,a,s,o,c;if(checkListener(t),a=this._events,a===void 0)return this;if(n=a[i],n===void 0)return this;if(n===t||n.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete a[i],a.removeListener&&this.emit("removeListener",i,n.listener||t));else if(typeof n!="function"){for(s=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){c=n[o].listener,s=o;break}if(s<0)return this;s===0?n.shift():spliceOne(n,s),n.length===1&&(a[i]=n[0]),a.removeListener!==void 0&&this.emit("removeListener",i,c||t)}return this};EventEmitter.prototype.off=EventEmitter.prototype.removeListener;EventEmitter.prototype.removeAllListeners=function e(i){var t,n,a;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[i]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[i]),this;if(arguments.length===0){var s=Object.keys(n),o;for(a=0;a<s.length;++a)o=s[a],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[i],typeof t=="function")this.removeListener(i,t);else if(t!==void 0)for(a=t.length-1;a>=0;a--)this.removeListener(i,t[a]);return this};function _listeners(e,i,t){var n=e._events;if(n===void 0)return[];var a=n[i];return a===void 0?[]:typeof a=="function"?t?[a.listener||a]:[a]:t?unwrapListeners(a):arrayClone(a,a.length)}EventEmitter.prototype.listeners=function e(i){return _listeners(this,i,!0)};EventEmitter.prototype.rawListeners=function e(i){return _listeners(this,i,!1)};EventEmitter.listenerCount=function(e,i){return typeof e.listenerCount=="function"?e.listenerCount(i):listenerCount.call(e,i)};EventEmitter.prototype.listenerCount=listenerCount;function listenerCount(e){var i=this._events;if(i!==void 0){var t=i[e];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}EventEmitter.prototype.eventNames=function e(){return this._eventsCount>0?ReflectOwnKeys(this._events):[]};function arrayClone(e,i){for(var t=new Array(i),n=0;n<i;++n)t[n]=e[n];return t}function spliceOne(e,i){for(;i+1<e.length;i++)e[i]=e[i+1];e.pop()}function unwrapListeners(e){for(var i=new Array(e.length),t=0;t<i.length;++t)i[t]=e[t].listener||e[t];return i}function once(e,i){return new Promise(function(t,n){function a(o){e.removeListener(i,s),n(o)}function s(){typeof e.removeListener=="function"&&e.removeListener("error",a),t([].slice.call(arguments))}eventTargetAgnosticAddListener(e,i,s,{once:!0}),i!=="error"&&addErrorHandlerIfEventEmitter(e,a,{once:!0})})}function addErrorHandlerIfEventEmitter(e,i,t){typeof e.on=="function"&&eventTargetAgnosticAddListener(e,"error",i,t)}function eventTargetAgnosticAddListener(e,i,t,n){if(typeof e.on=="function")n.once?e.once(i,t):e.on(i,t);else if(typeof e.addEventListener=="function")e.addEventListener(i,function a(s){n.once&&e.removeEventListener(i,a),t(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}const BACKGROUND_REACTION_DELAY=5e3,recycledElements=[];class Track extends events.exports.EventEmitter{constructor(t,n){super();h(this,"kind");h(this,"attachedElements",[]);h(this,"isMuted",!1);h(this,"source");h(this,"sid");h(this,"mediaStream");h(this,"streamState",Track.StreamState.Active);h(this,"_mediaStreamTrack");h(this,"_mediaStreamID");h(this,"isInBackground");h(this,"backgroundTimeout");h(this,"_currentBitrate",0);h(this,"monitorInterval");h(this,"appVisibilityChangedListener",()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),BACKGROUND_REACTION_DELAY):this.handleAppVisibilityChanged()});this.setMaxListeners(100),this.kind=n,this._mediaStreamTrack=t,this._mediaStreamID=t.id,this.source=Track.Source.Unknown,isWeb()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(t){let n="audio";this.kind===Track.Kind.Video&&(n="video"),t||(n==="audio"&&(recycledElements.forEach(s=>{s.parentElement===null&&!t&&(t=s)}),t&&recycledElements.splice(recycledElements.indexOf(t),1)),t||(t=document.createElement(n))),this.attachedElements.includes(t)||this.attachedElements.push(t),attachToElement(this._mediaStreamTrack,t);const a=t.srcObject.getTracks();return a.some(s=>s.kind==="audio")&&t.play().then(()=>{this.emit(TrackEvent.AudioPlaybackStarted)}).catch(s=>{this.emit(TrackEvent.AudioPlaybackFailed,s),t&&a.some(o=>o.kind==="video")&&s.name==="NotAllowedError"&&(t.muted=!0,t.play().catch(()=>{}))}),this.emit(TrackEvent.ElementAttached,t),t}detach(t){if(t){detachTrack(this._mediaStreamTrack,t);const a=this.attachedElements.indexOf(t);return a>=0&&(this.attachedElements.splice(a,1),this.recycleElement(t),this.emit(TrackEvent.ElementDetached,t)),t}const n=[];return this.attachedElements.forEach(a=>{detachTrack(this._mediaStreamTrack,a),n.push(a),this.recycleElement(a),this.emit(TrackEvent.ElementDetached,a)}),this.attachedElements=[],n}stop(){this.stopMonitor(),this._mediaStreamTrack.stop(),isWeb()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval)}recycleElement(t){if(t instanceof HTMLAudioElement){let n=!0;t.pause(),recycledElements.forEach(a=>{a.parentElement||(n=!1)}),n&&recycledElements.push(t)}}async handleAppVisibilityChanged(){this.isInBackground=document.visibilityState==="hidden"}}function attachToElement(e,i){let t;i.srcObject instanceof MediaStream?t=i.srcObject:t=new MediaStream;let n;e.kind==="audio"?n=t.getAudioTracks():n=t.getVideoTracks(),n.includes(e)||(n.forEach(a=>{t.removeTrack(a)}),t.addTrack(e)),i.autoplay=!0,i.muted=t.getAudioTracks().length===0,i instanceof HTMLVideoElement&&(i.playsInline=!0),i.srcObject!==t&&(i.srcObject=t,(isSafari()||isFireFox())&&i instanceof HTMLVideoElement&&setTimeout(()=>{i.srcObject=t,i.play().catch(()=>{})},0))}function detachTrack(e,i){if(i.srcObject instanceof MediaStream){const t=i.srcObject;t.removeTrack(e),t.getTracks().length>0?i.srcObject=t:i.srcObject=null}}(e=>{(o=>{o.Audio="audio",o.Video="video",o.Unknown="unknown"})(e.Kind||(e.Kind={})),(o=>{o.Camera="camera",o.Microphone="microphone",o.ScreenShare="screen_share",o.ScreenShareAudio="screen_share_audio",o.Unknown="unknown"})(e.Source||(e.Source={})),(o=>{o.Active="active",o.Paused="paused",o.Unknown="unknown"})(e.StreamState||(e.StreamState={}));function i(o){switch(o){case"audio":return TrackType.AUDIO;case"video":return TrackType.VIDEO;default:return TrackType.UNRECOGNIZED}}e.kindToProto=i;function t(o){switch(o){case TrackType.AUDIO:return"audio";case TrackType.VIDEO:return"video";default:return"unknown"}}e.kindFromProto=t;function n(o){switch(o){case"camera":return TrackSource.CAMERA;case"microphone":return TrackSource.MICROPHONE;case"screen_share":return TrackSource.SCREEN_SHARE;case"screen_share_audio":return TrackSource.SCREEN_SHARE_AUDIO;default:return TrackSource.UNRECOGNIZED}}e.sourceToProto=n;function a(o){switch(o){case TrackSource.CAMERA:return"camera";case TrackSource.MICROPHONE:return"microphone";case TrackSource.SCREEN_SHARE:return"screen_share";case TrackSource.SCREEN_SHARE_AUDIO:return"screen_share_audio";default:return"unknown"}}e.sourceFromProto=a;function s(o){switch(o){case StreamState.ACTIVE:return"active";case StreamState.PAUSED:return"paused";default:return"unknown"}}e.streamStateFromProto=s})(Track||(Track={}));const defaultDimensionsTimeout=2*1e3;class LocalTrack extends Track{constructor(t,n,a,s=!1){super(t,n);h(this,"sender");h(this,"codec");h(this,"constraints");h(this,"reacquireTrack");h(this,"providedByUser");h(this,"muteQueue");h(this,"_isUpstreamPaused",!1);h(this,"handleEnded",()=>{this.isInBackground&&(this.reacquireTrack=!0),this.emit(TrackEvent.Ended,this)});this._mediaStreamTrack.addEventListener("ended",this.handleEnded),this.constraints=a!=null?a:t.getConstraints(),this.reacquireTrack=!1,this.providedByUser=s,this.muteQueue=new Queue}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==Track.Kind.Video)return;const{width:t,height:n}=this._mediaStreamTrack.getSettings();if(t&&n)return{width:t,height:n}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}async waitForDimensions(t=defaultDimensionsTimeout){if(this.kind===Track.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");const n=Date.now();for(;Date.now()-n<t;){const a=this.dimensions;if(a)return a;await sleep(50)}throw new TrackInvalidError("unable to get track dimensions after timeout")}async getDeviceId(){if(this.source===Track.Source.ScreenShare)return;const{deviceId:t,groupId:n}=this._mediaStreamTrack.getSettings(),a=this.kind===Track.Kind.Audio?"audioinput":"videoinput";return DeviceManager.getInstance().normalizeDeviceId(a,t,n)}async mute(){return this.setTrackMuted(!0),this}async unmute(){return this.setTrackMuted(!1),this}async replaceTrack(t,n=!0){if(!this.sender)throw new TrackInvalidError("unable to replace an unpublished track");return this.attachedElements.forEach(a=>{detachTrack(this._mediaStreamTrack,a)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this.providedByUser||this._mediaStreamTrack.stop(),t.addEventListener("ended",this.handleEnded),livekitLogger.debug("replace MediaStreamTrack"),this.sender&&await this.sender.replaceTrack(t),this._mediaStreamTrack=t,this._mediaStreamTrack.enabled=!this.isMuted,await this.resumeUpstream(),this.attachedElements.forEach(a=>{attachToElement(t,a)}),this.mediaStream=new MediaStream([t]),this.providedByUser=n,this}async restart(t){t||(t=this.constraints),livekitLogger.debug("restarting track with constraints",t);const n={audio:!1,video:!1};this.kind===Track.Kind.Video?n.video=t:n.audio=t,this.attachedElements.forEach(o=>{detachTrack(this._mediaStreamTrack,o)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const a=await navigator.mediaDevices.getUserMedia(n),s=a.getTracks()[0];return s.addEventListener("ended",this.handleEnded),livekitLogger.debug("re-acquired MediaStreamTrack"),this.sender&&await this.sender.replaceTrack(s),this._mediaStreamTrack=s,await this.resumeUpstream(),this.attachedElements.forEach(o=>{attachToElement(s,o)}),this.mediaStream=a,this.constraints=t,this.emit(TrackEvent.Restarted,this),this}setTrackMuted(t){livekitLogger.debug(`setting ${this.kind} track ${t?"muted":"unmuted"}`),!(this.isMuted===t&&this._mediaStreamTrack.enabled!==t)&&(this.isMuted=t,this._mediaStreamTrack.enabled=!t,this.emit(t?TrackEvent.Muted:TrackEvent.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}async handleAppVisibilityChanged(){await super.handleAppVisibilityChanged(),isMobile()&&(livekitLogger.debug(`visibility changed, is in Background: ${this.isInBackground}`),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(livekitLogger.debug(`track needs to be reaquired, restarting ${this.source}`),await this.restart(),this.reacquireTrack=!1))}async pauseUpstream(){this.muteQueue.run(async()=>{if(this._isUpstreamPaused===!0)return;if(!this.sender){livekitLogger.warn("unable to pause upstream for an unpublished track");return}this._isUpstreamPaused=!0,this.emit(TrackEvent.UpstreamPaused,this);const t=this.kind===Track.Kind.Audio?getEmptyAudioStreamTrack():getEmptyVideoStreamTrack();await this.sender.replaceTrack(t)})}async resumeUpstream(){this.muteQueue.run(async()=>{if(this._isUpstreamPaused!==!1){if(!this.sender){livekitLogger.warn("unable to resume upstream for an unpublished track");return}this._isUpstreamPaused=!1,this.emit(TrackEvent.UpstreamResumed,this),await this.sender.replaceTrack(this._mediaStreamTrack)}})}}class LocalAudioTrack extends LocalTrack{constructor(t,n,a=!0){super(t,Track.Kind.Audio,n,a);h(this,"stopOnMute",!1);h(this,"prevStats");h(this,"monitorSender",async()=>{if(!this.sender){this._currentBitrate=0;return}let t;try{t=await this.getSenderStats()}catch(n){livekitLogger.error("could not get audio sender stats",{error:n});return}t&&this.prevStats&&(this._currentBitrate=computeBitrate(t,this.prevStats)),this.prevStats=t});this.checkForSilence()}async setDeviceId(t){this.constraints.deviceId!==t&&(this.constraints.deviceId=t,this.isMuted||await this.restartTrack())}async mute(){return await this.muteQueue.run(async()=>{this.source===Track.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(livekitLogger.debug("stopping mic track"),this._mediaStreamTrack.stop()),await super.mute()}),this}async unmute(){return await this.muteQueue.run(async()=>{this.source===Track.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended")&&!this.isUserProvided&&(livekitLogger.debug("reacquiring mic track"),await this.restartTrack()),await super.unmute()}),this}async restartTrack(t){let n;if(t){const a=constraintsForOptions({audio:t});typeof a.audio!="boolean"&&(n=a.audio)}await this.restart(n)}async restart(t){const n=await super.restart(t);return this.checkForSilence(),n}startMonitor(){!isWeb()||this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},monitorFrequency))}async getSenderStats(){var a;if(!((a=this.sender)!=null&&a.getStats))return;const t=await this.sender.getStats();let n;return t.forEach(s=>{s.type==="outbound-rtp"&&(n={type:"audio",streamId:s.id,packetsSent:s.packetsSent,packetsLost:s.packetsLost,bytesSent:s.bytesSent,timestamp:s.timestamp,roundTripTime:s.roundTripTime,jitter:s.jitter})}),n}async checkForSilence(){await detectSilence(this)&&(this.isMuted||livekitLogger.warn("silence detected on local audio track"),this.emit(TrackEvent.AudioSilenceDetected))}}const refreshSubscribedCodecAfterNewCodec=5e3;class LocalVideoTrack extends LocalTrack{constructor(t,n,a=!0){super(t,Track.Kind.Video,n,a);h(this,"signalClient");h(this,"prevStats");h(this,"encodings");h(this,"simulcastCodecs",new Map);h(this,"subscribedCodecs");h(this,"monitorSender",async()=>{if(!this.sender){this._currentBitrate=0;return}let t;try{t=await this.getSenderStats()}catch(a){livekitLogger.error("could not get audio sender stats",{error:a});return}const n=new Map(t.map(a=>[a.rid,a]));if(this.prevStats){let a=0;n.forEach((s,o)=>{var d;const c=(d=this.prevStats)==null?void 0:d.get(o);a+=computeBitrate(s,c)}),this._currentBitrate=a}this.prevStats=n})}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(t){var a;if(this.signalClient=t,!isWeb())return;const n=(a=this.sender)==null?void 0:a.getParameters();n&&(this.encodings=n.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},monitorFrequency))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(t=>{t.mediaStreamTrack.stop()}),super.stop()}async mute(){return await this.muteQueue.run(async()=>{this.source===Track.Source.Camera&&!this.isUserProvided&&(livekitLogger.debug("stopping camera track"),this._mediaStreamTrack.stop()),await super.mute()}),this}async unmute(){return await this.muteQueue.run(async()=>{this.source===Track.Source.Camera&&!this.isUserProvided&&(livekitLogger.debug("reacquiring camera track"),await this.restartTrack()),await super.unmute()}),this}async getSenderStats(){var a;if(!((a=this.sender)!=null&&a.getStats))return[];const t=[],n=await this.sender.getStats();return n.forEach(s=>{var o;if(s.type==="outbound-rtp"){const c={type:"video",streamId:s.id,frameHeight:s.frameHeight,frameWidth:s.frameWidth,firCount:s.firCount,pliCount:s.pliCount,nackCount:s.nackCount,packetsSent:s.packetsSent,bytesSent:s.bytesSent,framesSent:s.framesSent,timestamp:s.timestamp,rid:(o=s.rid)!=null?o:s.id,retransmittedPacketsSent:s.retransmittedPacketsSent,qualityLimitationReason:s.qualityLimitationReason,qualityLimitationResolutionChanges:s.qualityLimitationResolutionChanges},d=n.get(s.remoteId);d&&(c.jitter=d.jitter,c.packetsLost=d.packetsLost,c.roundTripTime=d.roundTripTime),t.push(c)}}),t}setPublishingQuality(t){const n=[];for(let a=VideoQuality.LOW;a<=VideoQuality.HIGH;a+=1)n.push({quality:a,enabled:a<=t});livekitLogger.debug(`setting publishing quality. max quality ${t}`),this.setPublishingLayers(n)}async setDeviceId(t){this.constraints.deviceId!==t&&(this.constraints.deviceId=t,this.isMuted||await this.restartTrack())}async restartTrack(t){let n;if(t){const a=constraintsForOptions({video:t});typeof a.video!="boolean"&&(n=a.video)}await this.restart(n)}addSimulcastTrack(t,n){if(this.simulcastCodecs.has(t))throw new Error(`${t} already added`);const a={codec:t,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:n};return this.simulcastCodecs.set(t,a),a}setSimulcastTrackSender(t,n){const a=this.simulcastCodecs.get(t);!a||(a.sender=n,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},refreshSubscribedCodecAfterNewCodec))}async setPublishingCodecs(t){if(livekitLogger.debug("setting publishing codecs",{codecs:t,currentCodec:this.codec}),!this.codec&&t.length>0)return await this.setPublishingLayers(t[0].qualities),[];this.subscribedCodecs=t;const n=[];for await(const a of t)if(!this.codec||this.codec===a.codec)await this.setPublishingLayers(a.qualities);else{const s=this.simulcastCodecs.get(a.codec);if(livekitLogger.debug(`try setPublishingCodec for ${a.codec}`,s),!s||!s.sender){for(const o of a.qualities)if(o.enabled){n.push(a.codec);break}}else s.encodings&&(livekitLogger.debug(`try setPublishingLayersForSender ${a.codec}`),await setPublishingLayersForSender(s.sender,s.encodings,a.qualities))}return n}async setPublishingLayers(t){livekitLogger.debug("setting publishing layers",t),!(!this.sender||!this.encodings)&&await setPublishingLayersForSender(this.sender,this.encodings,t)}async handleAppVisibilityChanged(){await super.handleAppVisibilityChanged(),!!isMobile()&&this.isInBackground&&this.source===Track.Source.Camera&&(this._mediaStreamTrack.enabled=!1)}}async function setPublishingLayersForSender(e,i,t){livekitLogger.debug("setPublishingLayersForSender",{sender:e,qualities:t,senderEncodings:i});const n=e.getParameters(),{encodings:a}=n;if(!a)return;if(a.length!==i.length){livekitLogger.warn("cannot set publishing layers, encodings mismatch");return}let s=!1;a.forEach((o,c)=>{var f;let d=(f=o.rid)!=null?f:"";d===""&&(d="q");const u=videoQualityForRid(d),l=t.find(p=>p.quality===u);!l||o.active!==l.enabled&&(s=!0,o.active=l.enabled,livekitLogger.debug(`setting layer ${l.quality} to ${o.active?"enabled":"disabled"}`),isFireFox()&&(l.enabled?(o.scaleResolutionDownBy=i[c].scaleResolutionDownBy,o.maxBitrate=i[c].maxBitrate,o.maxFrameRate=i[c].maxFrameRate):(o.scaleResolutionDownBy=4,o.maxBitrate=10,o.maxFrameRate=2)))}),s&&(n.encodings=a,await e.setParameters(n))}function videoQualityForRid(e){switch(e){case"f":return VideoQuality.HIGH;case"h":return VideoQuality.MEDIUM;case"q":return VideoQuality.LOW;default:return VideoQuality.UNRECOGNIZED}}function videoLayersFromEncodings(e,i,t){return t?t.map(n=>{var o,c,d;const a=(o=n.scaleResolutionDownBy)!=null?o:1;let s=videoQualityForRid((c=n.rid)!=null?c:"");return s===VideoQuality.UNRECOGNIZED&&t.length===1&&(s=VideoQuality.HIGH),{quality:s,width:e/a,height:i/a,bitrate:(d=n.maxBitrate)!=null?d:0,ssrc:0}}):[{quality:VideoQuality.HIGH,width:e,height:i,bitrate:0,ssrc:0}]}class RemoteTrack extends Track{constructor(t,n,a,s){super(t,a);h(this,"receiver");this.sid=n,this.receiver=s}setMuted(t){this.isMuted!==t&&(this.isMuted=t,this._mediaStreamTrack.enabled=!t,this.emit(t?TrackEvent.Muted:TrackEvent.Unmuted,this))}setMediaStream(t){this.mediaStream=t,t.onremovetrack=()=>{this.receiver=void 0,this._currentBitrate=0,this.emit(TrackEvent.Ended,this)}}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),monitorFrequency))}}class RemoteAudioTrack extends RemoteTrack{constructor(t,n,a,s,o){super(t,n,Track.Kind.Audio,a);h(this,"prevStats");h(this,"elementVolume");h(this,"audioContext");h(this,"gainNode");h(this,"sourceNode");h(this,"webAudioPluginNodes");h(this,"sinkId");h(this,"monitorReceiver",async()=>{if(!this.receiver){this._currentBitrate=0;return}const t=await this.getReceiverStats();t&&this.prevStats&&this.receiver&&(this._currentBitrate=computeBitrate(t,this.prevStats)),this.prevStats=t});this.audioContext=s,this.webAudioPluginNodes=[],o&&(this.sinkId=o.deviceId)}setVolume(t){var n;for(const a of this.attachedElements)this.audioContext?(n=this.gainNode)==null||n.gain.setTargetAtTime(t,0,.1):a.volume=t;this.elementVolume=t}getVolume(){if(this.elementVolume)return this.elementVolume;let t=0;return this.attachedElements.forEach(n=>{n.volume>t&&(t=n.volume)}),t}async setSinkId(t){this.sinkId=t,await Promise.all(this.attachedElements.map(n=>{if(!!supportsSetSinkId(n))return n.setSinkId(t)}))}attach(t){const n=this.attachedElements.length===0;return t?super.attach(t):t=super.attach(),this.elementVolume&&(t.volume=this.elementVolume),this.sinkId&&supportsSetSinkId(t)&&t.setSinkId(this.sinkId),this.audioContext&&n&&(livekitLogger.debug("using audio context mapping"),this.connectWebAudio(this.audioContext,t),t.volume=0,t.muted=!0),t}detach(t){let n;return t?(n=super.detach(t),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(n=super.detach(),this.disconnectWebAudio()),n}setAudioContext(t){this.audioContext=t,t&&this.attachedElements.length>0?this.connectWebAudio(t,this.attachedElements[0]):t||this.disconnectWebAudio()}setWebAudioPlugins(t){this.webAudioPluginNodes=t,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(t,n){this.disconnectWebAudio(),this.sourceNode=t.createMediaStreamSource(n.srcObject);let a=this.sourceNode;this.webAudioPluginNodes.forEach(s=>{a.connect(s),a=s}),this.gainNode=t.createGain(),a.connect(this.gainNode),this.gainNode.connect(t.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),t.state!=="running"&&t.resume().then(()=>{t.state!=="running"&&this.emit(TrackEvent.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(s=>{this.emit(TrackEvent.AudioPlaybackFailed,s)})}disconnectWebAudio(){var t,n;(t=this.gainNode)==null||t.disconnect(),(n=this.sourceNode)==null||n.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}async getReceiverStats(){if(!this.receiver||!this.receiver.getStats)return;const t=await this.receiver.getStats();let n;return t.forEach(a=>{a.type==="inbound-rtp"&&(n={type:"audio",timestamp:a.timestamp,jitter:a.jitter,bytesReceived:a.bytesReceived,concealedSamples:a.concealedSamples,concealmentEvents:a.concealmentEvents,silentConcealedSamples:a.silentConcealedSamples,silentConcealmentEvents:a.silentConcealmentEvents,totalAudioEnergy:a.totalAudioEnergy,totalSamplesDuration:a.totalSamplesDuration})}),n}}function r(e,i,t){var n,a,s;i===void 0&&(i=50),t===void 0&&(t={});var o=(n=t.isImmediate)!=null&&n,c=(a=t.callback)!=null&&a,d=t.maxWait,u=Date.now(),l=[];function f(){if(d!==void 0){var m=Date.now()-u;if(m+i>=d)return d-m}return i}var p=function(){var m=[].slice.call(arguments),g=this;return new Promise(function(S,v){var T=o&&s===void 0;if(s!==void 0&&clearTimeout(s),s=setTimeout(function(){if(s=void 0,u=Date.now(),!o){var b=e.apply(g,m);c&&c(b),l.forEach(function(y){return(0,y.resolve)(b)}),l=[]}},f()),T){var k=e.apply(g,m);return c&&c(k),S(k)}l.push({resolve:S,reject:v})})};return p.cancel=function(m){s!==void 0&&clearTimeout(s),l.forEach(function(g){return(0,g.reject)(m)}),l=[]},p}class CriticalTimers{}h(CriticalTimers,"setTimeout",(...i)=>setTimeout(...i)),h(CriticalTimers,"setInterval",(...i)=>setInterval(...i)),h(CriticalTimers,"clearTimeout",(...i)=>clearTimeout(...i)),h(CriticalTimers,"clearInterval",(...i)=>clearInterval(...i));const REACTION_DELAY=100;class RemoteVideoTrack extends RemoteTrack{constructor(t,n,a,s){super(t,n,Track.Kind.Video,a);h(this,"prevStats");h(this,"elementInfos",[]);h(this,"adaptiveStreamSettings");h(this,"lastVisible");h(this,"lastDimensions");h(this,"hasUsedAttach",!1);h(this,"monitorReceiver",async()=>{if(!this.receiver){this._currentBitrate=0;return}const t=await this.getReceiverStats();t&&this.prevStats&&this.receiver&&(this._currentBitrate=computeBitrate(t,this.prevStats)),this.prevStats=t});h(this,"debouncedHandleResize",r(()=>{this.updateDimensions()},REACTION_DELAY));this.adaptiveStreamSettings=s,this.isAdaptiveStream&&(this.streamState=Track.StreamState.Paused)}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}get mediaStreamTrack(){return this.isAdaptiveStream&&!this.hasUsedAttach&&livekitLogger.warn("When using adaptiveStream, you need to use remoteVideoTrack.attach() to add the track to a HTMLVideoElement, otherwise your video tracks might never start"),this._mediaStreamTrack}setMuted(t){super.setMuted(t),this.attachedElements.forEach(n=>{t?detachTrack(this._mediaStreamTrack,n):attachToElement(this._mediaStreamTrack,n)})}attach(t){if(t?super.attach(t):t=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(n=>n.element===t)===void 0){const n=new HTMLElementInfo(t);this.observeElementInfo(n)}return this.hasUsedAttach=!0,t}observeElementInfo(t){this.adaptiveStreamSettings&&this.elementInfos.find(n=>n===t)===void 0?(t.handleResize=()=>{this.debouncedHandleResize()},t.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(t),t.observe(),this.debouncedHandleResize(),this.updateVisibility()):livekitLogger.warn("visibility resize observer not triggered")}stopObservingElementInfo(t){if(!this.isAdaptiveStream){livekitLogger.warn("stopObservingElementInfo ignored");return}const n=this.elementInfos.filter(a=>a===t);for(const a of n)a.stopObserving();this.elementInfos=this.elementInfos.filter(a=>a!==t),this.updateVisibility()}detach(t){let n=[];if(t)return this.stopObservingElement(t),super.detach(t);n=super.detach();for(const a of n)this.stopObservingElement(a);return n}getDecoderImplementation(){var t;return(t=this.prevStats)==null?void 0:t.decoderImplementation}async getReceiverStats(){if(!this.receiver||!this.receiver.getStats)return;const t=await this.receiver.getStats();let n;return t.forEach(a=>{a.type==="inbound-rtp"&&(n={type:"video",framesDecoded:a.framesDecoded,framesDropped:a.framesDropped,framesReceived:a.framesReceived,packetsReceived:a.packetsReceived,packetsLost:a.packetsLost,frameWidth:a.frameWidth,frameHeight:a.frameHeight,pliCount:a.pliCount,firCount:a.firCount,nackCount:a.nackCount,jitter:a.jitter,timestamp:a.timestamp,bytesReceived:a.bytesReceived,decoderImplementation:a.decoderImplementation})}),n}stopObservingElement(t){const n=this.elementInfos.filter(a=>a.element===t);for(const a of n)a.stopObserving();this.elementInfos=this.elementInfos.filter(a=>a.element!==t)}async handleAppVisibilityChanged(){await super.handleAppVisibilityChanged(),this.isAdaptiveStream&&this.updateVisibility()}updateVisibility(){var s,o;const t=this.elementInfos.reduce((c,d)=>Math.max(c,d.visibilityChangedAt||0),0),n=(o=(s=this.adaptiveStreamSettings)==null?void 0:s.pauseVideoInBackground)==null||o?this.isInBackground:!1,a=this.elementInfos.some(c=>c.visible)&&!n;if(this.lastVisible!==a){if(!a&&Date.now()-t<REACTION_DELAY){CriticalTimers.setTimeout(()=>{this.updateVisibility()},REACTION_DELAY);return}this.lastVisible=a,this.emit(TrackEvent.VisibilityChanged,a,this)}}updateDimensions(){var a,s,o,c;let t=0,n=0;for(const d of this.elementInfos){const u=(s=(a=this.adaptiveStreamSettings)==null?void 0:a.pixelDensity)!=null?s:1,l=u==="screen"?window.devicePixelRatio:u,f=d.width()*l,p=d.height()*l;f+p>t+n&&(t=f,n=p)}((o=this.lastDimensions)==null?void 0:o.width)===t&&((c=this.lastDimensions)==null?void 0:c.height)===n||(this.lastDimensions={width:t,height:n},this.emit(TrackEvent.VideoDimensionsChanged,this.lastDimensions,this))}}class HTMLElementInfo{constructor(i,t){h(this,"element");h(this,"visible");h(this,"visibilityChangedAt");h(this,"handleResize");h(this,"handleVisibilityChanged");h(this,"onVisibilityChanged",i=>{var a;const{target:t,isIntersecting:n}=i;t===this.element&&(this.visible=n,this.visibilityChangedAt=Date.now(),(a=this.handleVisibilityChanged)==null||a.call(this))});this.element=i,this.visible=t!=null?t:isElementInViewport(i),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){this.element.handleResize=()=>{var i;(i=this.handleResize)==null||i.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,getIntersectionObserver().observe(this.element),getResizeObserver().observe(this.element)}stopObserving(){var i,t;(i=getIntersectionObserver())==null||i.unobserve(this.element),(t=getResizeObserver())==null||t.unobserve(this.element)}}function isElementInViewport(e){let i=e.offsetTop,t=e.offsetLeft;const n=e.offsetWidth,a=e.offsetHeight,{hidden:s}=e,{opacity:o,display:c}=getComputedStyle(e);for(;e.offsetParent;)e=e.offsetParent,i+=e.offsetTop,t+=e.offsetLeft;return i<window.pageYOffset+window.innerHeight&&t<window.pageXOffset+window.innerWidth&&i+a>window.pageYOffset&&t+n>window.pageXOffset&&!s&&(o!==""?parseFloat(o)>0:!0)&&c!=="none"}class TrackPublication extends events.exports.EventEmitter{constructor(t,n,a){super();h(this,"kind");h(this,"trackName");h(this,"trackSid");h(this,"track");h(this,"source");h(this,"mimeType");h(this,"dimensions");h(this,"simulcasted");h(this,"trackInfo");h(this,"metadataMuted",!1);h(this,"handleMuted",()=>{this.emit(TrackEvent.Muted)});h(this,"handleUnmuted",()=>{this.emit(TrackEvent.Unmuted)});this.setMaxListeners(100),this.kind=t,this.trackSid=n,this.trackName=a,this.source=Track.Source.Unknown}setTrack(t){this.track&&(this.track.off(TrackEvent.Muted,this.handleMuted),this.track.off(TrackEvent.Unmuted,this.handleUnmuted)),this.track=t,t&&(t.on(TrackEvent.Muted,this.handleMuted),t.on(TrackEvent.Unmuted,this.handleUnmuted))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get audioTrack(){if(this.track instanceof LocalAudioTrack||this.track instanceof RemoteAudioTrack)return this.track}get videoTrack(){if(this.track instanceof LocalVideoTrack||this.track instanceof RemoteVideoTrack)return this.track}updateInfo(t){this.trackSid=t.sid,this.trackName=t.name,this.source=Track.sourceFromProto(t.source),this.mimeType=t.mimeType,this.kind===Track.Kind.Video&&t.width>0&&(this.dimensions={width:t.width,height:t.height},this.simulcasted=t.simulcast),this.trackInfo=t,livekitLogger.trace("update publication info",{info:t})}}(e=>{(i=>{i.Desired="desired",i.Subscribed="subscribed",i.Unsubscribed="unsubscribed"})(e.SubscriptionStatus||(e.SubscriptionStatus={})),(i=>{i.Allowed="allowed",i.NotAllowed="not_allowed"})(e.PermissionStatus||(e.PermissionStatus={}))})(TrackPublication||(TrackPublication={}));class LocalTrackPublication extends TrackPublication{constructor(t,n,a){super(t,n.sid,n.name);h(this,"track");h(this,"options");h(this,"handleTrackEnded",()=>{this.emit(TrackEvent.Ended)});this.updateInfo(n),this.setTrack(a)}get isUpstreamPaused(){var t;return(t=this.track)==null?void 0:t.isUpstreamPaused}setTrack(t){this.track&&this.track.off(TrackEvent.Ended,this.handleTrackEnded),super.setTrack(t),t&&t.on(TrackEvent.Ended,this.handleTrackEnded)}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}async mute(){var t;return(t=this.track)==null?void 0:t.mute()}async unmute(){var t;return(t=this.track)==null?void 0:t.unmute()}async pauseUpstream(){var t;await((t=this.track)==null?void 0:t.pauseUpstream())}async resumeUpstream(){var t;await((t=this.track)==null?void 0:t.resumeUpstream())}}class VideoPreset{constructor(i,t,n,a){h(this,"encoding");h(this,"width");h(this,"height");this.width=i,this.height=t,this.encoding={maxBitrate:n,maxFramerate:a}}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.width/this.height}}}const backupCodecs=["vp8","h264"];function isBackupCodec(e){return!!backupCodecs.find(i=>i===e)}var AudioPresets;(e=>{e.telephone={maxBitrate:12e3},e.speech={maxBitrate:2e4},e.music={maxBitrate:32e3},e.musicStereo={maxBitrate:48e3},e.musicHighQuality={maxBitrate:64e3},e.musicHighQualityStereo={maxBitrate:96e3}})(AudioPresets||(AudioPresets={}));const VideoPresets={h90:new VideoPreset(160,90,6e4,15),h180:new VideoPreset(320,180,12e4,15),h216:new VideoPreset(384,216,18e4,15),h360:new VideoPreset(640,360,3e5,20),h540:new VideoPreset(960,540,6e5,25),h720:new VideoPreset(1280,720,17e5,30),h1080:new VideoPreset(1920,1080,3e6,30),h1440:new VideoPreset(2560,1440,5e6,30),h2160:new VideoPreset(3840,2160,8e6,30)},VideoPresets43={h120:new VideoPreset(160,120,8e4,15),h180:new VideoPreset(240,180,1e5,15),h240:new VideoPreset(320,240,15e4,15),h360:new VideoPreset(480,360,225e3,20),h480:new VideoPreset(640,480,3e5,20),h540:new VideoPreset(720,540,45e4,25),h720:new VideoPreset(960,720,15e5,30),h1080:new VideoPreset(1440,1080,25e5,30),h1440:new VideoPreset(1920,1440,35e5,30)},ScreenSharePresets={h360fps3:new VideoPreset(640,360,2e5,3),h720fps5:new VideoPreset(1280,720,4e5,5),h720fps15:new VideoPreset(1280,720,1e6,15),h1080fps15:new VideoPreset(1920,1080,15e5,15),h1080fps30:new VideoPreset(1920,1080,3e6,30)};var ConnectionQuality=(e=>(e.Excellent="excellent",e.Good="good",e.Poor="poor",e.Unknown="unknown",e))(ConnectionQuality||{});function qualityFromProto(e){switch(e){case ConnectionQuality$1.EXCELLENT:return"excellent";case ConnectionQuality$1.GOOD:return"good";case ConnectionQuality$1.POOR:return"poor";default:return"unknown"}}class Participant extends events.exports.EventEmitter{constructor(t,n,a,s){super();h(this,"participantInfo");h(this,"audioTracks");h(this,"videoTracks");h(this,"tracks");h(this,"audioLevel",0);h(this,"isSpeaking",!1);h(this,"sid");h(this,"identity");h(this,"name");h(this,"metadata");h(this,"lastSpokeAt");h(this,"permissions");h(this,"_connectionQuality","unknown");this.setMaxListeners(100),this.sid=t,this.identity=n,this.name=a,this.metadata=s,this.audioTracks=new Map,this.videoTracks=new Map,this.tracks=new Map}getTracks(){return Array.from(this.tracks.values())}getTrack(t){if(t!==Track.Source.Unknown){for(const[,n]of this.tracks)if(n.source===t)return n}}getTrackByName(t){for(const[,n]of this.tracks)if(n.trackName===t)return n}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var n;const t=this.getTrack(Track.Source.Camera);return!((n=t==null?void 0:t.isMuted)==null||n)}get isMicrophoneEnabled(){var n;const t=this.getTrack(Track.Source.Microphone);return!((n=t==null?void 0:t.isMuted)==null||n)}get isScreenShareEnabled(){return!!this.getTrack(Track.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(this.participantInfo.joinedAt*1e3):new Date}updateInfo(t){this.identity=t.identity,this.sid=t.sid,this.name=t.name,this.setMetadata(t.metadata),t.permission&&this.setPermissions(t.permission),this.participantInfo=t,livekitLogger.trace("update participant info",{info:t})}setMetadata(t){const n=this.metadata!==t,a=this.metadata;this.metadata=t,n&&this.emit(ParticipantEvent.ParticipantMetadataChanged,a)}setPermissions(t){var s,o,c,d,u;const n=this.permissions,a=t.canPublish!==((s=this.permissions)==null?void 0:s.canPublish)||t.canSubscribe!==((o=this.permissions)==null?void 0:o.canSubscribe)||t.canPublishData!==((c=this.permissions)==null?void 0:c.canPublishData)||t.hidden!==((d=this.permissions)==null?void 0:d.hidden)||t.recorder!==((u=this.permissions)==null?void 0:u.recorder)||t.canPublishSources.length!==this.permissions.canPublishSources.length||t.canPublishSources.some((l,f)=>{var p;return l!==((p=this.permissions)==null?void 0:p.canPublishSources[f])});return this.permissions=t,a&&this.emit(ParticipantEvent.ParticipantPermissionsChanged,n),a}setIsSpeaking(t){t!==this.isSpeaking&&(this.isSpeaking=t,t&&(this.lastSpokeAt=new Date),this.emit(ParticipantEvent.IsSpeakingChanged,t))}setConnectionQuality(t){const n=this._connectionQuality;this._connectionQuality=qualityFromProto(t),n!==this._connectionQuality&&this.emit(ParticipantEvent.ConnectionQualityChanged,this._connectionQuality)}addTrackPublication(t){t.on(TrackEvent.Muted,()=>{this.emit(ParticipantEvent.TrackMuted,t)}),t.on(TrackEvent.Unmuted,()=>{this.emit(ParticipantEvent.TrackUnmuted,t)});const n=t;switch(n.track&&(n.track.sid=t.trackSid),this.tracks.set(t.trackSid,t),t.kind){case Track.Kind.Audio:this.audioTracks.set(t.trackSid,t);break;case Track.Kind.Video:this.videoTracks.set(t.trackSid,t);break}}}function trackPermissionToProto(e){var i,t,n;if(!e.participantSid&&!e.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return{participantIdentity:(i=e.participantIdentity)!=null?i:"",participantSid:(t=e.participantSid)!=null?t:"",allTracks:(n=e.allowAll)!=null?n:!1,trackSids:e.allowedTrackSids||[]}}function mediaTrackToLocalTrack(e,i){switch(e.kind){case"audio":return new LocalAudioTrack(e,i,!1);case"video":return new LocalVideoTrack(e,i,!1);default:throw new TrackInvalidError(`unsupported track type: ${e.kind}`)}}const presets169=Object.values(VideoPresets),presets43=Object.values(VideoPresets43),presetsScreenShare=Object.values(ScreenSharePresets),defaultSimulcastPresets169=[VideoPresets.h180,VideoPresets.h360],defaultSimulcastPresets43=[VideoPresets43.h180,VideoPresets43.h360],computeDefaultScreenShareSimulcastPresets=e=>[{scaleResolutionDownBy:2,fps:3}].map(t=>{var n;return new VideoPreset(Math.floor(e.width/t.scaleResolutionDownBy),Math.floor(e.height/t.scaleResolutionDownBy),Math.max(15e4,Math.floor(e.encoding.maxBitrate/(t.scaleResolutionDownBy**2*(((n=e.encoding.maxFramerate)!=null?n:30)/t.fps)))),t.fps)}),videoRids=["q","h","f"];function computeVideoEncodings(e,i,t,n){var f,p;let a=n==null?void 0:n.videoEncoding;e&&(a=n==null?void 0:n.screenShareEncoding);const s=n==null?void 0:n.simulcast,o=n==null?void 0:n.scalabilityMode,c=n==null?void 0:n.videoCodec;if(!a&&!s&&!o||!i||!t)return[{}];a||(a=determineAppropriateEncoding(e,i,t,c),livekitLogger.debug("using video encoding",a));const d=new VideoPreset(i,t,a.maxBitrate,a.maxFramerate);if(o&&c==="av1"){livekitLogger.debug(`using svc with scalabilityMode ${o}`);const m=[];switch(o){case"L3T3":for(let g=0;g<3;g+=1)m.push({rid:videoRids[2-g],scaleResolutionDownBy:2**g,maxBitrate:a.maxBitrate/3**g,maxFramerate:d.encoding.maxFramerate,scalabilityMode:"L3T3"});return livekitLogger.debug("encodings",m),m;default:throw new Error(`unsupported scalabilityMode: ${o}`)}}if(!s)return[a];let u=[];e?u=(f=sortPresets(n==null?void 0:n.screenShareSimulcastLayers))!=null?f:defaultSimulcastLayers(e,d):u=(p=sortPresets(n==null?void 0:n.videoSimulcastLayers))!=null?p:defaultSimulcastLayers(e,d);let l;if(u.length>0){const m=u[0];u.length>1&&([,l]=u);const g=Math.max(i,t);if(g>=960&&l)return encodingsFromPresets(i,t,[m,l,d]);if(g>=480)return encodingsFromPresets(i,t,[m,d])}return encodingsFromPresets(i,t,[d])}function computeTrackBackupEncodings(e,i,t){var c,d,u,l;if(!t.backupCodec||t.backupCodec.codec===t.videoCodec)return;i!==t.backupCodec.codec&&livekitLogger.warn("requested a different codec than specified as backup",{serverRequested:i,backup:t.backupCodec.codec}),t.videoCodec=i,t.videoEncoding=t.backupCodec.encoding;const n=e.mediaStreamTrack.getSettings(),a=(d=n.width)!=null?d:(c=e.dimensions)==null?void 0:c.width,s=(l=n.height)!=null?l:(u=e.dimensions)==null?void 0:u.height;return computeVideoEncodings(e.source===Track.Source.ScreenShare,a,s,t)}function determineAppropriateEncoding(e,i,t,n){const a=presetsForResolution(e,i,t);let{encoding:s}=a[0];const o=Math.max(i,t);for(let c=0;c<a.length;c+=1){const d=a[c];if(s=d.encoding,d.width>=o)break}if(n)switch(n){case"av1":s.maxBitrate=s.maxBitrate*.7;break}return s}function presetsForResolution(e,i,t){if(e)return presetsScreenShare;const n=i>t?i/t:t/i;return Math.abs(n-16/9)<Math.abs(n-4/3)?presets169:presets43}function defaultSimulcastLayers(e,i){if(e)return computeDefaultScreenShareSimulcastPresets(i);const{width:t,height:n}=i,a=t>n?t/n:n/t;return Math.abs(a-16/9)<Math.abs(a-4/3)?defaultSimulcastPresets169:defaultSimulcastPresets43}function encodingsFromPresets(e,i,t){const n=[];return t.forEach((a,s)=>{if(s>=videoRids.length)return;const o=Math.min(e,i),c=videoRids[s];n.push({rid:c,scaleResolutionDownBy:Math.max(1,o/Math.min(a.width,a.height)),maxBitrate:a.encoding.maxBitrate,maxFramerate:a.encoding.maxFramerate})}),n}function sortPresets(e){if(!!e)return e.sort((i,t)=>{const{encoding:n}=i,{encoding:a}=t;return n.maxBitrate>a.maxBitrate?1:n.maxBitrate<a.maxBitrate?-1:n.maxBitrate===a.maxBitrate&&n.maxFramerate&&a.maxFramerate?n.maxFramerate>a.maxFramerate?1:-1:0})}class RemoteTrackPublication extends TrackPublication{constructor(t,n,a,s){super(t,n,a);h(this,"track");h(this,"allowed",!0);h(this,"subscribed");h(this,"disabled",!1);h(this,"currentVideoQuality",VideoQuality.HIGH);h(this,"videoDimensions");h(this,"fps");h(this,"handleEnded",t=>{this.setTrack(void 0),this.emit(TrackEvent.Ended,t)});h(this,"handleVisibilityChange",t=>{livekitLogger.debug(`adaptivestream video visibility ${this.trackSid}, visible=${t}`,{trackSid:this.trackSid}),this.disabled=!t,this.emitTrackUpdate()});h(this,"handleVideoDimensionsChange",t=>{livekitLogger.debug(`adaptivestream video dimensions ${t.width}x${t.height}`,{trackSid:this.trackSid}),this.videoDimensions=t,this.emitTrackUpdate()});this.subscribed=s}setSubscribed(t){const n=this.subscriptionStatus,a=this.permissionStatus;this.subscribed=t,t&&(this.allowed=!0);const s={trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[{participantSid:"",trackSids:[this.trackSid]}]};this.emit(TrackEvent.UpdateSubscription,s),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(a)}get subscriptionStatus(){return this.subscribed===!1?TrackPublication.SubscriptionStatus.Unsubscribed:super.isSubscribed?TrackPublication.SubscriptionStatus.Subscribed:TrackPublication.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?TrackPublication.PermissionStatus.Allowed:TrackPublication.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return!this.disabled}setEnabled(t){!this.isManualOperationAllowed()||this.disabled===!t||(this.disabled=!t,this.emitTrackUpdate())}setVideoQuality(t){!this.isManualOperationAllowed()||this.currentVideoQuality===t||(this.currentVideoQuality=t,this.videoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(t){var n,a;!this.isManualOperationAllowed()||((n=this.videoDimensions)==null?void 0:n.width)===t.width&&((a=this.videoDimensions)==null?void 0:a.height)===t.height||(this.track instanceof RemoteVideoTrack&&(this.videoDimensions=t),this.currentVideoQuality=void 0,this.emitTrackUpdate())}setVideoFPS(t){!this.isManualOperationAllowed()||this.track instanceof RemoteVideoTrack&&this.fps!==t&&(this.fps=t,this.emitTrackUpdate())}get videoQuality(){return this.currentVideoQuality}setTrack(t){const n=this.subscriptionStatus,a=this.permissionStatus,s=this.track;s!==t&&(s&&(s.off(TrackEvent.VideoDimensionsChanged,this.handleVideoDimensionsChange),s.off(TrackEvent.VisibilityChanged,this.handleVisibilityChange),s.off(TrackEvent.Ended,this.handleEnded),s.detach(),this.emit(TrackEvent.Unsubscribed,s)),super.setTrack(t),t&&(t.sid=this.trackSid,t.on(TrackEvent.VideoDimensionsChanged,this.handleVideoDimensionsChange),t.on(TrackEvent.VisibilityChanged,this.handleVisibilityChange),t.on(TrackEvent.Ended,this.handleEnded),this.emit(TrackEvent.Subscribed,t)),this.emitPermissionUpdateIfChanged(a),this.emitSubscriptionUpdateIfChanged(n))}setAllowed(t){const n=this.subscriptionStatus,a=this.permissionStatus;this.allowed=t,this.emitPermissionUpdateIfChanged(a),this.emitSubscriptionUpdateIfChanged(n)}updateInfo(t){var n;super.updateInfo(t),this.metadataMuted=t.muted,(n=this.track)==null||n.setMuted(t.muted)}emitSubscriptionUpdateIfChanged(t){const n=this.subscriptionStatus;t!==n&&this.emit(TrackEvent.SubscriptionStatusChanged,n,t)}emitPermissionUpdateIfChanged(t){this.permissionStatus!==t&&this.emit(TrackEvent.SubscriptionPermissionChanged,this.permissionStatus,t)}isManualOperationAllowed(){return this.isAdaptiveStream?(livekitLogger.warn("adaptive stream is enabled, cannot change track settings",{trackSid:this.trackSid}),!1):this.isDesired?!0:(livekitLogger.warn("cannot update track settings when not subscribed",{trackSid:this.trackSid}),!1)}get isAdaptiveStream(){return this.track instanceof RemoteVideoTrack&&this.track.isAdaptiveStream}emitTrackUpdate(){const t=UpdateTrackSettings.fromPartial({trackSids:[this.trackSid],disabled:this.disabled,fps:this.fps});this.videoDimensions?(t.width=this.videoDimensions.width,t.height=this.videoDimensions.height):this.currentVideoQuality!==void 0?t.quality=this.currentVideoQuality:t.quality=VideoQuality.HIGH,this.emit(TrackEvent.UpdateSettings,t)}}class RemoteParticipant extends Participant{constructor(t,n,a,s,o){super(n,a||"",s,o);h(this,"audioTracks");h(this,"videoTracks");h(this,"tracks");h(this,"signalClient");h(this,"volume");h(this,"audioContext");h(this,"audioOutput");this.signalClient=t,this.tracks=new Map,this.audioTracks=new Map,this.videoTracks=new Map}static fromParticipantInfo(t,n){return new RemoteParticipant(t,n.sid,n.identity,n.name,n.metadata)}addTrackPublication(t){super.addTrackPublication(t),t.on(TrackEvent.UpdateSettings,n=>{livekitLogger.debug("send update settings",n),this.signalClient.sendUpdateTrackSettings(n)}),t.on(TrackEvent.UpdateSubscription,n=>{n.participantTracks.forEach(a=>{a.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(n)}),t.on(TrackEvent.SubscriptionPermissionChanged,n=>{this.emit(ParticipantEvent.TrackSubscriptionPermissionChanged,t,n)}),t.on(TrackEvent.SubscriptionStatusChanged,n=>{this.emit(ParticipantEvent.TrackSubscriptionStatusChanged,t,n)}),t.on(TrackEvent.Subscribed,n=>{this.emit(ParticipantEvent.TrackSubscribed,n,t)}),t.on(TrackEvent.Unsubscribed,n=>{this.emit(ParticipantEvent.TrackUnsubscribed,n,t)})}getTrack(t){const n=super.getTrack(t);if(n)return n}getTrackByName(t){const n=super.getTrackByName(t);if(n)return n}setVolume(t){this.volume=t;const n=this.getTrack(Track.Source.Microphone);n&&n.track&&n.track.setVolume(t)}getVolume(){const t=this.getTrack(Track.Source.Microphone);return t&&t.track?t.track.getVolume():this.volume}addSubscribedMediaTrack(t,n,a,s,o,c){let d=this.getTrackPublication(n);if(d||n.startsWith("TR")||this.tracks.forEach(f=>{!d&&t.kind===f.kind.toString()&&(d=f)}),!d){if(c===0){livekitLogger.error("could not find published track",{participant:this.sid,trackSid:n}),this.emit(ParticipantEvent.TrackSubscriptionFailed,n);return}c===void 0&&(c=20),setTimeout(()=>{this.addSubscribedMediaTrack(t,n,a,s,o,c-1)},150);return}if(t.readyState==="ended"){livekitLogger.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",{participant:this.sid,trackSid:n}),this.emit(ParticipantEvent.TrackSubscriptionFailed,n);return}const u=t.kind==="video";let l;return u?l=new RemoteVideoTrack(t,n,s,o):l=new RemoteAudioTrack(t,n,s,this.audioContext,this.audioOutput),l.source=d.source,l.isMuted=d.isMuted,l.setMediaStream(a),l.start(),d.setTrack(l),this.volume!==void 0&&l instanceof RemoteAudioTrack&&l.source===Track.Source.Microphone&&l.setVolume(this.volume),d}get hasMetadata(){return!!this.participantInfo}getTrackPublication(t){return this.tracks.get(t)}updateInfo(t){super.updateInfo(t);const n=new Map,a=new Map;t.tracks.forEach(s=>{var c;let o=this.getTrackPublication(s.sid);if(o)o.updateInfo(s);else{const d=Track.kindFromProto(s.type);if(!d)return;o=new RemoteTrackPublication(d,s.sid,s.name,(c=this.signalClient.connectOptions)==null?void 0:c.autoSubscribe),o.updateInfo(s),a.set(s.sid,o);const u=Array.from(this.tracks.values()).find(l=>l.source===(o==null?void 0:o.source));u&&o.source!==Track.Source.Unknown&&livekitLogger.warn(`received a second track publication for ${this.identity} with the same source: ${o.source}`,{oldTrack:u,newTrack:o,participant:this,participantInfo:t}),this.addTrackPublication(o)}n.set(s.sid,o)}),this.tracks.forEach(s=>{n.has(s.trackSid)||(livekitLogger.trace("detected removed track on remote participant, unpublishing",{publication:s,participantSid:this.sid}),this.unpublishTrack(s.trackSid,!0))}),a.forEach(s=>{this.emit(ParticipantEvent.TrackPublished,s)})}unpublishTrack(t,n){const a=this.tracks.get(t);if(!a)return;switch(this.tracks.delete(t),a.kind){case Track.Kind.Audio:this.audioTracks.delete(t);break;case Track.Kind.Video:this.videoTracks.delete(t);break}const{track:s}=a;s&&(s.stop(),a.setTrack(void 0)),n&&this.emit(ParticipantEvent.TrackUnpublished,a)}setAudioContext(t){this.audioContext=t,this.audioTracks.forEach(n=>n.track instanceof RemoteAudioTrack&&n.track.setAudioContext(t))}async setAudioOutput(t){this.audioOutput=t;const n=[];this.audioTracks.forEach(a=>{var s;a.track instanceof RemoteAudioTrack&&n.push(a.track.setSinkId((s=t.deviceId)!=null?s:"default"))}),await Promise.all(n)}emit(t,...n){return livekitLogger.trace("participant event",{participant:this.sid,event:t,args:n}),super.emit(t,...n)}}class LocalParticipant extends Participant{constructor(t,n,a,s){super(t,n);h(this,"audioTracks");h(this,"videoTracks");h(this,"tracks");h(this,"engine");h(this,"pendingPublishing",new Set);h(this,"cameraError");h(this,"microphoneError");h(this,"participantTrackPermissions",[]);h(this,"allParticipantsAllowedToSubscribe",!0);h(this,"roomOptions");h(this,"updateTrackSubscriptionPermissions",()=>{livekitLogger.debug("updating track subscription permissions",{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions}),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(t=>trackPermissionToProto(t)))});h(this,"onTrackUnmuted",t=>{this.onTrackMuted(t,t.isUpstreamPaused)});h(this,"onTrackMuted",(t,n)=>{if(n===void 0&&(n=!0),!t.sid){livekitLogger.error("could not update mute status for unpublished track",t);return}this.engine.updateMuteStatus(t.sid,n)});h(this,"onTrackUpstreamPaused",t=>{livekitLogger.debug("upstream paused"),this.onTrackMuted(t,!0)});h(this,"onTrackUpstreamResumed",t=>{livekitLogger.debug("upstream resumed"),this.onTrackMuted(t,t.isMuted)});h(this,"handleSubscribedQualityUpdate",async t=>{var a,s;if(!((a=this.roomOptions)!=null&&a.dynacast))return;const n=this.videoTracks.get(t.trackSid);if(!n){livekitLogger.warn("received subscribed quality update for unknown track",{method:"handleSubscribedQualityUpdate",sid:t.trackSid});return}if(t.subscribedCodecs.length>0){if(!n.videoTrack)return;const o=await n.videoTrack.setPublishingCodecs(t.subscribedCodecs);for await(const c of o)isBackupCodec(c)&&(livekitLogger.debug(`publish ${c} for ${n.videoTrack.sid}`),await this.publishAdditionalCodecForTrack(n.videoTrack,c,n.options))}else t.subscribedQualities.length>0&&((s=n.videoTrack)==null||s.setPublishingLayers(t.subscribedQualities))});h(this,"handleLocalTrackUnpublished",t=>{const n=this.tracks.get(t.trackSid);if(!n){livekitLogger.warn("received unpublished event for unknown track",{method:"handleLocalTrackUnpublished",trackSid:t.trackSid});return}this.unpublishTrack(n.track)});h(this,"handleTrackEnded",async t=>{if(t.source===Track.Source.ScreenShare||t.source===Track.Source.ScreenShareAudio)livekitLogger.debug("unpublishing local track due to TrackEnded",{track:t.sid}),this.unpublishTrack(t);else if(t.isUserProvided)await t.mute();else if(t instanceof LocalAudioTrack||t instanceof LocalVideoTrack)try{if(isWeb())try{const n=await(navigator==null?void 0:navigator.permissions.query({name:t.source===Track.Source.Camera?"camera":"microphone"}));if(n&&n.state==="denied")throw livekitLogger.warn(`user has revoked access to ${t.source}`),n.onchange=()=>{n.state!=="denied"&&(t.isMuted||t.restartTrack(),n.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}t.isMuted||(livekitLogger.debug("track ended, attempting to use a different device"),await t.restartTrack())}catch{livekitLogger.warn("could not restart track, muting instead"),await t.mute()}});this.audioTracks=new Map,this.videoTracks=new Map,this.tracks=new Map,this.engine=a,this.roomOptions=s,this.setupEngine(a)}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}getTrack(t){const n=super.getTrack(t);if(n)return n}getTrackByName(t){const n=super.getTrackByName(t);if(n)return n}setupEngine(t){this.engine=t,this.engine.client.onRemoteMuteChanged=(n,a)=>{const s=this.tracks.get(n);!s||!s.track||(a?s.mute():s.unmute())},this.engine.client.onSubscribedQualityUpdate=this.handleSubscribedQualityUpdate,this.engine.client.onLocalTrackUnpublished=this.handleLocalTrackUnpublished,this.engine.on(EngineEvent.Connected,this.updateTrackSubscriptionPermissions).on(EngineEvent.Restarted,this.updateTrackSubscriptionPermissions).on(EngineEvent.Resumed,this.updateTrackSubscriptionPermissions)}setCameraEnabled(t,n,a){return this.setTrackEnabled(Track.Source.Camera,t,n,a)}setMicrophoneEnabled(t,n,a){return this.setTrackEnabled(Track.Source.Microphone,t,n,a)}setScreenShareEnabled(t,n,a){return this.setTrackEnabled(Track.Source.ScreenShare,t,n,a)}async setTrackEnabled(t,n,a,s){livekitLogger.debug("setTrackEnabled",{source:t,enabled:n});let o=this.getTrack(t);if(n)if(o)await o.unmute();else{let c;if(this.pendingPublishing.has(t)){livekitLogger.info("skipping duplicate published source",{source:t});return}this.pendingPublishing.add(t);try{switch(t){case Track.Source.Camera:c=await this.createTracks({video:a!=null?a:!0});break;case Track.Source.Microphone:c=await this.createTracks({audio:a!=null?a:!0});break;case Track.Source.ScreenShare:c=await this.createScreenTracks({...a});break;default:throw new TrackInvalidError(t)}const d=[];for(const l of c)livekitLogger.info("publishing track",{localTrack:l}),d.push(this.publishTrack(l,s));[o]=await Promise.all(d)}catch(d){throw d instanceof Error&&!(d instanceof TrackInvalidError)&&this.emit(ParticipantEvent.MediaDevicesError,d),d}finally{this.pendingPublishing.delete(t)}}else if(o&&o.track)if(t===Track.Source.ScreenShare){o=await this.unpublishTrack(o.track);const c=this.getTrack(Track.Source.ScreenShareAudio);c&&c.track&&this.unpublishTrack(c.track)}else await o.mute();return o}async enableCameraAndMicrophone(){if(!(this.pendingPublishing.has(Track.Source.Camera)||this.pendingPublishing.has(Track.Source.Microphone))){this.pendingPublishing.add(Track.Source.Camera),this.pendingPublishing.add(Track.Source.Microphone);try{const t=await this.createTracks({audio:!0,video:!0});await Promise.all(t.map(n=>this.publishTrack(n)))}finally{this.pendingPublishing.delete(Track.Source.Camera),this.pendingPublishing.delete(Track.Source.Microphone)}}}async createTracks(t){var o,c;const n=mergeDefaultOptions(t,(o=this.roomOptions)==null?void 0:o.audioCaptureDefaults,(c=this.roomOptions)==null?void 0:c.videoCaptureDefaults),a=constraintsForOptions(n);let s;try{s=await navigator.mediaDevices.getUserMedia(a)}catch(d){throw d instanceof Error&&(a.audio&&(this.microphoneError=d),a.video&&(this.cameraError=d)),d}return a.audio&&(this.microphoneError=void 0),a.video&&(this.cameraError=void 0),s.getTracks().map(d=>{const u=d.kind==="audio";u?t.audio:t.video;let l;const f=u?a.audio:a.video;typeof f!="boolean"&&(l=f);const p=mediaTrackToLocalTrack(d,l);return p.kind===Track.Kind.Video?p.source=Track.Source.Camera:p.kind===Track.Kind.Audio&&(p.source=Track.Source.Microphone),p.mediaStream=s,p})}async createScreenTracks(t){var d;t===void 0&&(t={}),t.resolution===void 0&&(t.resolution=ScreenSharePresets.h1080fps15.resolution);let n=!0;if(t.resolution&&(isSafari()?n={width:{max:t.resolution.width},height:{max:t.resolution.height},frameRate:t.resolution.frameRate}:n={width:{ideal:t.resolution.width},height:{ideal:t.resolution.height},frameRate:t.resolution.frameRate}),navigator.mediaDevices.getDisplayMedia===void 0)throw new DeviceUnsupportedError("getDisplayMedia not supported");const a=await navigator.mediaDevices.getDisplayMedia({audio:(d=t.audio)!=null?d:!1,video:n}),s=a.getVideoTracks();if(s.length===0)throw new TrackInvalidError("no video track found");const o=new LocalVideoTrack(s[0],void 0,!1);o.source=Track.Source.ScreenShare;const c=[o];if(a.getAudioTracks().length>0){const u=new LocalAudioTrack(a.getAudioTracks()[0],void 0,!1);u.source=Track.Source.ScreenShareAudio,c.push(u)}return c}async publishTrack(t,n){var m,g,S,v,T;if(t instanceof MediaStreamTrack)switch(t.kind){case"audio":t=new LocalAudioTrack(t,void 0,!0);break;case"video":t=new LocalVideoTrack(t,void 0,!0);break;default:throw new TrackInvalidError(`unsupported MediaStreamTrack kind ${t.kind}`)}const a=(n==null?void 0:n.forceStereo)||"channelCount"in t.mediaStreamTrack.getSettings()&&t.mediaStreamTrack.getSettings().channelCount===2||t.mediaStreamTrack.getConstraints().channelCount===2;a&&(n||(n={}),n.dtx===void 0&&livekitLogger.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(m=n.dtx)!=null||(n.dtx=!1));const s={...this.roomOptions.publishDefaults,...n};let o;if(this.tracks.forEach(k=>{!k.track||k.track===t&&(o=k)}),o)return o;s.source&&(t.source=s.source);const c=Array.from(this.tracks.values()).find(k=>t instanceof LocalTrack&&k.source===t.source);if(c&&t.source!==Track.Source.Unknown)try{throw Error(`publishing a second track with the same source: ${t.source}`)}catch(k){k instanceof Error&&livekitLogger.warn(k.message,{oldTrack:c,newTrack:t,trace:k.stack})}s.stopMicTrackOnMute&&t instanceof LocalAudioTrack&&(t.stopOnMute=!0),t.source===Track.Source.ScreenShare&&isFireFox()&&(s.simulcast=!1),s.videoCodec==="av1"&&!supportsAV1()&&(s.videoCodec=void 0),t.on(TrackEvent.Muted,this.onTrackMuted),t.on(TrackEvent.Unmuted,this.onTrackUnmuted),t.on(TrackEvent.Ended,this.handleTrackEnded),t.on(TrackEvent.UpstreamPaused,this.onTrackUpstreamPaused),t.on(TrackEvent.UpstreamResumed,this.onTrackUpstreamResumed);const d=AddTrackRequest.fromPartial({cid:t.mediaStreamTrack.id,name:n==null?void 0:n.name,type:Track.kindToProto(t.kind),muted:t.isMuted,source:Track.sourceToProto(t.source),disableDtx:!((g=s.dtx)==null||g),stereo:a,disableRed:!((S=s.red)==null||S)});let u,l;if(t.kind===Track.Kind.Video){let k={width:0,height:0};try{k=await t.waitForDimensions()}catch{livekitLogger.error("could not determine track dimensions")}if(d.width=k.width,d.height=k.height,t instanceof LocalVideoTrack&&((s==null?void 0:s.videoCodec)==="av1"&&(s.scalabilityMode=(v=s.scalabilityMode)!=null?v:"L3T3"),s.videoCodec&&s.backupCodec&&s.videoCodec!==s.backupCodec.codec)){const b={...s};b.simulcast=!0,l=computeTrackBackupEncodings(t,s.backupCodec.codec,b),d.simulcastCodecs=[{codec:s.videoCodec,cid:t.mediaStreamTrack.id,enableSimulcastLayers:!0},{codec:s.backupCodec.codec,cid:"",enableSimulcastLayers:!0}]}u=computeVideoEncodings(t.source===Track.Source.ScreenShare,k.width,k.height,s),d.layers=videoLayersFromEncodings(d.width,d.height,l!=null?l:u)}else t.kind===Track.Kind.Audio&&s.audioBitrate&&(u=[{maxBitrate:s.audioBitrate}]);if(!this.engine||this.engine.isClosed)throw new UnexpectedConnectionState("cannot publish track when not connected");const f=await this.engine.addTrack(d),p=new LocalTrackPublication(t.kind,f,t);if(p.options=s,t.sid=f.sid,!this.engine.publisher)throw new UnexpectedConnectionState("publisher is closed");return livekitLogger.debug(`publishing ${t.kind} with encodings`,{encodings:u,trackInfo:f}),t.sender=await this.engine.createSender(t,s,u),t.codec==="av1"&&u&&((T=u[0])==null?void 0:T.maxBitrate)&&this.engine.publisher.setTrackCodecBitrate(d.cid,t.codec,u[0].maxBitrate/1e3),this.engine.negotiate(),t instanceof LocalVideoTrack?t.startMonitor(this.engine.client):t instanceof LocalAudioTrack&&t.startMonitor(),this.addTrackPublication(p),this.emit(ParticipantEvent.LocalTrackPublished,p),p}get isLocal(){return!0}async publishAdditionalCodecForTrack(t,n,a){var f;let s;if(this.tracks.forEach(p=>{!p.track||p.track===t&&(s=p)}),!s)throw new TrackInvalidError("track is not published");if(!(t instanceof LocalVideoTrack))throw new TrackInvalidError("track is not a video track");const o={...(f=this.roomOptions)==null?void 0:f.publishDefaults,...a},c=computeTrackBackupEncodings(t,n,o);if(!c){livekitLogger.info("backup codec has been disabled, ignoring request to add additional codec for track");return}const d=t.addSimulcastTrack(n,c),u=AddTrackRequest.fromPartial({cid:d.mediaStreamTrack.id,type:Track.kindToProto(t.kind),muted:t.isMuted,source:Track.sourceToProto(t.source),sid:t.sid,simulcastCodecs:[{codec:o.videoCodec,cid:d.mediaStreamTrack.id,enableSimulcastLayers:o.simulcast}]});if(u.layers=videoLayersFromEncodings(u.width,u.height,c),!this.engine||this.engine.isClosed)throw new UnexpectedConnectionState("cannot publish track when not connected");const l=await this.engine.addTrack(u);await this.engine.createSimulcastSender(t,d,o,c),this.engine.negotiate(),livekitLogger.debug(`published ${n} for track ${t.sid}`,{encodings:c,trackInfo:l})}async unpublishTrack(t,n){var s,o;const a=this.getPublicationForTrack(t);if(livekitLogger.debug("unpublishing track",{track:t,method:"unpublishTrack"}),!a||!a.track){livekitLogger.warn("track was not unpublished because no publication was found",{track:t,method:"unpublishTrack"});return}if(t=a.track,t.off(TrackEvent.Muted,this.onTrackMuted),t.off(TrackEvent.Unmuted,this.onTrackUnmuted),t.off(TrackEvent.Ended,this.handleTrackEnded),t.off(TrackEvent.UpstreamPaused,this.onTrackUpstreamPaused),t.off(TrackEvent.UpstreamResumed,this.onTrackUpstreamResumed),n===void 0&&(n=(o=(s=this.roomOptions)==null?void 0:s.stopLocalTrackOnUnpublish)!=null?o:!0),n&&t.stop(),this.engine.publisher&&this.engine.publisher.pc.connectionState!=="closed"&&t.sender)try{if(this.engine.removeTrack(t.sender),t instanceof LocalVideoTrack){for(const[,c]of t.simulcastCodecs)c.sender&&(this.engine.removeTrack(c.sender),c.sender=void 0);t.simulcastCodecs.clear()}}catch(c){livekitLogger.warn("failed to unpublish track",{error:c,method:"unpublishTrack"})}finally{await this.engine.negotiate()}switch(t.sender=void 0,this.tracks.delete(a.trackSid),a.kind){case Track.Kind.Audio:this.audioTracks.delete(a.trackSid);break;case Track.Kind.Video:this.videoTracks.delete(a.trackSid);break}return this.emit(ParticipantEvent.LocalTrackUnpublished,a),a.setTrack(void 0),a}async unpublishTracks(t){return(await Promise.all(t.map(a=>this.unpublishTrack(a)))).filter(a=>a instanceof LocalTrackPublication)}async republishAllTracks(t){const n=[];this.tracks.forEach(a=>{a.track&&(t&&(a.options={...a.options,...t}),n.push(a))}),await Promise.all(n.map(async a=>{const s=a.track;await this.unpublishTrack(s,!1),await this.publishTrack(s,a.options)}))}async publishData(t,n,a){const s=[];a!==void 0&&a.forEach(c=>{c instanceof RemoteParticipant?s.push(c.sid):s.push(c)});const o={kind:n,value:{$case:"user",user:{participantSid:this.sid,payload:t,destinationSids:s}}};await this.engine.sendDataPacket(o,n)}setTrackSubscriptionPermissions(t,n=[]){this.participantTrackPermissions=n,this.allParticipantsAllowedToSubscribe=t,this.engine.client.isConnected&&this.updateTrackSubscriptionPermissions()}updateInfo(t){t.sid===this.sid&&(super.updateInfo(t),t.tracks.forEach(n=>{var s,o;const a=this.tracks.get(n.sid);if(a){const c=a.isMuted||((o=(s=a.track)==null?void 0:s.isUpstreamPaused)!=null?o:!1);c!==n.muted&&(livekitLogger.debug("updating server mute state after reconcile",{sid:n.sid,muted:c}),this.engine.client.sendMuteTrack(n.sid,c))}}))}getPublicationForTrack(t){let n;return this.tracks.forEach(a=>{const s=a.track;!s||(t instanceof MediaStreamTrack?(s instanceof LocalAudioTrack||s instanceof LocalVideoTrack)&&s.mediaStreamTrack===t&&(n=a):t===s&&(n=a))}),n}publishedTracksInfo(){const t=[];return this.tracks.forEach(n=>{n.track!==void 0&&t.push({cid:n.track.mediaStreamID,track:n.trackInfo})}),t}dataChannelsInfo(){const t=[],n=(a,s)=>{(a==null?void 0:a.id)!==void 0&&a.id!==null&&t.push({label:a.label,id:a.id,target:s})};return n(this.engine.dataChannelForKind(DataPacket_Kind.LOSSY),SignalTarget.PUBLISHER),n(this.engine.dataChannelForKind(DataPacket_Kind.RELIABLE),SignalTarget.PUBLISHER),n(this.engine.dataChannelForKind(DataPacket_Kind.LOSSY,!0),SignalTarget.SUBSCRIBER),n(this.engine.dataChannelForKind(DataPacket_Kind.RELIABLE,!0),SignalTarget.SUBSCRIBER),t}}const passThroughQueueSignals=["syncState","trickle","offer","answer","simulate","leave"];function canPassThroughQueue(e){const i=passThroughQueueSignals.includes(e.$case);return livekitLogger.trace("request allowed to bypass queue:",{canPass:i,req:e}),i}class SignalClient{constructor(i=!1){h(this,"isConnected");h(this,"isReconnecting");h(this,"requestQueue");h(this,"queuedRequests");h(this,"useJSON");h(this,"rtt",0);h(this,"signalLatency");h(this,"onClose");h(this,"onAnswer");h(this,"onOffer");h(this,"onTrickle");h(this,"onParticipantUpdate");h(this,"onLocalTrackPublished");h(this,"onNegotiateRequested");h(this,"onSpeakersChanged");h(this,"onRemoteMuteChanged");h(this,"onRoomUpdate");h(this,"onConnectionQuality");h(this,"onStreamStateUpdate");h(this,"onSubscribedQualityUpdate");h(this,"onSubscriptionPermissionUpdate");h(this,"onLocalTrackUnpublished");h(this,"onTokenRefresh");h(this,"onLeave");h(this,"connectOptions");h(this,"ws");h(this,"options");h(this,"pingTimeout");h(this,"pingTimeoutDuration");h(this,"pingIntervalDuration");h(this,"pingInterval");h(this,"closingLock");this.isConnected=!1,this.isReconnecting=!1,this.useJSON=i,this.requestQueue=new Queue,this.queuedRequests=[],this.closingLock=new Mutex}async join(i,t,n,a){return this.isConnected=!1,this.options=n,await this.connect(i,t,n,a)}async reconnect(i,t,n,a){if(!this.options){livekitLogger.warn("attempted to reconnect without signal options being set, ignoring");return}return this.isReconnecting=!0,this.clearPingInterval(),await this.connect(i,t,{...this.options,reconnect:!0,sid:n,reconnectReason:a})}connect(i,t,n,a){this.connectOptions=n,i.startsWith("http")&&(i=i.replace("http","ws")),i=i.replace(/\/$/,""),i+="/rtc";const s=getClientInfo(),o=createConnectionParams(t,s,n);return new Promise(async(c,d)=>{const u=async()=>{await this.close(),d(new ConnectionError("room connection has been cancelled"))};a!=null&&a.aborted&&u(),a==null||a.addEventListener("abort",u),livekitLogger.debug(`connecting to ${i+o}`),this.ws&&await this.close(),this.ws=new WebSocket(i+o),this.ws.binaryType="arraybuffer",this.ws.onerror=async l=>{if(!this.isConnected){try{const f=await fetch(`http${i.substring(2)}/validate${o}`);if(f.ok)d(new ConnectionError("Internal error",ConnectionErrorReason.InternalError,f.status));else{const p=await f.text();d(new ConnectionError(p,ConnectionErrorReason.NotAllowed,f.status))}}catch{d(new ConnectionError("server was not reachable",ConnectionErrorReason.ServerUnreachable))}return}this.handleWSError(l)},this.ws.onmessage=async l=>{var p,m,g,S;let f;if(typeof l.data=="string"){const v=JSON.parse(l.data);f=SignalResponse.fromJSON(v)}else if(l.data instanceof ArrayBuffer)f=SignalResponse.decode(new Uint8Array(l.data));else{livekitLogger.error(`could not decode websocket message: ${typeof l.data}`);return}if(!this.isConnected){let v=!1;if(((p=f.message)==null?void 0:p.$case)==="join"?(this.isConnected=!0,a==null||a.removeEventListener("abort",u),this.pingTimeoutDuration=f.message.join.pingTimeout,this.pingIntervalDuration=f.message.join.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(livekitLogger.debug("ping config",{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration}),this.startPingInterval()),c(f.message.join)):n.reconnect?(this.isConnected=!0,a==null||a.removeEventListener("abort",u),this.startPingInterval(),((m=f.message)==null?void 0:m.$case)==="reconnect"?c((g=f.message)==null?void 0:g.reconnect):(c(),v=!0)):n.reconnect||d(new ConnectionError(`did not receive join response, got ${(S=f.message)==null?void 0:S.$case} instead`)),!v)return}this.signalLatency&&await sleep(this.signalLatency),this.handleSignalResponse(f)},this.ws.onclose=l=>{!this.isConnected||(livekitLogger.debug(`websocket connection closed: ${l.reason}`),this.isConnected=!1,this.onClose&&this.onClose(l.reason),this.ws=void 0)}})}async close(){const i=await this.closingLock.lock();try{if(this.isConnected=!1,this.ws){this.ws.onclose=null,this.ws.onmessage=null,this.ws.onopen=null;const t=new Promise(n=>{this.ws?this.ws.onclose=n:n(!0)});this.ws.close(),await Promise.race([t,sleep(250)])}this.ws=void 0,this.clearPingInterval()}finally{i()}}sendOffer(i){livekitLogger.debug("sending offer",i),this.sendRequest({$case:"offer",offer:toProtoSessionDescription(i)})}sendAnswer(i){livekitLogger.debug("sending answer"),this.sendRequest({$case:"answer",answer:toProtoSessionDescription(i)})}sendIceCandidate(i,t){livekitLogger.trace("sending ice candidate",i),this.sendRequest({$case:"trickle",trickle:{candidateInit:JSON.stringify(i),target:t}})}sendMuteTrack(i,t){this.sendRequest({$case:"mute",mute:{sid:i,muted:t}})}sendAddTrack(i){this.sendRequest({$case:"addTrack",addTrack:AddTrackRequest.fromPartial(i)})}sendUpdateTrackSettings(i){this.sendRequest({$case:"trackSetting",trackSetting:i})}sendUpdateSubscription(i){this.sendRequest({$case:"subscription",subscription:i})}sendSyncState(i){this.sendRequest({$case:"syncState",syncState:i})}sendUpdateVideoLayers(i,t){this.sendRequest({$case:"updateLayers",updateLayers:{trackSid:i,layers:t}})}sendUpdateSubscriptionPermissions(i,t){this.sendRequest({$case:"subscriptionPermission",subscriptionPermission:{allParticipants:i,trackPermissions:t}})}sendSimulateScenario(i){this.sendRequest({$case:"simulate",simulate:i})}sendPing(){this.sendRequest({$case:"ping",ping:Date.now()}),this.sendRequest({$case:"pingReq",pingReq:{timestamp:Date.now(),rtt:this.rtt}})}async sendLeave(){await this.sendRequest({$case:"leave",leave:{canReconnect:!1,reason:DisconnectReason.CLIENT_INITIATED}})}async sendRequest(i,t=!1){if(!t&&!canPassThroughQueue(i)&&this.isReconnecting){this.queuedRequests.push(async()=>{await this.sendRequest(i,!0)});return}if(t||await this.requestQueue.flush(),this.signalLatency&&await sleep(this.signalLatency),!this.ws||this.ws.readyState!==this.ws.OPEN){livekitLogger.error(`cannot send signal request before connected, type: ${i==null?void 0:i.$case}`);return}const a={message:i};try{this.useJSON?this.ws.send(JSON.stringify(SignalRequest.toJSON(a))):this.ws.send(SignalRequest.encode(a).finish())}catch(s){livekitLogger.error("error sending signal message",{error:s})}}handleSignalResponse(i){var n,a;const t=i.message;if(t==null){livekitLogger.debug("received unsupported message");return}if(t.$case==="answer"){const s=fromProtoSessionDescription(t.answer);this.onAnswer&&this.onAnswer(s)}else if(t.$case==="offer"){const s=fromProtoSessionDescription(t.offer);this.onOffer&&this.onOffer(s)}else if(t.$case==="trickle"){const s=JSON.parse(t.trickle.candidateInit);this.onTrickle&&this.onTrickle(s,t.trickle.target)}else t.$case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((n=t.update.participants)!=null?n:[]):t.$case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(t.trackPublished):t.$case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((a=t.speakersChanged.speakers)!=null?a:[]):t.$case==="leave"?this.onLeave&&this.onLeave(t.leave):t.$case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(t.mute.sid,t.mute.muted):t.$case==="roomUpdate"?this.onRoomUpdate&&t.roomUpdate.room&&this.onRoomUpdate(t.roomUpdate.room):t.$case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(t.connectionQuality):t.$case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(t.streamStateUpdate):t.$case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(t.subscribedQualityUpdate):t.$case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(t.subscriptionPermissionUpdate):t.$case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(t.refreshToken):t.$case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(t.trackUnpublished):t.$case==="pong"?this.resetPingTimeout():t.$case==="pongResp"?(this.rtt=Date.now()-t.pongResp.lastPingTimestamp,this.resetPingTimeout()):livekitLogger.debug("unsupported message",t)}setReconnected(){for(;this.queuedRequests.length>0;){const i=this.queuedRequests.shift();i&&this.requestQueue.run(i)}this.isReconnecting=!1}handleWSError(i){livekitLogger.error("websocket error",i)}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){livekitLogger.warn("ping timeout duration not set");return}this.pingTimeout=CriticalTimers.setTimeout(()=>{livekitLogger.warn(`ping timeout triggered. last pong received at: ${new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()}`),this.onClose&&this.onClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&CriticalTimers.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){livekitLogger.warn("ping interval duration not set");return}livekitLogger.debug("start ping interval"),this.pingInterval=CriticalTimers.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){livekitLogger.debug("clearing ping interval"),this.clearPingTimeout(),this.pingInterval&&CriticalTimers.clearInterval(this.pingInterval)}}function fromProtoSessionDescription(e){const i={type:"offer",sdp:e.sdp};switch(e.type){case"answer":case"offer":case"pranswer":case"rollback":i.type=e.type;break}return i}function toProtoSessionDescription(e){return{sdp:e.sdp,type:e.type}}function createConnectionParams(e,i,t){var a;const n=new URLSearchParams;return n.set("access_token",e),t.reconnect&&(n.set("reconnect","1"),t.sid&&n.set("sid",t.sid)),n.set("auto_subscribe",t.autoSubscribe?"1":"0"),n.set("sdk","js"),n.set("version",i.version),n.set("protocol",i.protocol.toString()),i.deviceModel&&n.set("device_model",i.deviceModel),i.os&&n.set("os",i.os),i.osVersion&&n.set("os_version",i.osVersion),i.browser&&n.set("browser",i.browser),i.browserVersion&&n.set("browser_version",i.browserVersion),t.publishOnly!==void 0&&n.set("publish",t.publishOnly),t.adaptiveStream&&n.set("adaptive_stream","1"),t.reconnectReason&&n.set("reconnect_reason",t.reconnectReason.toString()),(a=navigator.connection)!=null&&a.type&&n.set("network",navigator.connection.type),`?${n.toString()}`}const publishDefaults={audioBitrate:AudioPresets.music.maxBitrate,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:ScreenSharePresets.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:"vp8",backupCodec:{codec:"vp8",encoding:VideoPresets.h540.encoding}},audioDefaults={autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0},videoDefaults={resolution:VideoPresets.h720.resolution},roomOptionDefaults={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new DefaultReconnectPolicy,expWebAudioMix:!1},roomConnectOptionDefaults={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3};var parser$1={},grammar$2={exports:{}},grammar$1=grammar$2.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var i="candidate:%s %d %s %d %s %d typ %s";return i+=e.raddr!=null?" raddr %s rport %d":"%v%v",i+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(i+=" generation %d"),i+=e["network-id"]!=null?" network-id %d":"%v",i+=e["network-cost"]!=null?" network-cost %d":"%v",i}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var i="ssrc:%d";return e.attribute!=null&&(i+=" %s",e.value!=null&&(i+=":%s")),i}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var i="mediaclk:";return i+=e.id!=null?"id=%s %s":"%v%s",i+=e.mediaClockValue!=null?"=%s":"",i+=e.rateNumerator!=null?" rate=%s":"",i+=e.rateDenominator!=null?"/%s":"",i}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(grammar$1).forEach(function(e){var i=grammar$1[e];i.forEach(function(t){t.reg||(t.reg=/(.*)/),t.format||(t.format="%s")})});(function(e){var i=function(c){return String(Number(c))===c?Number(c):c},t=function(c,d,u,l){if(l&&!u)d[l]=i(c[1]);else for(var f=0;f<u.length;f+=1)c[f+1]!=null&&(d[u[f]]=i(c[f+1]))},n=function(c,d,u){var l=c.name&&c.names;c.push&&!d[c.push]?d[c.push]=[]:l&&!d[c.name]&&(d[c.name]={});var f=c.push?{}:l?d[c.name]:d;t(u.match(c.reg),f,c.names,c.name),c.push&&d[c.push].push(f)},a=grammar$2.exports,s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(c){var d={},u=[],l=d;return c.split(/(\r\n|\r|\n)/).filter(s).forEach(function(f){var p=f[0],m=f.slice(2);p==="m"&&(u.push({rtp:[],fmtp:[]}),l=u[u.length-1]);for(var g=0;g<(a[p]||[]).length;g+=1){var S=a[p][g];if(S.reg.test(m))return n(S,l,m)}}),d.media=u,d};var o=function(c,d){var u=d.split(/=(.+)/,2);return u.length===2?c[u[0]]=i(u[1]):u.length===1&&d.length>1&&(c[u[0]]=void 0),c};e.parseParams=function(c){return c.split(/;\s?/).reduce(o,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(c){return c.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(c){for(var d=[],u=c.split(" ").map(i),l=0;l<u.length;l+=3)d.push({component:u[l],ip:u[l+1],port:u[l+2]});return d},e.parseImageAttributes=function(c){return c.split(" ").map(function(d){return d.substring(1,d.length-1).split(",").reduce(o,{})})},e.parseSimulcastStreamList=function(c){return c.split(";").map(function(d){return d.split(",").map(function(u){var l,f=!1;return u[0]!=="~"?l=i(u):(l=i(u.substring(1,u.length)),f=!0),{scid:l,paused:f}})})}})(parser$1);var grammar=grammar$2.exports,formatRegExp=/%[sdv%]/g,format=function(e){var i=1,t=arguments,n=t.length;return e.replace(formatRegExp,function(a){if(i>=n)return a;var s=t[i];switch(i+=1,a){case"%%":return"%";case"%s":return String(s);case"%d":return Number(s);case"%v":return""}})},makeLine=function(e,i,t){var n=i.format instanceof Function?i.format(i.push?t:t[i.name]):i.format,a=[e+"="+n];if(i.names)for(var s=0;s<i.names.length;s+=1){var o=i.names[s];i.name?a.push(t[i.name][o]):a.push(t[i.names[s]])}else a.push(t[i.name]);return format.apply(null,a)},defaultOuterOrder=["v","o","s","i","u","e","p","c","b","t","r","z","a"],defaultInnerOrder=["i","c","b","a"],writer$1=function(e,i){i=i||{},e.version==null&&(e.version=0),e.name==null&&(e.name=" "),e.media.forEach(function(s){s.payloads==null&&(s.payloads="")});var t=i.outerOrder||defaultOuterOrder,n=i.innerOrder||defaultInnerOrder,a=[];return t.forEach(function(s){grammar[s].forEach(function(o){o.name in e&&e[o.name]!=null?a.push(makeLine(s,o,e)):o.push in e&&e[o.push]!=null&&e[o.push].forEach(function(c){a.push(makeLine(s,o,c))})})}),e.media.forEach(function(s){a.push(makeLine("m",grammar.m[0],s)),n.forEach(function(o){grammar[o].forEach(function(c){c.name in s&&s[c.name]!=null?a.push(makeLine(o,c,s)):c.push in s&&s[c.push]!=null&&s[c.push].forEach(function(d){a.push(makeLine(o,c,d))})})})}),a.join(`\r
`)+`\r
`},parser=parser$1,writer=writer$1,write=writer,parse=parser.parse;parser.parseParams;parser.parseFmtpConfig;parser.parsePayloads;parser.parseRemoteCandidates;parser.parseImageAttributes;parser.parseSimulcastStreamList;const PCEvents={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete"};class PCTransport extends events.exports{constructor(t){super();h(this,"pc");h(this,"pendingCandidates",[]);h(this,"restartingIce",!1);h(this,"renegotiate",!1);h(this,"trackBitrates",[]);h(this,"remoteStereoMids",[]);h(this,"remoteNackMids",[]);h(this,"onOffer");h(this,"negotiate",r(t=>{this.emit(PCEvents.NegotiationStarted);try{this.createAndSendOffer()}catch(n){if(t)t(n);else throw n}},100));this.pc=new RTCPeerConnection(t)}get isICEConnected(){return this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed"}async addIceCandidate(t){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(t);this.pendingCandidates.push(t)}async setRemoteDescription(t){if(t.type==="offer"){let{stereoMids:n,nackMids:a}=extractStereoAndNackAudioFromOffer(t);this.remoteStereoMids=n,this.remoteNackMids=a}await this.pc.setRemoteDescription(t),this.pendingCandidates.forEach(n=>{this.pc.addIceCandidate(n)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,this.createAndSendOffer()):t.type==="answer"&&this.emit(PCEvents.NegotiationComplete)}async createAndSendOffer(t){var s;if(this.onOffer===void 0)return;if(t!=null&&t.iceRestart&&(livekitLogger.debug("restarting ICE"),this.restartingIce=!0),this.pc.signalingState==="have-local-offer"){const o=this.pc.remoteDescription;if((t==null?void 0:t.iceRestart)&&o)await this.pc.setRemoteDescription(o);else{this.renegotiate=!0;return}}else if(this.pc.signalingState==="closed"){livekitLogger.warn("could not createOffer with closed peer connection");return}livekitLogger.debug("starting to negotiate");const n=await this.pc.createOffer(t),a=parse((s=n.sdp)!=null?s:"");a.media.forEach(o=>{o.type==="audio"?ensureAudioNackAndStereo(o,[],[]):o.type==="video"&&this.trackBitrates.some(c=>{if(!o.msid||!o.msid.includes(c.sid))return!1;let d=0;return o.rtp.some(u=>u.codec.toUpperCase()===c.codec.toUpperCase()?(d=u.payload,!0):!1),d>0&&(o.fmtp.some(u=>u.payload===d?(u.config.includes("x-google-max-bitrate")||(u.config+=`;x-google-max-bitrate=${c.maxbr}`),!0):!1)||o.fmtp.push({payload:d,config:`x-google-max-bitrate=${c.maxbr}`})),!0})}),this.trackBitrates=[],await this.setMungedLocalDescription(n,write(a)),this.onOffer(n)}async createAndSetAnswer(){var a;const t=await this.pc.createAnswer(),n=parse((a=t.sdp)!=null?a:"");return n.media.forEach(s=>{s.type==="audio"&&ensureAudioNackAndStereo(s,this.remoteStereoMids,this.remoteNackMids)}),await this.setMungedLocalDescription(t,write(n)),t}setTrackCodecBitrate(t,n,a){this.trackBitrates.push({sid:t,codec:n,maxbr:a})}close(){this.pc.close()}async setMungedLocalDescription(t,n){const a=t.sdp;t.sdp=n;try{livekitLogger.debug("setting munged local description"),await this.pc.setLocalDescription(t);return}catch(s){livekitLogger.warn(`not able to set ${t.type}, falling back to unmodified sdp`,{error:s}),t.sdp=a}try{await this.pc.setLocalDescription(t)}catch(s){let o="unknown error";throw s instanceof Error?o=s.message:typeof s=="string"&&(o=s),new NegotiationError(o)}}}function ensureAudioNackAndStereo(e,i,t){let n=0;e.rtp.some(a=>a.codec==="opus"?(n=a.payload,!0):!1),n>0&&(e.rtcpFb||(e.rtcpFb=[]),t.includes(e.mid)&&!e.rtcpFb.some(a=>a.payload===n&&a.type==="nack")&&e.rtcpFb.push({payload:n,type:"nack"}),i.includes(e.mid)&&e.fmtp.some(a=>a.payload===n?(a.config.includes("stereo=1")||(a.config+=";stereo=1"),!0):!1))}function extractStereoAndNackAudioFromOffer(e){var s;const i=[],t=[],n=parse((s=e.sdp)!=null?s:"");let a=0;return n.media.forEach(o=>{var c;o.type==="audio"&&(o.rtp.some(d=>d.codec==="opus"?(a=d.payload,!0):!1),(c=o.rtcpFb)!=null&&c.some(d=>d.payload===a&&d.type==="nack")&&t.push(o.mid),o.fmtp.some(d=>d.payload===a?(d.config.includes("sprop-stereo=1")&&i.push(o.mid),!0):!1))}),{stereoMids:i,nackMids:t}}const lossyDataChannel="_lossy",reliableDataChannel="_reliable",minReconnectWait=2*1e3,leaveReconnect="leave-reconnect";class RTCEngine extends events.exports.EventEmitter{constructor(t){super();h(this,"publisher");h(this,"subscriber");h(this,"client");h(this,"rtcConfig",{});h(this,"peerConnectionTimeout",roomConnectOptionDefaults.peerConnectionTimeout);h(this,"lossyDC");h(this,"lossyDCSub");h(this,"reliableDC");h(this,"reliableDCSub");h(this,"subscriberPrimary",!1);h(this,"primaryPC");h(this,"pcState",0);h(this,"_isClosed",!0);h(this,"pendingTrackResolvers",{});h(this,"hasPublished",!1);h(this,"url");h(this,"token");h(this,"signalOpts");h(this,"reconnectAttempts",0);h(this,"reconnectStart",0);h(this,"fullReconnectOnNext",!1);h(this,"clientConfiguration");h(this,"connectedServerAddr");h(this,"attemptingReconnect",!1);h(this,"reconnectPolicy");h(this,"reconnectTimeout");h(this,"participantSid");h(this,"joinAttempts",0);h(this,"maxJoinAttempts",1);h(this,"closingLock");h(this,"handleDataChannel",async({channel:t})=>{if(!!t){if(t.label===reliableDataChannel)this.reliableDCSub=t;else if(t.label===lossyDataChannel)this.lossyDCSub=t;else return;livekitLogger.debug(`on data channel ${t.id}, ${t.label}`),t.onmessage=this.handleDataMessage}});h(this,"handleDataMessage",async t=>{var s,o;let n;if(t.data instanceof ArrayBuffer)n=t.data;else if(t.data instanceof Blob)n=await t.data.arrayBuffer();else{livekitLogger.error("unsupported data type",t.data);return}const a=DataPacket.decode(new Uint8Array(n));((s=a.value)==null?void 0:s.$case)==="speaker"?this.emit(EngineEvent.ActiveSpeakersUpdate,a.value.speaker.speakers):((o=a.value)==null?void 0:o.$case)==="user"&&this.emit(EngineEvent.DataPacketReceived,a.value.user,a.kind)});h(this,"handleDataError",t=>{const a=t.currentTarget.maxRetransmits===0?"lossy":"reliable";if(t instanceof ErrorEvent){const{error:s}=t.error;livekitLogger.error(`DataChannel error on ${a}: ${t.message}`,s)}else livekitLogger.error(`Unknown DataChannel Error on ${a}`,t)});h(this,"handleDisconnect",(t,n=!1,a)=>{if(this._isClosed)return;livekitLogger.warn(`${t} disconnected`),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const s=d=>{livekitLogger.warn(`could not recover connection after ${this.reconnectAttempts} attempts, ${d}ms. giving up`),this.emit(EngineEvent.Disconnected),this.close()},o=Date.now()-this.reconnectStart;let c=this.getNextRetryDelay({elapsedMs:o,retryCount:this.reconnectAttempts});if(c===null){s(o);return}t===leaveReconnect&&(c=0),livekitLogger.debug(`reconnecting in ${c}ms`),this.clearReconnectTimeout(),this.reconnectTimeout=CriticalTimers.setTimeout(()=>this.attemptReconnect(n,a),c)});h(this,"handleBrowserOnLine",()=>{this.client.isReconnecting&&(this.clearReconnectTimeout(),this.attemptReconnect(!0,ReconnectReason.REASON_SIGNAL_DISCONNECTED))});this.options=t,this.client=new SignalClient,this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.registerOnLineListener(),this.closingLock=new Mutex}get isClosed(){return this._isClosed}async join(t,n,a,s){this.url=t,this.token=n,this.signalOpts=a;try{this.joinAttempts+=1;const o=await this.client.join(t,n,a,s);return this._isClosed=!1,this.subscriberPrimary=o.subscriberPrimary,this.publisher||this.configure(o),this.subscriberPrimary||this.negotiate(),this.clientConfiguration=o.clientConfiguration,o}catch(o){if(o instanceof ConnectionError&&o.reason===ConnectionErrorReason.ServerUnreachable&&(livekitLogger.warn(`Couldn't connect to server, attempt ${this.joinAttempts} of ${this.maxJoinAttempts}`),this.joinAttempts<this.maxJoinAttempts))return this.join(t,n,a,s);throw o}}async close(){const t=await this.closingLock.lock();if(this.isClosed){t();return}try{this._isClosed=!0,this.emit(EngineEvent.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),this.publisher&&this.publisher.pc.signalingState!=="closed"&&(this.publisher.pc.getSenders().forEach(n=>{var a,s;try{(a=this.publisher)!=null&&a.pc.removeTrack&&((s=this.publisher)==null||s.pc.removeTrack(n))}catch(o){livekitLogger.warn("could not removeTrack",{error:o})}}),this.publisher.close(),this.publisher=void 0),this.subscriber&&(this.subscriber.close(),this.subscriber=void 0),await this.client.close()}finally{t()}}addTrack(t){if(this.pendingTrackResolvers[t.cid])throw new TrackInvalidError("a track with the same ID has already been published");return new Promise((n,a)=>{const s=setTimeout(()=>{delete this.pendingTrackResolvers[t.cid],a(new ConnectionError("publication of local track timed out, no response from server"))},1e4);this.pendingTrackResolvers[t.cid]={resolve:o=>{clearTimeout(s),n(o)},reject:()=>{clearTimeout(s),a(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(t)})}removeTrack(t){var n;if(t.track&&this.pendingTrackResolvers[t.track.id]){const{reject:a}=this.pendingTrackResolvers[t.track.id];a&&a(),delete this.pendingTrackResolvers[t.track.id]}try{(n=this.publisher)==null||n.pc.removeTrack(t)}catch(a){livekitLogger.warn("failed to remove track",{error:a,method:"removeTrack"})}}updateMuteStatus(t,n){this.client.sendMuteTrack(t,n)}get dataSubscriberReadyState(){var t;return(t=this.reliableDCSub)==null?void 0:t.readyState}get connectedServerAddress(){return this.connectedServerAddr}configure(t){var c;if(this.publisher||this.subscriber)return;this.participantSid=(c=t.participant)==null?void 0:c.sid;const n=this.makeRTCConfiguration(t);this.publisher=new PCTransport(n),this.subscriber=new PCTransport(n),this.emit(EngineEvent.TransportsCreated,this.publisher,this.subscriber),this.publisher.pc.onicecandidate=d=>{!d.candidate||(livekitLogger.trace("adding ICE candidate for peer",d.candidate),this.client.sendIceCandidate(d.candidate,SignalTarget.PUBLISHER))},this.subscriber.pc.onicecandidate=d=>{!d.candidate||this.client.sendIceCandidate(d.candidate,SignalTarget.SUBSCRIBER)},this.publisher.onOffer=d=>{this.client.sendOffer(d)};let a=this.publisher.pc,s=this.subscriber.pc,o=t.subscriberPrimary;o&&(a=this.subscriber.pc,s=this.publisher.pc,this.subscriber.pc.ondatachannel=this.handleDataChannel),this.primaryPC=a,a.onconnectionstatechange=async()=>{if(livekitLogger.debug(`primary PC state changed ${a.connectionState}`),a.connectionState==="connected"){try{this.connectedServerAddr=await getConnectedAddress(a)}catch(u){livekitLogger.warn("could not get connected server address",{error:u})}const d=this.pcState===0;this.pcState=1,d&&this.emit(EngineEvent.Connected,t)}else a.connectionState==="failed"&&this.pcState===1&&(this.pcState=2,this.handleDisconnect("primary peerconnection",!1,o?ReconnectReason.REASON_SUBSCRIBER_FAILED:ReconnectReason.REASON_PUBLISHER_FAILED))},s.onconnectionstatechange=async()=>{livekitLogger.debug(`secondary PC state changed ${s.connectionState}`),s.connectionState==="failed"&&this.handleDisconnect("secondary peerconnection",!1,o?ReconnectReason.REASON_PUBLISHER_FAILED:ReconnectReason.REASON_SUBSCRIBER_FAILED)},this.subscriber.pc.ontrack=d=>{this.emit(EngineEvent.MediaTrackAdded,d.track,d.streams[0],d.receiver)},this.createDataChannels(),this.client.onAnswer=async d=>{!this.publisher||(livekitLogger.debug("received server answer",{RTCSdpType:d.type,signalingState:this.publisher.pc.signalingState}),await this.publisher.setRemoteDescription(d))},this.client.onTrickle=(d,u)=>{!this.publisher||!this.subscriber||(livekitLogger.trace("got ICE candidate from peer",{candidate:d,target:u}),u===SignalTarget.PUBLISHER?this.publisher.addIceCandidate(d):this.subscriber.addIceCandidate(d))},this.client.onOffer=async d=>{if(!this.subscriber)return;livekitLogger.debug("received server offer",{RTCSdpType:d.type,signalingState:this.subscriber.pc.signalingState}),await this.subscriber.setRemoteDescription(d);const u=await this.subscriber.createAndSetAnswer();this.client.sendAnswer(u)},this.client.onLocalTrackPublished=d=>{livekitLogger.debug("received trackPublishedResponse",d);const{resolve:u}=this.pendingTrackResolvers[d.cid];if(!u){livekitLogger.error(`missing track resolver for ${d.cid}`);return}delete this.pendingTrackResolvers[d.cid],u(d.track)},this.client.onTokenRefresh=d=>{this.token=d},this.client.onClose=()=>{this.handleDisconnect("signal",!1,ReconnectReason.REASON_SIGNAL_DISCONNECTED)},this.client.onLeave=d=>{d!=null&&d.canReconnect?(this.fullReconnectOnNext=!0,this.primaryPC=void 0,this.handleDisconnect(leaveReconnect)):(this.emit(EngineEvent.Disconnected,d==null?void 0:d.reason),this.close()),livekitLogger.trace("leave request",{leave:d})}}makeRTCConfiguration(t){const n={...this.rtcConfig};if(t.iceServers&&!n.iceServers){const a=[];t.iceServers.forEach(s=>{const o={urls:s.urls};s.username&&(o.username=s.username),s.credential&&(o.credential=s.credential),a.push(o)}),n.iceServers=a}return t.clientConfiguration&&t.clientConfiguration.forceRelay===ClientConfigSetting.ENABLED&&(n.iceTransportPolicy="relay"),n.sdpSemantics="unified-plan",n.continualGatheringPolicy="gather_continually",n}createDataChannels(){!this.publisher||(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.publisher.pc.createDataChannel(lossyDataChannel,{ordered:!0,maxRetransmits:0}),this.reliableDC=this.publisher.pc.createDataChannel(reliableDataChannel,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError)}setPreferredCodec(t,n,a){if(!("getCapabilities"in RTCRtpSender))return;const s=RTCRtpSender.getCapabilities(n);if(!s)return;livekitLogger.debug("get capabilities",s);const o=[],c=[],d=[];s.codecs.forEach(u=>{const l=u.mimeType.toLowerCase();if(l==="audio/opus"){o.push(u);return}if(!(l===`video/${a}`)){d.push(u);return}if(a==="h264"){u.sdpFmtpLine&&u.sdpFmtpLine.includes("profile-level-id=42e01f")?o.push(u):c.push(u);return}o.push(u)}),supportsSetCodecPreferences(t)&&t.setCodecPreferences(o.concat(c,d))}async createSender(t,n,a){if(supportsTransceiver())return this.createTransceiverRTCRtpSender(t,n,a);if(supportsAddTrack())return livekitLogger.debug("using add-track fallback"),this.createRTCRtpSender(t.mediaStreamTrack);throw new UnexpectedConnectionState("Required webRTC APIs not supported on this device")}async createSimulcastSender(t,n,a,s){if(supportsTransceiver())return this.createSimulcastTransceiverSender(t,n,a,s);if(supportsAddTrack())return livekitLogger.debug("using add-track fallback"),this.createRTCRtpSender(t.mediaStreamTrack);throw new UnexpectedConnectionState("Cannot stream on this device")}async createTransceiverRTCRtpSender(t,n,a){if(!this.publisher)throw new UnexpectedConnectionState("publisher is closed");const s={direction:"sendonly"};a&&(s.sendEncodings=a);const o=await this.publisher.pc.addTransceiver(t.mediaStreamTrack,s);return t.kind===Track.Kind.Video&&n.videoCodec&&(this.setPreferredCodec(o,t.kind,n.videoCodec),t.codec=n.videoCodec),o.sender}async createSimulcastTransceiverSender(t,n,a,s){if(!this.publisher)throw new UnexpectedConnectionState("publisher is closed");const o={direction:"sendonly"};s&&(o.sendEncodings=s);const c=await this.publisher.pc.addTransceiver(n.mediaStreamTrack,o);if(!!a.videoCodec)return this.setPreferredCodec(c,t.kind,a.videoCodec),t.setSimulcastTrackSender(a.videoCodec,c.sender),c.sender}async createRTCRtpSender(t){if(!this.publisher)throw new UnexpectedConnectionState("publisher is closed");return this.publisher.pc.addTrack(t)}async attemptReconnect(t=!1,n){var a,s,o;if(!this._isClosed&&!this.attemptingReconnect){(((a=this.clientConfiguration)==null?void 0:a.resumeConnection)===ClientConfigSetting.DISABLED||((o=(s=this.primaryPC)==null?void 0:s.signalingState)!=null?o:"closed")==="closed")&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?await this.restartConnection(t):await this.resumeConnection(t,n),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(c){this.reconnectAttempts+=1;let d=!1,u=!0,l=!1;c instanceof UnexpectedConnectionState?(livekitLogger.debug("received unrecoverable error",{error:c}),u=!1):c instanceof SignalReconnectError||(d=!0),d&&!this.fullReconnectOnNext&&(this.fullReconnectOnNext=!0,l=!0),u?this.handleDisconnect("reconnect",l,ReconnectReason.REASON_UNKOWN):(livekitLogger.info(`could not recover connection after ${this.reconnectAttempts} attempts, ${Date.now()-this.reconnectStart}ms. giving up`),this.emit(EngineEvent.Disconnected),this.close())}finally{this.attemptingReconnect=!1}}}getNextRetryDelay(t){try{return this.reconnectPolicy.nextRetryDelayInMs(t)}catch(n){livekitLogger.warn("encountered error in reconnect policy",{error:n})}return null}async restartConnection(t=!1){var a,s;if(!this.url||!this.token)throw new UnexpectedConnectionState("could not reconnect, url or token not saved");livekitLogger.info(`reconnecting, attempt: ${this.reconnectAttempts}`),(t||this.reconnectAttempts===0)&&this.emit(EngineEvent.Restarting),this.client.isConnected&&await this.client.sendLeave(),await this.client.close(),this.primaryPC=void 0,(a=this.publisher)==null||a.close(),this.publisher=void 0,(s=this.subscriber)==null||s.close(),this.subscriber=void 0;let n;try{if(!this.signalOpts)throw livekitLogger.warn("attempted connection restart, without signal options present"),new SignalReconnectError;n=await this.join(this.url,this.token,this.signalOpts)}catch{throw new SignalReconnectError}await this.waitForPCConnected(),this.client.setReconnected(),this.emit(EngineEvent.Restarted,n)}async resumeConnection(t=!1,n){var a;if(!this.url||!this.token)throw new UnexpectedConnectionState("could not reconnect, url or token not saved");if(!this.publisher||!this.subscriber)throw new UnexpectedConnectionState("publisher and subscriber connections unset");livekitLogger.info(`resuming signal connection, attempt ${this.reconnectAttempts}`),(t||this.reconnectAttempts===0)&&this.emit(EngineEvent.Resuming);try{const s=await this.client.reconnect(this.url,this.token,this.participantSid,n);if(s){const o=this.makeRTCConfiguration(s);this.publisher.pc.setConfiguration(o),this.subscriber.pc.setConfiguration(o)}}catch(s){let o="";throw s instanceof Error&&(o=s.message),new SignalReconnectError(o)}this.emit(EngineEvent.SignalResumed),this.subscriber.restartingIce=!0,this.hasPublished&&await this.publisher.createAndSendOffer({iceRestart:!0}),await this.waitForPCConnected(),this.client.setReconnected(),((a=this.reliableDC)==null?void 0:a.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),this.emit(EngineEvent.Resumed)}async waitForPCConnected(){var a;const t=Date.now();let n=t;for(this.pcState=3,livekitLogger.debug("waiting for peer connection to reconnect");n-t<this.peerConnectionTimeout&&this.primaryPC!==void 0;){if(n-t>minReconnectWait&&((a=this.primaryPC)==null?void 0:a.connectionState)==="connected"){this.pcState=1;try{this.connectedServerAddr=await getConnectedAddress(this.primaryPC)}catch(s){livekitLogger.warn("could not get connected server address",{error:s})}}if(this.pcState===1)return;await sleep(100),n=Date.now()}throw new ConnectionError("could not establish PC connection")}async sendDataPacket(t,n){const a=DataPacket.encode(t).finish();await this.ensurePublisherConnected(n),n===DataPacket_Kind.LOSSY&&this.lossyDC?this.lossyDC.send(a):n===DataPacket_Kind.RELIABLE&&this.reliableDC&&this.reliableDC.send(a)}async ensureDataTransportConnected(t,n=this.subscriberPrimary){var d,u,l;const a=n?this.subscriber:this.publisher,s=n?"Subscriber":"Publisher";if(!a)throw new ConnectionError(`${s} connection not set`);!n&&!((d=this.publisher)!=null&&d.isICEConnected)&&((u=this.publisher)==null?void 0:u.pc.iceConnectionState)!=="checking"&&this.negotiate();const o=this.dataChannelForKind(t,n);if((o==null?void 0:o.readyState)==="open")return;const c=new Date().getTime()+this.peerConnectionTimeout;for(;new Date().getTime()<c;){if(a.isICEConnected&&((l=this.dataChannelForKind(t,n))==null?void 0:l.readyState)==="open")return;await sleep(50)}throw new ConnectionError(`could not establish ${s} connection, state: ${a.pc.iceConnectionState}`)}async ensurePublisherConnected(t){await this.ensureDataTransportConnected(t,!1)}negotiate(){return new Promise((t,n)=>{if(!this.publisher){n(new NegotiationError("publisher is not defined"));return}this.hasPublished=!0;const a=()=>{livekitLogger.debug("engine disconnected while negotiation was ongoing"),o(),t()};this.on(EngineEvent.Closing,a);const s=setTimeout(()=>{n("negotiation timed out"),this.handleDisconnect("negotiation",!1,ReconnectReason.REASON_SIGNAL_DISCONNECTED)},this.peerConnectionTimeout),o=()=>{clearTimeout(s),this.off(EngineEvent.Closing,a)};this.publisher.once(PCEvents.NegotiationStarted,()=>{var c;(c=this.publisher)==null||c.once(PCEvents.NegotiationComplete,()=>{o(),t()})}),this.publisher.negotiate(c=>{o(),n(c),c instanceof NegotiationError&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",!1,ReconnectReason.REASON_UNKOWN)})})}dataChannelForKind(t,n){if(n){if(t===DataPacket_Kind.LOSSY)return this.lossyDCSub;if(t===DataPacket_Kind.RELIABLE)return this.reliableDCSub}else{if(t===DataPacket_Kind.LOSSY)return this.lossyDC;if(t===DataPacket_Kind.RELIABLE)return this.reliableDC}}clearReconnectTimeout(){this.reconnectTimeout&&CriticalTimers.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){isWeb()&&window.addEventListener("online",this.handleBrowserOnLine)}deregisterOnLineListener(){isWeb()&&window.removeEventListener("online",this.handleBrowserOnLine)}}async function getConnectedAddress(e){var o;let i="";const t=new Map,n=new Map;if((await e.getStats()).forEach(c=>{switch(c.type){case"transport":i=c.selectedCandidatePairId;break;case"candidate-pair":i===""&&c.selected&&(i=c.id),t.set(c.id,c);break;case"remote-candidate":n.set(c.id,`${c.address}:${c.port}`);break}}),i==="")return;const s=(o=t.get(i))==null?void 0:o.remoteCandidateId;if(s!==void 0)return n.get(s)}class SignalReconnectError extends Error{}var ConnectionState=(e=>(e.Disconnected="disconnected",e.Connecting="connecting",e.Connected="connected",e.Reconnecting="reconnecting",e))(ConnectionState||{});class Room extends events.exports.EventEmitter{constructor(t){super();h(this,"state","disconnected");h(this,"participants");h(this,"activeSpeakers",[]);h(this,"engine");h(this,"sid","");h(this,"name","");h(this,"localParticipant");h(this,"metadata");h(this,"options");h(this,"_isRecording",!1);h(this,"identityToSid");h(this,"connOptions");h(this,"audioEnabled",!0);h(this,"audioContext");h(this,"abortController");h(this,"connectFuture");h(this,"disconnectLock");h(this,"connect",async(t,n,a)=>{const s=await this.disconnectLock.lock();if(this.state==="connected")return livekitLogger.info(`already connected to room ${this.name}`),s(),Promise.resolve();if(this.connectFuture)return s(),this.connectFuture.promise;this.setAndEmitConnectionState("connecting");const o=async(c,d)=>{var f,p;(!this.abortController||this.abortController.signal.aborted)&&(this.abortController=new AbortController),s(),this.state==="reconnecting"?(livekitLogger.info("Reconnection attempt replaced by new connection attempt"),this.recreateEngine()):this.maybeCreateEngine(),this.acquireAudioContext(),this.connOptions={...roomConnectOptionDefaults,...a},this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const m=await this.engine.join(t,n,{autoSubscribe:this.connOptions.autoSubscribe,publishOnly:this.connOptions.publishOnly,adaptiveStream:typeof this.options.adaptiveStream=="object"?!0:this.options.adaptiveStream,maxRetries:this.connOptions.maxRetries},this.abortController.signal);let g=m.serverInfo;if(g||(g={version:m.serverVersion,region:m.serverRegion}),livekitLogger.debug(`connected to Livekit Server ${Object.entries(g).map(([v,T])=>`${v}: ${T}`).join(", ")}`),!m.serverVersion)throw new UnsupportedServer("unknown server version");m.serverVersion==="0.15.1"&&this.options.dynacast&&(livekitLogger.debug("disabling dynacast due to server version"),this.options.dynacast=!1);const S=m.participant;this.localParticipant.sid=S.sid,this.localParticipant.identity=S.identity,this.localParticipant.updateInfo(S),this.setupLocalParticipantEvents(),m.otherParticipants.forEach(v=>{v.sid!==this.localParticipant.sid&&v.identity!==this.localParticipant.identity?this.getOrCreateParticipant(v.sid,v):livekitLogger.warn("received info to create local participant as remote participant",{info:v,localParticipant:this.localParticipant})}),this.name=m.room.name,this.sid=m.room.sid,this.metadata=m.room.metadata,this._isRecording!==m.room.activeRecording&&(this._isRecording=m.room.activeRecording,this.emit(RoomEvent.RecordingStatusChanged,m.room.activeRecording)),this.emit(RoomEvent.SignalConnected)}catch(m){this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish);const g=new ConnectionError("could not establish signal connection");m instanceof Error&&(g.message=`${g.message}: ${m.message}`),m instanceof ConnectionError&&(g.reason=m.reason,g.status=m.status),livekitLogger.debug("error trying to establish signal connection",{error:m}),d(g);return}const u=CriticalTimers.setTimeout(()=>{this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),d(new ConnectionError("could not connect PeerConnection after timeout"))},this.connOptions.peerConnectionTimeout),l=()=>{livekitLogger.warn("closing engine"),CriticalTimers.clearTimeout(u),this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),d(new ConnectionError("room connection has been cancelled"))};(f=this.abortController)!=null&&f.signal.aborted&&l(),(p=this.abortController)==null||p.signal.addEventListener("abort",l),this.engine.once(EngineEvent.Connected,()=>{var m,g;CriticalTimers.clearTimeout(u),(m=this.abortController)==null||m.signal.removeEventListener("abort",l),isWeb()&&(window.addEventListener("beforeunload",this.onBeforeUnload),(g=navigator.mediaDevices)==null||g.addEventListener("devicechange",this.handleDeviceChange)),this.setAndEmitConnectionState("connected"),this.emit(RoomEvent.Connected),c()})};return this.connectFuture=new Future(o,()=>{this.clearConnectionFutures()}),this.connectFuture.promise});h(this,"disconnect",async(t=!0)=>{var a,s,o,c;const n=await this.disconnectLock.lock();try{if(this.state==="disconnected"){livekitLogger.debug("already disconnected");return}livekitLogger.info("disconnect from room",{identity:this.localParticipant.identity}),(this.state==="connecting"||this.state==="reconnecting")&&(livekitLogger.warn("abort connection attempt"),(a=this.abortController)==null||a.abort(),(o=(s=this.connectFuture)==null?void 0:s.reject)==null||o.call(s,new ConnectionError("Client initiated disconnect")),this.connectFuture=void 0),(c=this.engine)!=null&&c.client.isConnected&&await this.engine.client.sendLeave(),this.engine&&await this.engine.close(),this.handleDisconnect(t,DisconnectReason.CLIENT_INITIATED),this.engine=void 0}finally{n()}});h(this,"onBeforeUnload",async()=>{await this.disconnect()});h(this,"handleRestarting",()=>{for(const t of this.participants.values())this.handleParticipantDisconnected(t.sid,t);this.setAndEmitConnectionState("reconnecting")&&this.emit(RoomEvent.Reconnecting)});h(this,"handleRestarted",async t=>{livekitLogger.debug("reconnected to server",{region:t.serverRegion}),this.setAndEmitConnectionState("connected"),this.emit(RoomEvent.Reconnected),t.participant&&(this.localParticipant.sid=t.participant.sid,this.handleParticipantUpdates([t.participant])),this.handleParticipantUpdates(t.otherParticipants);const n=[];this.localParticipant.tracks.forEach(a=>{a.track&&n.push(a)}),await Promise.all(n.map(async a=>{const s=a.track;this.localParticipant.unpublishTrack(s,!1),s.isMuted||((s instanceof LocalAudioTrack||s instanceof LocalVideoTrack)&&!s.isUserProvided&&(livekitLogger.debug("restarting existing track",{track:a.trackSid}),await s.restartTrack()),await this.localParticipant.publishTrack(s,a.options))}))});h(this,"handleParticipantUpdates",t=>{t.forEach(n=>{if(n.identity===this.localParticipant.identity){this.localParticipant.updateInfo(n);return}const a=this.identityToSid.get(n.identity);a&&a!==n.sid&&this.handleParticipantDisconnected(a,this.participants.get(a));let s=this.participants.get(n.sid);const o=!s;s=this.getOrCreateParticipant(n.sid,n),n.state===ParticipantInfo_State.DISCONNECTED?this.handleParticipantDisconnected(n.sid,s):o||s.updateInfo(n)})});h(this,"handleActiveSpeakersUpdate",t=>{const n=[],a={};t.forEach(s=>{if(a[s.sid]=!0,s.sid===this.localParticipant.sid)this.localParticipant.audioLevel=s.level,this.localParticipant.setIsSpeaking(!0),n.push(this.localParticipant);else{const o=this.participants.get(s.sid);o&&(o.audioLevel=s.level,o.setIsSpeaking(!0),n.push(o))}}),a[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.participants.forEach(s=>{a[s.sid]||(s.audioLevel=0,s.setIsSpeaking(!1))}),this.activeSpeakers=n,this.emitWhenConnected(RoomEvent.ActiveSpeakersChanged,n)});h(this,"handleSpeakersChanged",t=>{const n=new Map;this.activeSpeakers.forEach(s=>{n.set(s.sid,s)}),t.forEach(s=>{let o=this.participants.get(s.sid);s.sid===this.localParticipant.sid&&(o=this.localParticipant),o&&(o.audioLevel=s.level,o.setIsSpeaking(s.active),s.active?n.set(s.sid,o):n.delete(s.sid))});const a=Array.from(n.values());a.sort((s,o)=>o.audioLevel-s.audioLevel),this.activeSpeakers=a,this.emitWhenConnected(RoomEvent.ActiveSpeakersChanged,a)});h(this,"handleStreamStateUpdate",t=>{t.streamStates.forEach(n=>{const a=this.participants.get(n.participantSid);if(!a)return;const s=a.getTrackPublication(n.trackSid);!s||!s.track||(s.track.streamState=Track.streamStateFromProto(n.state),a.emit(ParticipantEvent.TrackStreamStateChanged,s,s.track.streamState),this.emitWhenConnected(RoomEvent.TrackStreamStateChanged,s,s.track.streamState,a))})});h(this,"handleSubscriptionPermissionUpdate",t=>{const n=this.participants.get(t.participantSid);if(!n)return;const a=n.getTrackPublication(t.trackSid);!a||a.setAllowed(t.allowed)});h(this,"handleDataPacket",(t,n)=>{const a=this.participants.get(t.participantSid);this.emit(RoomEvent.DataReceived,t.payload,a,n),a==null||a.emit(ParticipantEvent.DataReceived,t.payload,n)});h(this,"handleAudioPlaybackStarted",()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(RoomEvent.AudioPlaybackStatusChanged,!0))});h(this,"handleAudioPlaybackFailed",t=>{livekitLogger.warn("could not playback audio",t),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(RoomEvent.AudioPlaybackStatusChanged,!1))});h(this,"handleDeviceChange",async()=>{this.emit(RoomEvent.MediaDevicesChanged)});h(this,"handleRoomUpdate",t=>{this._isRecording!==t.activeRecording&&(this._isRecording=t.activeRecording,this.emit(RoomEvent.RecordingStatusChanged,t.activeRecording)),this.metadata!==t.metadata&&(this.metadata=t.metadata,this.emitWhenConnected(RoomEvent.RoomMetadataChanged,t.metadata))});h(this,"handleConnectionQualityUpdate",t=>{t.updates.forEach(n=>{if(n.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(n.quality);return}const a=this.participants.get(n.participantSid);a&&a.setConnectionQuality(n.quality)})});h(this,"onLocalParticipantMetadataChanged",t=>{this.emit(RoomEvent.ParticipantMetadataChanged,t,this.localParticipant)});h(this,"onLocalTrackMuted",t=>{this.emit(RoomEvent.TrackMuted,t,this.localParticipant)});h(this,"onLocalTrackUnmuted",t=>{this.emit(RoomEvent.TrackUnmuted,t,this.localParticipant)});h(this,"onLocalTrackPublished",t=>{this.emit(RoomEvent.LocalTrackPublished,t,this.localParticipant)});h(this,"onLocalTrackUnpublished",t=>{this.emit(RoomEvent.LocalTrackUnpublished,t,this.localParticipant)});h(this,"onLocalConnectionQualityChanged",t=>{this.emit(RoomEvent.ConnectionQualityChanged,t,this.localParticipant)});h(this,"onMediaDevicesError",t=>{this.emit(RoomEvent.MediaDevicesError,t)});h(this,"onLocalParticipantPermissionsChanged",t=>{this.emit(RoomEvent.ParticipantPermissionsChanged,t,this.localParticipant)});this.setMaxListeners(100),this.participants=new Map,this.identityToSid=new Map,this.options={...roomOptionDefaults,...t},this.options.audioCaptureDefaults={...audioDefaults,...t==null?void 0:t.audioCaptureDefaults},this.options.videoCaptureDefaults={...videoDefaults,...t==null?void 0:t.videoCaptureDefaults},this.options.publishDefaults={...publishDefaults,...t==null?void 0:t.publishDefaults},this.maybeCreateEngine(),this.disconnectLock=new Mutex,this.localParticipant=new LocalParticipant("","",this.engine,this.options)}maybeCreateEngine(){this.engine||(this.engine=new RTCEngine(this.options),this.engine.client.onParticipantUpdate=this.handleParticipantUpdates,this.engine.client.onRoomUpdate=this.handleRoomUpdate,this.engine.client.onSpeakersChanged=this.handleSpeakersChanged,this.engine.client.onStreamStateUpdate=this.handleStreamStateUpdate,this.engine.client.onSubscriptionPermissionUpdate=this.handleSubscriptionPermissionUpdate,this.engine.client.onConnectionQuality=this.handleConnectionQualityUpdate,this.engine.on(EngineEvent.MediaTrackAdded,(t,n,a)=>{this.onTrackAdded(t,n,a)}).on(EngineEvent.Disconnected,t=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,t)}).on(EngineEvent.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(EngineEvent.DataPacketReceived,this.handleDataPacket).on(EngineEvent.Resuming,()=>{this.setAndEmitConnectionState("reconnecting")&&this.emit(RoomEvent.Reconnecting)}).on(EngineEvent.Resumed,()=>{this.setAndEmitConnectionState("connected"),this.emit(RoomEvent.Reconnected),this.updateSubscriptions()}).on(EngineEvent.SignalResumed,()=>{this.state==="reconnecting"&&this.sendSyncState()}).on(EngineEvent.Restarting,this.handleRestarting).on(EngineEvent.Restarted,this.handleRestarted),this.localParticipant&&this.localParticipant.setupEngine(this.engine))}static getLocalDevices(t,n=!0){return DeviceManager.getInstance().getDevices(t,n)}async prepareConnection(t){await fetch(`http${t.substring(2)}`,{method:"HEAD"})}getParticipantByIdentity(t){if(this.localParticipant.identity===t)return this.localParticipant;const n=this.identityToSid.get(t);if(n)return this.participants.get(n)}clearConnectionFutures(){this.connectFuture=void 0}get isRecording(){return this._isRecording}async simulateScenario(t){let n=()=>{},a;switch(t){case"signal-reconnect":await this.engine.client.close(),this.engine.client.onClose&&this.engine.client.onClose("simulate disconnect");break;case"speaker":a=SimulateScenario.fromPartial({scenario:{$case:"speakerUpdate",speakerUpdate:3}});break;case"node-failure":a=SimulateScenario.fromPartial({scenario:{$case:"nodeFailure",nodeFailure:!0}});break;case"server-leave":a=SimulateScenario.fromPartial({scenario:{$case:"serverLeave",serverLeave:!0}});break;case"migration":a=SimulateScenario.fromPartial({scenario:{$case:"migration",migration:!0}});break;case"force-tcp":case"force-tls":a=SimulateScenario.fromPartial({scenario:{$case:"switchCandidateProtocol",switchCandidateProtocol:t==="force-tls"?2:1}}),n=async()=>{const s=this.engine.client.onLeave;s&&s({reason:DisconnectReason.CLIENT_INITIATED,canReconnect:!0})};break}a&&(this.engine.client.sendSimulateScenario(a),n())}async startAudio(){await this.acquireAudioContext();const t=[];this.participants.forEach(n=>{n.audioTracks.forEach(a=>{a.track&&a.track.attachedElements.forEach(s=>{t.push(s)})})});try{await Promise.all(t.map(n=>(n.muted=!1,n.play()))),this.handleAudioPlaybackStarted()}catch(n){throw this.handleAudioPlaybackFailed(n),n}}get canPlaybackAudio(){return this.audioEnabled}getActiveAudioOutputDevice(){var t,n;return(n=(t=this.options.audioOutput)==null?void 0:t.deviceId)!=null?n:""}async switchActiveDevice(t,n){var a,s;if(t==="audioinput"){const o=this.options.audioCaptureDefaults.deviceId;this.options.audioCaptureDefaults.deviceId=n;const c=Array.from(this.localParticipant.audioTracks.values()).filter(d=>d.source===Track.Source.Microphone);try{await Promise.all(c.map(d=>{var u;return(u=d.audioTrack)==null?void 0:u.setDeviceId(n)}))}catch(d){throw this.options.audioCaptureDefaults.deviceId=o,d}}else if(t==="videoinput"){const o=this.options.videoCaptureDefaults.deviceId;this.options.videoCaptureDefaults.deviceId=n;const c=Array.from(this.localParticipant.videoTracks.values()).filter(d=>d.source===Track.Source.Camera);try{await Promise.all(c.map(d=>{var u;return(u=d.videoTrack)==null?void 0:u.setDeviceId(n)}))}catch(d){throw this.options.videoCaptureDefaults.deviceId=o,d}}else if(t==="audiooutput"){if(!supportsSetSinkId())throw new Error("cannot switch audio output, setSinkId not supported");(s=(a=this.options).audioOutput)!=null||(a.audioOutput={});const o=this.options.audioOutput.deviceId;this.options.audioOutput.deviceId=n;try{await Promise.all(Array.from(this.participants.values()).map(c=>c.setAudioOutput({deviceId:n})))}catch(c){throw this.options.audioOutput.deviceId=o,c}}}setupLocalParticipantEvents(){this.localParticipant.on(ParticipantEvent.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(ParticipantEvent.TrackMuted,this.onLocalTrackMuted).on(ParticipantEvent.TrackUnmuted,this.onLocalTrackUnmuted).on(ParticipantEvent.LocalTrackPublished,this.onLocalTrackPublished).on(ParticipantEvent.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(ParticipantEvent.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(ParticipantEvent.MediaDevicesError,this.onMediaDevicesError).on(ParticipantEvent.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var t;(t=this.engine)==null||t.close(),this.engine=void 0,this.participants.clear(),this.maybeCreateEngine()}onTrackAdded(t,n,a){if(this.state==="connecting"||this.state==="reconnecting"){const l=()=>{this.onTrackAdded(t,n,a),f()},f=()=>{this.off(RoomEvent.Reconnected,l),this.off(RoomEvent.Connected,l),this.off(RoomEvent.Disconnected,f)};this.once(RoomEvent.Reconnected,l),this.once(RoomEvent.Connected,l),this.once(RoomEvent.Disconnected,f);return}if(this.state==="disconnected"){livekitLogger.warn("skipping incoming track after Room disconnected");return}const s=unpackStreamId(n.id),o=s[0];let c=s[1];if((!c||c==="")&&(c=t.id),o===this.localParticipant.sid){livekitLogger.warn("tried to create RemoteParticipant for local participant");return}const d=this.getOrCreateParticipant(o);let u;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?u=this.options.adaptiveStream:u={}),d.addSubscribedMediaTrack(t,c,n,a,u)}handleDisconnect(t=!0,n){var a;this.state!=="disconnected"&&(this.participants.forEach(s=>{s.tracks.forEach(o=>{s.unpublishTrack(o.trackSid)})}),this.localParticipant.tracks.forEach(s=>{var o,c;s.track&&this.localParticipant.unpublishTrack(s.track,t),t&&((o=s.track)==null||o.detach(),(c=s.track)==null||c.stop())}),this.localParticipant.off(ParticipantEvent.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(ParticipantEvent.TrackMuted,this.onLocalTrackMuted).off(ParticipantEvent.TrackUnmuted,this.onLocalTrackUnmuted).off(ParticipantEvent.LocalTrackPublished,this.onLocalTrackPublished).off(ParticipantEvent.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(ParticipantEvent.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(ParticipantEvent.MediaDevicesError,this.onMediaDevicesError).off(ParticipantEvent.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.tracks.clear(),this.localParticipant.videoTracks.clear(),this.localParticipant.audioTracks.clear(),this.participants.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.expWebAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),isWeb()&&(window.removeEventListener("beforeunload",this.onBeforeUnload),(a=navigator.mediaDevices)==null||a.removeEventListener("devicechange",this.handleDeviceChange)),this.setAndEmitConnectionState("disconnected"),this.emit(RoomEvent.Disconnected,n))}handleParticipantDisconnected(t,n){this.participants.delete(t),n&&(this.identityToSid.delete(n.identity),n.tracks.forEach(a=>{n.unpublishTrack(a.trackSid,!0)}),this.emitWhenConnected(RoomEvent.ParticipantDisconnected,n))}async acquireAudioContext(){var n,a;typeof this.options.expWebAudioMix!="boolean"&&this.options.expWebAudioMix.audioContext?(this.audioContext=this.options.expWebAudioMix.audioContext,await this.audioContext.resume()):this.audioContext=(n=getNewAudioContext())!=null?n:void 0,this.options.expWebAudioMix&&this.participants.forEach(s=>s.setAudioContext(this.audioContext));const t=((a=this.audioContext)==null?void 0:a.state)==="running";t!==this.canPlaybackAudio&&(this.audioEnabled=t,this.emit(RoomEvent.AudioPlaybackStatusChanged,t))}createParticipant(t,n){let a;return n?a=RemoteParticipant.fromParticipantInfo(this.engine.client,n):a=new RemoteParticipant(this.engine.client,t,"",void 0,void 0),this.options.expWebAudioMix&&a.setAudioContext(this.audioContext),a}getOrCreateParticipant(t,n){if(this.participants.has(t))return this.participants.get(t);const a=this.createParticipant(t,n);return this.participants.set(t,a),n&&(this.identityToSid.set(n.identity,n.sid),this.emitWhenConnected(RoomEvent.ParticipantConnected,a)),a.on(ParticipantEvent.TrackPublished,s=>{this.emitWhenConnected(RoomEvent.TrackPublished,s,a)}).on(ParticipantEvent.TrackSubscribed,(s,o)=>{s.kind===Track.Kind.Audio&&(s.on(TrackEvent.AudioPlaybackStarted,this.handleAudioPlaybackStarted),s.on(TrackEvent.AudioPlaybackFailed,this.handleAudioPlaybackFailed)),this.emit(RoomEvent.TrackSubscribed,s,o,a)}).on(ParticipantEvent.TrackUnpublished,s=>{this.emitWhenConnected(RoomEvent.TrackUnpublished,s,a)}).on(ParticipantEvent.TrackUnsubscribed,(s,o)=>{this.emit(RoomEvent.TrackUnsubscribed,s,o,a)}).on(ParticipantEvent.TrackSubscriptionFailed,s=>{this.emit(RoomEvent.TrackSubscriptionFailed,s,a)}).on(ParticipantEvent.TrackMuted,s=>{this.emitWhenConnected(RoomEvent.TrackMuted,s,a)}).on(ParticipantEvent.TrackUnmuted,s=>{this.emitWhenConnected(RoomEvent.TrackUnmuted,s,a)}).on(ParticipantEvent.ParticipantMetadataChanged,s=>{this.emitWhenConnected(RoomEvent.ParticipantMetadataChanged,s,a)}).on(ParticipantEvent.ConnectionQualityChanged,s=>{this.emitWhenConnected(RoomEvent.ConnectionQualityChanged,s,a)}).on(ParticipantEvent.ParticipantPermissionsChanged,s=>{this.emitWhenConnected(RoomEvent.ParticipantPermissionsChanged,s,a)}).on(ParticipantEvent.TrackSubscriptionStatusChanged,(s,o)=>{this.emitWhenConnected(RoomEvent.TrackSubscriptionStatusChanged,s,o,a)}).on(ParticipantEvent.TrackSubscriptionPermissionChanged,(s,o)=>{this.emitWhenConnected(RoomEvent.TrackSubscriptionPermissionChanged,s,o,a)}),n&&a.updateInfo(n),a}sendSyncState(){var o,c;if(this.engine.subscriber===void 0||this.engine.subscriber.pc.localDescription===null)return;const t=this.engine.subscriber.pc.localDescription,n=this.engine.subscriber.pc.remoteDescription,a=(c=(o=this.connOptions)==null?void 0:o.autoSubscribe)!=null?c:!0,s=new Array;this.participants.forEach(d=>{d.tracks.forEach(u=>{u.isDesired!==a&&s.push(u.trackSid)})}),this.engine.client.sendSyncState({answer:toProtoSessionDescription({sdp:t.sdp,type:t.type}),offer:n?toProtoSessionDescription({sdp:n.sdp,type:n.type}):void 0,subscription:{trackSids:s,subscribe:!a,participantTracks:[]},publishTracks:this.localParticipant.publishedTracksInfo(),dataChannels:this.localParticipant.dataChannelsInfo()})}updateSubscriptions(){for(const t of this.participants.values())for(const n of t.videoTracks.values())n.isSubscribed&&n instanceof RemoteTrackPublication&&n.emitTrackUpdate()}setAndEmitConnectionState(t){return t===this.state?!1:(this.state=t,this.emit(RoomEvent.ConnectionStateChanged,this.state),!0)}emitWhenConnected(t,...n){return this.state==="connected"?this.emit(t,...n):!1}async simulateParticipants(t){const n={audio:!0,video:!0,useRealTracks:!1,...t.publish},a={count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3],...t.participants};if(this.handleDisconnect(),this.name="simulated-room",this.localParticipant.updateInfo(ParticipantInfo.fromPartial({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(RoomEvent.SignalConnected),this.emit(RoomEvent.Connected),this.setAndEmitConnectionState("connected"),n.video){const s=new LocalTrackPublication(Track.Kind.Video,TrackInfo.fromPartial({source:TrackSource.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:TrackType.AUDIO,name:"video-dummy"}),new LocalVideoTrack(n.useRealTracks?(await navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:createDummyVideoStreamTrack(160*a.aspectRatios[0],160,!0,!0)));this.localParticipant.addTrackPublication(s),this.localParticipant.emit(ParticipantEvent.LocalTrackPublished,s)}if(n.audio){const s=new LocalTrackPublication(Track.Kind.Audio,TrackInfo.fromPartial({source:TrackSource.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:TrackType.AUDIO}),new LocalAudioTrack(n.useRealTracks?(await navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:getEmptyAudioStreamTrack()));this.localParticipant.addTrackPublication(s),this.localParticipant.emit(ParticipantEvent.LocalTrackPublished,s)}for(let s=0;s<a.count-1;s+=1){let o=ParticipantInfo.fromPartial({sid:Math.floor(Math.random()*1e4).toString(),identity:`simulated-${s}`,state:ParticipantInfo_State.ACTIVE,tracks:[],joinedAt:Date.now()});const c=this.getOrCreateParticipant(o.identity,o);if(a.video){const d=createDummyVideoStreamTrack(160*a.aspectRatios[s%a.aspectRatios.length],160,!1,!0),u=TrackInfo.fromPartial({source:TrackSource.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:TrackType.AUDIO});c.addSubscribedMediaTrack(d,u.sid,new MediaStream([d])),o.tracks=[...o.tracks,u]}if(a.audio){const d=getEmptyAudioStreamTrack(),u=TrackInfo.fromPartial({source:TrackSource.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:TrackType.AUDIO});c.addSubscribedMediaTrack(d,u.sid,new MediaStream([d])),o.tracks=[...o.tracks,u]}c.updateInfo(o)}}emit(t,...n){return t!==RoomEvent.ActiveSpeakersChanged&&livekitLogger.debug(`room event ${t}`,{event:t,args:n}),super.emit(t,...n)}}const $=e=>document.getElementById(e),state={isFrontFacing:!1,encoder:new TextEncoder,decoder:new TextDecoder,defaultDevices:new Map,bitrateInterval:void 0};let currentRoom,startTime;const searchParams=new URLSearchParams(window.location.search);var ye;const storedUrl=(ye=searchParams.get("url"))!=null?ye:"ws://localhost:7880";var be;const storedToken=(be=searchParams.get("token"))!=null?be:"";$("url").value=storedUrl;$("token").value=storedToken;function updateSearchParams(e,i){const t=new URLSearchParams({url:e,token:i});window.history.replaceState(null,"",`${window.location.pathname}?${t.toString()}`)}const appActions={connectWithFormInput:async()=>{const e=$("url").value,i=$("token").value,t=$("simulcast").checked,n=$("dynacast").checked,a=$("force-turn").checked,s=$("adaptive-stream").checked,o=$("publish-option").checked,c=$("preferred-codec").value,d=$("auto-subscribe").checked;setLogLevel(LogLevel.debug),updateSearchParams(e,i);const u={adaptiveStream:s,dynacast:n,publishDefaults:{simulcast:t,videoSimulcastLayers:[VideoPresets.h90,VideoPresets.h216],videoCodec:c||"vp8"},videoCaptureDefaults:{resolution:VideoPresets.h720.resolution}},l={autoSubscribe:d};a&&(l.rtcConfig={iceTransportPolicy:"relay"}),await appActions.connectToRoom(e,i,u,l,o),state.bitrateInterval=setInterval(renderBitrate,1e3)},connectToRoom:async(e,i,t,n,a)=>{const s=new Room(t);startTime=Date.now(),await s.prepareConnection(e);const o=Date.now()-startTime;appendLog(`prewarmed connection in ${o}ms`),s.on(RoomEvent.ParticipantConnected,participantConnected).on(RoomEvent.ParticipantDisconnected,participantDisconnected).on(RoomEvent.DataReceived,handleData).on(RoomEvent.Disconnected,handleRoomDisconnect).on(RoomEvent.Reconnecting,()=>appendLog("Reconnecting to room")).on(RoomEvent.Reconnected,()=>{appendLog("Successfully reconnected. server",s.engine.connectedServerAddress)}).on(RoomEvent.LocalTrackPublished,c=>{const d=c.track;if(d instanceof LocalAudioTrack){const{calculateVolume:u}=createAudioAnalyser(d);setInterval(()=>{var l;(l=$("local-volume"))==null||l.setAttribute("value",u().toFixed(4))},200)}renderParticipant(s.localParticipant),updateButtonsForPublishState(),renderScreenShare(s)}).on(RoomEvent.LocalTrackUnpublished,()=>{renderParticipant(s.localParticipant),updateButtonsForPublishState(),renderScreenShare(s)}).on(RoomEvent.RoomMetadataChanged,c=>{appendLog("new metadata for room",c)}).on(RoomEvent.MediaDevicesChanged,handleDevicesChanged).on(RoomEvent.AudioPlaybackStatusChanged,()=>{var c,d;s.canPlaybackAudio?(c=$("start-audio-button"))==null||c.setAttribute("disabled","true"):(d=$("start-audio-button"))==null||d.removeAttribute("disabled")}).on(RoomEvent.MediaDevicesError,c=>{const d=MediaDeviceFailure.getFailure(c);appendLog("media device failure",d)}).on(RoomEvent.ConnectionQualityChanged,(c,d)=>{appendLog("connection quality changed",d==null?void 0:d.identity,c)}).on(RoomEvent.TrackSubscribed,(c,d,u)=>{appendLog("subscribed to track",d.trackSid,u.identity),renderParticipant(u),renderScreenShare(s)}).on(RoomEvent.TrackUnsubscribed,(c,d,u)=>{appendLog("unsubscribed from track",d.trackSid),renderParticipant(u),renderScreenShare(s)}).on(RoomEvent.SignalConnected,async()=>{const c=Date.now()-startTime;appendLog(`signal connection established in ${c}ms`),a&&(await s.localParticipant.enableCameraAndMicrophone(),appendLog(`tracks published in ${Date.now()-startTime}ms`),updateButtonsForPublishState())});try{await s.connect(e,i,n);const c=Date.now()-startTime;appendLog(`successfully connected to ${s.name} in ${Math.round(c)}ms`,s.engine.connectedServerAddress)}catch(c){let d=c;c.message&&(d=c.message),appendLog("could not connect:",d);return}return currentRoom=s,window.currentRoom=s,setButtonsForState(!0),s.participants.forEach(c=>{participantConnected(c)}),participantConnected(s.localParticipant),s},toggleAudio:async()=>{if(!currentRoom)return;const e=currentRoom.localParticipant.isMicrophoneEnabled;setButtonDisabled("toggle-audio-button",!0),appendLog(e?"disabling audio":"enabling audio"),await currentRoom.localParticipant.setMicrophoneEnabled(!e),setButtonDisabled("toggle-audio-button",!1),updateButtonsForPublishState()},toggleVideo:async()=>{if(!currentRoom)return;setButtonDisabled("toggle-video-button",!0);const e=currentRoom.localParticipant.isCameraEnabled;appendLog(e?"disabling video":"enabling video"),await currentRoom.localParticipant.setCameraEnabled(!e),setButtonDisabled("toggle-video-button",!1),renderParticipant(currentRoom.localParticipant),updateButtonsForPublishState()},flipVideo:()=>{var t;const e=currentRoom==null?void 0:currentRoom.localParticipant.getTrack(Track.Source.Camera);if(!e)return;state.isFrontFacing?setButtonState("flip-video-button","Front Camera",!1):setButtonState("flip-video-button","Back Camera",!1),state.isFrontFacing=!state.isFrontFacing;const i={resolution:VideoPresets.h720.resolution,facingMode:state.isFrontFacing?"user":"environment"};(t=e.videoTrack)==null||t.restartTrack(i)},shareScreen:async()=>{if(!currentRoom)return;const e=currentRoom.localParticipant.isScreenShareEnabled;appendLog(`${e?"stopping":"starting"} screen share`),setButtonDisabled("share-screen-button",!0),await currentRoom.localParticipant.setScreenShareEnabled(!e,{audio:!0}),setButtonDisabled("share-screen-button",!1),updateButtonsForPublishState()},startAudio:()=>{currentRoom==null||currentRoom.startAudio()},enterText:()=>{if(!currentRoom)return;const e=$("entry");if(e.value){const i=state.encoder.encode(e.value);currentRoom.localParticipant.publishData(i,DataPacket_Kind.RELIABLE),$("chat").value+=`${currentRoom.localParticipant.identity} (me): ${e.value}
`,e.value=""}},disconnectRoom:()=>{currentRoom&&currentRoom.disconnect(),state.bitrateInterval&&clearInterval(state.bitrateInterval)},handleScenario:e=>{const i=e.target.value;i==="subscribe-all"?currentRoom==null||currentRoom.participants.forEach(t=>{t.tracks.forEach(n=>n.setSubscribed(!0))}):i==="unsubscribe-all"?currentRoom==null||currentRoom.participants.forEach(t=>{t.tracks.forEach(n=>n.setSubscribed(!1))}):i!==""&&(currentRoom==null||currentRoom.simulateScenario(i),e.target.value="")},handleDeviceSelected:async e=>{const i=e.target.value,t=e.target.id,n=elementMapping[t];!n||(state.defaultDevices.set(n,i),currentRoom&&await currentRoom.switchActiveDevice(n,i))},handlePreferredQuality:e=>{const i=e.target.value;let t=VideoQuality.HIGH;switch(i){case"low":t=VideoQuality.LOW;break;case"medium":t=VideoQuality.MEDIUM;break;case"high":t=VideoQuality.HIGH;break}currentRoom&&currentRoom.participants.forEach(n=>{n.tracks.forEach(a=>{a.setVideoQuality(t)})})},handlePreferredFPS:e=>{const i=+e.target.value;currentRoom&&currentRoom.participants.forEach(t=>{t.tracks.forEach(n=>{n.setVideoFPS(i)})})}};window.appActions=appActions;function handleData(e,i){const t=state.decoder.decode(e),n=$("chat");let a="server";i&&(a=i.identity),n.value+=`${a}: ${t}
`}function participantConnected(e){appendLog("participant",e.identity,"connected",e.metadata),e.on(ParticipantEvent.TrackMuted,i=>{appendLog("track was muted",i.trackSid,e.identity),renderParticipant(e)}).on(ParticipantEvent.TrackUnmuted,i=>{appendLog("track was unmuted",i.trackSid,e.identity),renderParticipant(e)}).on(ParticipantEvent.IsSpeakingChanged,()=>{renderParticipant(e)}).on(ParticipantEvent.ConnectionQualityChanged,()=>{renderParticipant(e)})}function participantDisconnected(e){appendLog("participant",e.sid,"disconnected"),renderParticipant(e,!0)}function handleRoomDisconnect(e){if(!currentRoom)return;appendLog("disconnected from room",{reason:e}),setButtonsForState(!1),renderParticipant(currentRoom.localParticipant,!0),currentRoom.participants.forEach(n=>{renderParticipant(n,!0)}),renderScreenShare(currentRoom);const i=$("participants-area");i&&(i.innerHTML="");const t=$("chat");t.value="",currentRoom=void 0,window.currentRoom=void 0}function appendLog(...e){const i=$("log");for(let t=0;t<arguments.length;t+=1)typeof e[t]=="object"?i.innerHTML+=`${JSON&&JSON.stringify?JSON.stringify(e[t],void 0,2):e[t]} `:i.innerHTML+=`${e[t]} `;i.innerHTML+=`
`,i.scrollTop=i.scrollHeight}function renderParticipant(e,i=!1){var m,g,S,v;const t=$("participants-area");if(!t)return;const{identity:n}=e;let a=$(`participant-${n}`);if(!a&&!i){a=document.createElement("div"),a.id=`participant-${n}`,a.className="participant",a.innerHTML=`
      <video id="video-${n}"></video>
      <audio id="audio-${n}"></audio>
      <div class="info-bar">
        <div id="name-${n}" class="name">
        </div>
        <div style="text-align: center;">
          <span id="codec-${n}" class="codec">
          </span>
          <span id="size-${n}" class="size">
          </span>
          <span id="bitrate-${n}" class="bitrate">
          </span>
        </div>
        <div class="right">
          <span id="signal-${n}"></span>
          <span id="mic-${n}" class="mic-on"></span>
        </div>
      </div>
      ${e instanceof RemoteParticipant?`<div class="volume-control">
        <input id="volume-${n}" type="range" min="0" max="1" step="0.1" value="1" orient="vertical" />
      </div>`:'<progress id="local-volume" max="1" value="0" />'}

    `,t.appendChild(a);const T=$(`size-${n}`),k=$(`video-${n}`);k.onresize=()=>{updateVideoSize(k,T)}}const s=$(`video-${n}`),o=$(`audio-${n}`);if(i){a==null||a.remove(),s&&(s.srcObject=null,s.src=""),o&&(o.srcObject=null,o.src="");return}$(`name-${n}`).innerHTML=e.identity,e instanceof LocalParticipant&&($(`name-${n}`).innerHTML+=" (you)");const c=$(`mic-${n}`),d=$(`signal-${n}`),u=e.getTrack(Track.Source.Camera),l=e.getTrack(Track.Source.Microphone);if(e.isSpeaking?a.classList.add("speaking"):a.classList.remove("speaking"),e instanceof RemoteParticipant&&$(`volume-${n}`).addEventListener("input",k=>{e.setVolume(Number.parseFloat(k.target.value))}),u&&u.isSubscribed&&!u.isMuted){if(e instanceof LocalParticipant)s.style.transform="scale(-1, 1)";else if(!((m=u==null?void 0:u.videoTrack)!=null&&m.attachedElements.includes(s))){const T=Date.now();s.onloadeddata=()=>{const k=Date.now()-T;let b=0;e.joinedAt&&e.joinedAt.getTime()<startTime&&(b=Date.now()-startTime),appendLog(`RemoteVideoTrack ${u==null?void 0:u.trackSid} (${s.videoWidth}x${s.videoHeight}) rendered in ${k}ms`,b>0?`, ${b}ms from start`:"")}}(g=u==null?void 0:u.videoTrack)==null||g.attach(s)}else $(`size-${n}`).innerHTML="",u!=null&&u.videoTrack?(S=u.videoTrack)==null||S.detach(s):(s.src="",s.srcObject=null);switch(l&&l.isSubscribed&&!l.isMuted?(e instanceof LocalParticipant||(o.onloadeddata=()=>{if(e.joinedAt&&e.joinedAt.getTime()<startTime){const T=Date.now()-startTime;appendLog(`RemoteAudioTrack ${l==null?void 0:l.trackSid} played ${T}ms from start`)}},(v=l==null?void 0:l.audioTrack)==null||v.attach(o)),c.className="mic-on",c.innerHTML='<i class="fas fa-microphone"></i>'):(c.className="mic-off",c.innerHTML='<i class="fas fa-microphone-slash"></i>'),e.connectionQuality){case ConnectionQuality.Excellent:case ConnectionQuality.Good:case ConnectionQuality.Poor:d.className=`connection-${e.connectionQuality}`,d.innerHTML='<i class="fas fa-circle"></i>';break;default:d.innerHTML=""}}function renderScreenShare(e){var s,o;const i=$("screenshare-area");if(e.state!==ConnectionState.Connected){i.style.display="none";return}let t,n=e.localParticipant.getTrack(Track.Source.ScreenShare),a;if(n?t=e.localParticipant:e.participants.forEach(c=>{if(n)return;t=c;const d=c.getTrack(Track.Source.ScreenShare);d!=null&&d.isSubscribed&&(n=d);const u=c.getTrack(Track.Source.ScreenShareAudio);u!=null&&u.isSubscribed&&(a=u)}),n&&t){i.style.display="block";const c=$("screenshare-video");(s=n.videoTrack)==null||s.attach(c),a&&((o=a.audioTrack)==null||o.attach(c)),c.onresize=()=>{updateVideoSize(c,$("screenshare-resolution"))};const d=$("screenshare-info");d.innerHTML=`Screenshare from ${t.identity}`}else i.style.display="none"}function renderBitrate(){var i;if(!currentRoom||currentRoom.state!==ConnectionState.Connected)return;const e=[...currentRoom.participants.values()];e.push(currentRoom.localParticipant);for(const t of e){const n=$(`bitrate-${t.identity}`);let a=0;for(const o of t.tracks.values())if(o.track&&(a+=o.track.currentBitrate),o.source===Track.Source.Camera&&o.videoTrack instanceof RemoteVideoTrack){const c=$(`codec-${t.identity}`);c.innerHTML=(i=o.videoTrack.getDecoderImplementation())!=null?i:""}let s="";a>0&&(s=`${Math.round(a/1024).toLocaleString()} kbps`),n&&(n.innerHTML=s)}}function updateVideoSize(e,i){i.innerHTML=`(${e.videoWidth}x${e.videoHeight})`}function setButtonState(e,i,t,n=void 0){const a=$(e);!a||(n!==void 0&&(a.disabled=n),a.innerHTML=i,t?a.classList.add("active"):a.classList.remove("active"))}function setButtonDisabled(e,i){const t=$(e);t.disabled=i}setTimeout(handleDevicesChanged,100);function setButtonsForState(e){const i=["toggle-video-button","toggle-audio-button","share-screen-button","disconnect-ws-button","disconnect-room-button","flip-video-button","send-button"],t=["connect-button"],n=e?i:t,a=e?t:i;n.forEach(s=>{var o;return(o=$(s))==null?void 0:o.removeAttribute("disabled")}),a.forEach(s=>{var o;return(o=$(s))==null?void 0:o.setAttribute("disabled","true")})}const elementMapping={"video-input":"videoinput","audio-input":"audioinput","audio-output":"audiooutput"};async function handleDevicesChanged(){Promise.all(Object.keys(elementMapping).map(async e=>{const i=elementMapping[e];if(!i)return;const t=await Room.getLocalDevices(i),n=$(e);populateSelect(n,t,state.defaultDevices.get(i))}))}function populateSelect(e,i,t){e.innerHTML="";for(const n of i){const a=document.createElement("option");a.text=n.label,a.value=n.deviceId,n.deviceId===t&&(a.selected=!0),e.appendChild(a)}}function updateButtonsForPublishState(){if(!currentRoom)return;const e=currentRoom.localParticipant;setButtonState("toggle-video-button",`${e.isCameraEnabled?"Disable":"Enable"} Video`,e.isCameraEnabled),setButtonState("toggle-audio-button",`${e.isMicrophoneEnabled?"Disable":"Enable"} Audio`,e.isMicrophoneEnabled),setButtonState("share-screen-button",e.isScreenShareEnabled?"Stop Screen Share":"Share Screen",e.isScreenShareEnabled)}async function acquireDeviceList(){handleDevicesChanged()}acquireDeviceList();
